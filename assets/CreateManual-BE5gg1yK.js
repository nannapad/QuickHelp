import{j as a,n as G}from"./ui-C0p69nPY.js";import{u as Q,r}from"./vendor-D6EYvIws.js";import{u as _}from"./utils-dQ_ya9vc.js";import{u as ee,A as ae}from"./AlertModal-DN7yXDQv.js";import{b as te}from"./UserData-CNiV9beM.js";const ue=()=>{const{t:i}=_(),j=Q(),{modalState:x,showAlert:c,hideAlert:D}=ee(),[p,I]=r.useState(""),[b,$]=r.useState(""),[v,u]=r.useState([{id:1,type:"text",value:"",showToolbar:!1}]),[M,E]=r.useState(null),[se,F]=r.useState(null),[f,A]=r.useState(null),[d,S]=r.useState(null),[h,P]=r.useState("IT"),[y,B]=r.useState(""),[O,R]=r.useState("EN"),[m,T]=r.useState([]),k=(e="text")=>{const t=Date.now()+Math.floor(Math.random()*1e3);u(s=>[...s,{id:t,type:e,value:"",imageFile:null,imageUrl:"",showToolbar:!1}])},z=e=>{u(t=>t.map(s=>s.id===e?{...s,showToolbar:!s.showToolbar}:s))},g=(e,t)=>{u(s=>s.map(l=>l.id===e?{...l,type:t,value:t==="image"?"":l.value}:l))},N=(e,t)=>{u(s=>s.map(l=>l.id===e?{...l,value:t}:l))},L=e=>{if(v.length<=1){c("You must have at least one block in your manual.","warning");return}u(t=>t.filter(s=>s.id!==e))},C=(e,t)=>{if(t){const s=new FileReader;s.onloadend=()=>{u(l=>l.map(n=>n.id===e?{...n,imageFile:t,imageUrl:s.result,value:t.name}:n))},s.readAsDataURL(t)}},U=(e,t)=>{u(s=>s.map(l=>l.id===e?{...l,imageUrl:t,value:t}:l))},q=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];E(t.name),F(t);const s=new FileReader;s.onloadend=()=>{A(s.result)},s.readAsDataURL(t)}},J=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];S(t.name);const s=new FileReader;s.onloadend=()=>{const l={name:t.name,size:t.size,type:t.type,dataUrl:s.result};S(l)},s.readAsDataURL(t)}},V=e=>{if(e.key==="Enter"){e.preventDefault();const t=e.target.value.trim();t&&!m.includes(t)&&(T([...m,t]),e.target.value="")}},W=e=>{T(m.filter(t=>t!==e))},H=()=>{if(!p.trim()){c("Please enter a manual title","warning");return}let e="Anonymous",t=null;try{const n=JSON.parse(localStorage.getItem("userData"));n&&(t=n,e=`${n.firstName} ${n.lastName}`)}catch(n){console.error("Error getting user data",n)}const s=y?.trim()||"1.0",l={id:Date.now(),title:p,description:b,category:h,version:s,versions:[s],meta:`${h} ‚Ä¢ v${s}`,tags:m,views:0,likes:0,downloads:0,author:e,createdAt:new Date().toISOString().split("T")[0],updatedAt:new Date().toISOString().split("T")[0],difficulty:"Beginner",estimatedTime:"10 min",thumbnail:f,blocks:v,fileInfo:d,status:"draft"};try{const o=[...JSON.parse(localStorage.getItem("customManuals")||"[]"),l];localStorage.setItem("customManuals",JSON.stringify(o)),console.log("Manual saved as draft:",l),window.dispatchEvent(new Event("manualUpdated")),c("Manual saved as draft! Redirecting to dashboard...","success"),setTimeout(()=>{j("/creator-dashboard")},1e3)}catch(n){console.error("Error saving manual:",n),c("Failed to save manual","error")}},K=()=>{if(!p.trim()){c("Please enter a manual title","warning");return}let e="Anonymous",t=null;try{const o=JSON.parse(localStorage.getItem("userData"));o&&(t=o,e=`${o.firstName} ${o.lastName}`)}catch(o){console.error("Error getting user data",o)}const s=t?.role==="admin"?"published":"pending",l=y?.trim()||"1.0",n={id:Date.now(),title:p,description:b,category:h,version:l,versions:[l],meta:`${h} ‚Ä¢ v${l}`,tags:m,views:0,likes:0,downloads:0,author:e,createdAt:new Date().toISOString().split("T")[0],updatedAt:new Date().toISOString().split("T")[0],difficulty:"Beginner",estimatedTime:"10 min",thumbnail:f,blocks:v,fileInfo:d,status:s};try{const Z=[...JSON.parse(localStorage.getItem("customManuals")||"[]"),n];localStorage.setItem("customManuals",JSON.stringify(Z)),console.log("Manual saved:",n),window.dispatchEvent(new Event("manualUpdated")),s==="pending"&&te().filter(w=>w.role==="admin").forEach(w=>{G({userId:String(w.id),message:`New manual pending approval: "${p}" by ${e}`,type:"info",link:"/admin-dashboard"})}),t?.role==="admin"?(c("Manual published successfully! Redirecting to manual page...","success"),setTimeout(()=>{j(`/manual/${n.id}`)},1e3)):(c("Manual created successfully and submitted for approval! Redirecting to dashboard...","success"),setTimeout(()=>{j("/creator-dashboard")},1e3))}catch(o){console.error("Error saving manual:",o),c("Failed to save manual","error")}},X=e=>{let t="block-input";return e.type==="heading"?t+=" block-heading":e.type==="quote"?t+=" block-quote":e.type==="code"&&(t+=" block-code"),t},Y=e=>{const t=e.imageUrl&&(e.imageUrl.startsWith("data:")||e.imageUrl.startsWith("http://")||e.imageUrl.startsWith("https://"));return a.jsx("div",{className:"image-block",children:t?a.jsxs("div",{className:"image-preview",children:[a.jsx("img",{src:e.imageUrl,alt:"Preview",className:"image-preview-img",onError:s=>{s.target.style.display="none",console.warn("Failed to load image:",e.imageUrl)}}),a.jsxs("div",{className:"image-controls",children:[a.jsx("input",{type:"text",placeholder:i("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{N(e.id,s.target.value),s.target.value.startsWith("http")&&U(e.id,s.target.value)},className:"image-url-input"}),a.jsxs("label",{className:"image-upload-btn",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>C(e.id,s.target.files[0]),style:{display:"none"}}),i("createManual.uploadImage")]})]})]}):a.jsx("div",{className:"image-placeholder",children:a.jsxs("div",{className:"image-upload-area",children:[a.jsxs("label",{className:"image-upload-label",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>C(e.id,s.target.files[0]),style:{display:"none"}}),a.jsx("div",{className:"upload-icon",children:"üì∑"}),a.jsx("div",{children:i("createManual.uploadImage")})]}),a.jsx("div",{className:"or-divider",children:i("common.or")}),a.jsx("input",{type:"text",placeholder:i("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{N(e.id,s.target.value),s.target.value.startsWith("http")&&U(e.id,s.target.value)},className:"image-url-input"})]})})})};return a.jsxs("div",{className:"root",children:[a.jsxs("div",{className:"page",children:[a.jsxs("section",{className:"editor-panel",children:[a.jsx("input",{className:"editor-title",placeholder:i("createManual.titlePlaceholder"),value:p,onChange:e=>I(e.target.value)}),a.jsx("textarea",{className:"editor-desc",rows:2,placeholder:i("createManual.contentPlaceholder"),value:b,onChange:e=>$(e.target.value)}),a.jsx("div",{className:"editor-divider"}),a.jsx("div",{className:"blocks",children:v.map(e=>a.jsxs("div",{className:`block ${e.showToolbar?"block-show-toolbar":""}`,children:[a.jsx("button",{type:"button",className:"block-plus",onClick:()=>z(e.id),children:"+"}),a.jsxs("div",{className:"block-toolbar",children:[a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="text"?"toolbar-btn-active":""}`,onClick:()=>g(e.id,"text"),children:"T"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="heading"?"toolbar-btn-active":""}`,onClick:()=>g(e.id,"heading"),children:"H"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="quote"?"toolbar-btn-active":""}`,onClick:()=>g(e.id,"quote"),children:"‚ùù"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="code"?"toolbar-btn-active":""}`,onClick:()=>g(e.id,"code"),children:"{ }"})," ",a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="image"?"toolbar-btn-active":""}`,onClick:()=>g(e.id,"image"),children:"üñºÔ∏è"}),a.jsx("button",{type:"button",className:"toolbar-btn toolbar-btn-delete",onClick:()=>L(e.id),style:{marginLeft:"auto",color:"#ef4444",borderColor:"#ef4444"},title:"Delete this block",children:"üóëÔ∏è"})]}),e.type==="image"?Y(e):a.jsx("textarea",{className:X(e),placeholder:e.type==="heading"?i("createManual.blockPlaceholders.heading"):e.type==="quote"?i("createManual.blockPlaceholders.quote"):e.type==="code"?i("createManual.blockPlaceholders.code"):i("createManual.blockPlaceholders.text"),value:e.value,onChange:t=>N(e.id,t.target.value)})]},e.id))}),a.jsxs("button",{type:"button",className:"btn-add-block",onClick:()=>k("text"),children:["+ ",i("createManual.addBlock")]})]})," ",a.jsxs("aside",{className:"meta-panel",children:[a.jsxs("div",{className:"meta-card",children:[a.jsx("div",{className:"meta-title",children:i("createManual.manualDetails")}),a.jsx("div",{className:"meta-caption",children:i("createManual.manualDetailsCaption")}),a.jsx("div",{className:"meta-field-label",children:i("createManual.thumbnailLabel")}),f&&a.jsx("div",{className:"thumbnail-preview",children:a.jsx("img",{src:f,alt:"Thumbnail preview",style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"8px",marginBottom:"8px"}})}),a.jsxs("label",{className:"thumb-box",children:[a.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:q}),M||"Click to upload thumbnail"]}),a.jsx("div",{className:"meta-field-label",children:"Category (‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà)"}),a.jsxs("select",{className:"meta-select",value:h,onChange:e=>P(e.target.value),children:[a.jsx("option",{children:"IT"}),a.jsx("option",{children:"Design"}),a.jsx("option",{children:"Marketing"}),a.jsx("option",{children:"HR"}),a.jsx("option",{children:"Operations"}),a.jsx("option",{children:"Customer Support"})]}),a.jsx("div",{className:"meta-field-label",children:"Tags"}),a.jsx("input",{className:"meta-input",placeholder:"Type tag and press Enter",onKeyDown:V}),a.jsxs("div",{className:"tag-box",children:[m.map((e,t)=>a.jsxs("span",{className:"tag-pill",onClick:()=>W(e),title:"Click to remove",children:[e," √ó"]},t)),m.length===0&&a.jsx("span",{style:{color:"var(--text-muted)",fontSize:"12px"},children:"No tags added yet"})]}),a.jsxs("div",{className:"meta-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Version"}),a.jsx("input",{className:"meta-input",placeholder:"‡πÄ‡∏ä‡πà‡∏ô 1.0 ‡∏´‡∏£‡∏∑‡∏≠ 2.1",value:y,onChange:e=>B(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Language"}),a.jsxs("select",{className:"meta-select",value:O,onChange:e=>R(e.target.value),children:[a.jsx("option",{children:"TH"}),a.jsx("option",{children:"EN"})]})]})]}),a.jsx("div",{className:"meta-field-label",style:{marginTop:10},children:"Manual file (PDF / DOCX / ZIP)"}),a.jsxs("label",{className:"file-btn",children:[a.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.zip",style:{display:"none"},onChange:J}),d?`üìé ${typeof d=="object"?d.name:d}`:"üìé Upload manual file"]})," ",d&&typeof d=="object"&&a.jsxs("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginTop:"4px"},children:[(d.size/1024).toFixed(1)," KB ‚Ä¢"," ",d.type||"Unknown type"]}),a.jsx("p",{className:"meta-note",children:"‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏Å‡∏£‡∏¥‡πà‡∏ô‡∏ô‡∏≥‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏î‡πâ"}),a.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[a.jsx("button",{type:"button",className:"draft-btn",onClick:H,children:"üíæ Draft"}),a.jsx("button",{type:"button",className:"publish-btn",onClick:K,style:{flex:1},children:"Publish"})]})]})," "]})]}),a.jsx(ae,{show:x.show,onHide:D,title:x.title,message:x.message,variant:x.variant})]})};export{ue as default};
