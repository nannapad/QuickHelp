import{j as a,l as re}from"./ui-HD-sGl07.js";import{u as de,h as ce,i as ue,r as d}from"./vendor-D6EYvIws.js";import{u as me}from"./utils-DIoNpZQj.js";import{u as he,A as pe}from"./AlertModal-C9C8unQ8.js";import{b as ge}from"./UserData-WMet23Oe.js";import{m as fe}from"./ManualData-BXjgqMK4.js";/* empty css                   */const Te=()=>{const{t:o}=me(),h=de(),{id:J}=ce(),[z]=ue(),c=J||z.get("edit"),{modalState:M,showAlert:p,hideAlert:q}=he(),[W,V]=d.useState(!0),[i,H]=d.useState(null),[g,D]=d.useState(""),[w,k]=d.useState(""),[S,f]=d.useState([{id:1,type:"text",value:"",showToolbar:!1}]),[E,F]=d.useState(null),[xe,K]=d.useState(null),[T,P]=d.useState(null),[x,Y]=d.useState(null),[j,B]=d.useState("IT"),[C,A]=d.useState(""),[X,Z]=d.useState("EN"),[b,U]=d.useState([]);d.useEffect(()=>{(()=>{try{const t=localStorage.getItem("userData"),s=localStorage.getItem("authToken");if(!t||!s){h("/login");return}const l=JSON.parse(t);if(l.role!=="creator"&&l.role!=="admin"){h("/");return}if(!c){h("/creator-dashboard");return}const n=[...JSON.parse(localStorage.getItem("customManuals")||"[]"),...fe].find(m=>String(m.id)===String(c)||m.id===parseInt(c));if(!n){p(o("editManual.notFound")||"Manual not found!","error"),setTimeout(()=>h("/creator-dashboard"),1500);return}const N=`${l.firstName} ${l.lastName}`;if(l.role!=="admin"&&n.author!==N&&n.author!==l.username){p(o("editManual.noPermission")||"You don't have permission to edit this manual!","error"),setTimeout(()=>h("/creator-dashboard"),1500);return}if(H(n),D(n.title||""),k(n.description||""),B(n.category||"IT"),U(n.tags||[]),console.log("âœ… Manual loaded successfully:",{id:n.id,title:n.title,status:n.status,hasBlocks:!!n.blocks,hasSections:!!n.sections}),n.thumbnail){P(n.thumbnail);const m=n.thumbnail.split("/");F(m[m.length-1])}let I="1.0";if(n.meta){const m=n.meta.match(/v(\d+\.\d+)/);m&&(I=m[1])}else n.version&&(I=n.version);A(I);let v=[];if(n.blocks&&n.blocks.length>0)v=n.blocks;else if(n.sections&&n.sections.length>0){let m=1;v=n.sections.flatMap(L=>[{id:m++,type:"heading",value:L.title,showToolbar:!1},{id:m++,type:"text",value:L.content,showToolbar:!1}])}else v=[{id:1,type:"text",value:n.description||"",showToolbar:!1}];f(v)}catch(t){console.error("Error loading manual:",t),h("/creator-dashboard")}finally{V(!1)}})()},[c]);const G=(e="text")=>{const t=Date.now()+Math.floor(Math.random()*1e3);f(s=>[...s,{id:t,type:e,value:"",imageFile:null,imageUrl:"",showToolbar:!1}])},Q=e=>{f(t=>t.map(s=>s.id===e?{...s,showToolbar:!s.showToolbar}:s))},y=(e,t)=>{f(s=>s.map(l=>l.id===e?{...l,type:t,value:t==="image"?"":l.value}:l))},$=(e,t)=>{f(s=>s.map(l=>l.id===e?{...l,value:t}:l))},_=e=>{if(S.length<=1){p("You must have at least one block in your manual.","warning");return}f(t=>t.filter(s=>s.id!==e))},R=(e,t)=>{if(t){const s=new FileReader;s.onloadend=()=>{f(l=>l.map(u=>u.id===e?{...u,imageFile:t,imageUrl:s.result,value:t.name}:u))},s.readAsDataURL(t)}},O=(e,t)=>{f(s=>s.map(l=>l.id===e?{...l,imageUrl:t,value:t}:l))},ee=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];F(t.name),K(t);const s=new FileReader;s.onloadend=()=>{P(s.result)},s.readAsDataURL(t)}},ae=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0],s=new FileReader;s.onloadend=()=>{const l={name:t.name,size:t.size,type:t.type,dataUrl:s.result};Y(l)},s.readAsDataURL(t)}},te=e=>{if(e.key==="Enter"){e.preventDefault();const t=e.target.value.trim();t&&!b.includes(t)&&(U([...b,t]),e.target.value="")}},se=e=>{U(b.filter(t=>t!==e))},le=()=>{if(!g.trim()){p("Please enter a manual title","warning");return}console.log("ðŸ’¾ Saving as draft...",{editId:c,title:g});let e="Anonymous",t=null;try{const l=JSON.parse(localStorage.getItem("userData"));l&&(t=l,e=`${l.firstName} ${l.lastName}`)}catch(l){console.error("Error getting user data",l)}const s={...i,title:g,description:w,category:j,meta:`${j} â€¢ ${C||"v1.0"}`,tags:b,author:e,updatedAt:new Date().toISOString().split("T")[0],difficulty:i.difficulty||"Beginner",estimatedTime:i.estimatedTime||"10 min",thumbnail:T||i.thumbnail,blocks:S,fileInfo:x||i.fileInfo,status:"draft"};try{const l=JSON.parse(localStorage.getItem("customManuals")||"[]"),u=l.findIndex(r=>String(r.id)===String(c)||r.id===parseInt(c));u!==-1?l[u]=s:l.push(s),localStorage.setItem("customManuals",JSON.stringify(l)),console.log("Manual saved as draft:",s),window.dispatchEvent(new Event("manualUpdated")),p("Manual saved as draft! Redirecting to dashboard...","success"),setTimeout(()=>{h("/creator-dashboard")},1e3)}catch(l){console.error("Error saving manual:",l),p("Failed to save manual","error")}},ne=()=>{if(!g.trim()){p("Please enter a manual title","warning");return}console.log("ðŸ“ Updating manual...",{editId:c,title:g,status:i?.status});let e="Anonymous",t=null;try{const r=JSON.parse(localStorage.getItem("userData"));r&&(t=r,e=`${r.firstName} ${r.lastName}`)}catch(r){console.error("Error getting user data",r)}let s;t?.role==="admin"?s=i.status==="draft"?"published":i.status||"published":t?.role==="creator"?i.status==="published"?s="pending":s=i.status||"pending":s=i.status||"published";const l=i.author||e,u={...i,title:g,description:w,category:j,meta:`${j} â€¢ ${C||"v1.0"}`,tags:b,author:l,updatedBy:t?`${t.firstName} ${t.lastName}`:void 0,updatedAt:new Date().toISOString().split("T")[0],difficulty:i.difficulty||"Beginner",estimatedTime:i.estimatedTime||"10 min",thumbnail:T||i.thumbnail,blocks:S,fileInfo:x||i.fileInfo,status:s};try{const r=JSON.parse(localStorage.getItem("customManuals")||"[]"),n=r.findIndex(N=>String(N.id)===String(c)||N.id===parseInt(c));n!==-1?r[n]=u:r.push(u),localStorage.setItem("customManuals",JSON.stringify(r)),console.log("Manual updated:",u),window.dispatchEvent(new Event("manualUpdated")),t?.role==="creator"&&i.status==="published"&&s==="pending"&&ge().filter(v=>v.role==="admin").forEach(v=>{re({userId:v.id,message:`Manual "${g}" by ${l} updated and needs re-approval`,type:"info",link:"/admin-dashboard"})}),t?.role==="admin"?(p("Manual updated successfully! Redirecting to manual page...","success"),setTimeout(()=>{h(`/manual/${c}`)},1e3)):(p("Manual updated successfully! Redirecting to dashboard...","success"),setTimeout(()=>{h("/creator-dashboard")},1e3))}catch(r){console.error("Error saving manual:",r),p("Failed to save manual","error")}},ie=e=>{let t="block-input";return e.type==="heading"?t+=" block-heading":e.type==="quote"?t+=" block-quote":e.type==="code"&&(t+=" block-code"),t},oe=e=>{const t=e.imageUrl&&(e.imageUrl.startsWith("data:")||e.imageUrl.startsWith("http://")||e.imageUrl.startsWith("https://"));return a.jsx("div",{className:"image-block",children:t?a.jsxs("div",{className:"image-preview",children:[a.jsx("img",{src:e.imageUrl,alt:"Preview",className:"image-preview-img",onError:s=>{s.target.style.display="none",console.warn("Failed to load image:",e.imageUrl)}}),a.jsxs("div",{className:"image-controls",children:[a.jsx("input",{type:"text",placeholder:o("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{$(e.id,s.target.value),s.target.value.startsWith("http")&&O(e.id,s.target.value)},className:"image-url-input"}),a.jsxs("label",{className:"image-upload-btn",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>R(e.id,s.target.files[0]),style:{display:"none"}}),o("createManual.uploadImage")]})]})]}):a.jsx("div",{className:"image-placeholder",children:a.jsxs("div",{className:"image-upload-area",children:[a.jsxs("label",{className:"image-upload-label",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>R(e.id,s.target.files[0]),style:{display:"none"}}),a.jsx("div",{className:"upload-icon",children:"ðŸ“·"}),a.jsx("div",{children:o("createManual.uploadImage")})]}),a.jsx("div",{className:"or-divider",children:o("common.or")}),a.jsx("input",{type:"text",placeholder:o("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{$(e.id,s.target.value),s.target.value.startsWith("http")&&O(e.id,s.target.value)},className:"image-url-input"})]})})})};return W?a.jsx("div",{className:"root",children:a.jsx("div",{className:"page",children:a.jsx("div",{className:"loading-state",children:a.jsx("h2",{children:o("editManual.loading")||"Loading manual..."})})})}):i?a.jsxs("div",{className:"root",children:[a.jsxs("div",{className:"page",children:[a.jsxs("section",{className:"editor-panel",children:[a.jsx("input",{className:"editor-title",placeholder:o("createManual.titlePlaceholder"),value:g,onChange:e=>D(e.target.value)}),a.jsx("textarea",{className:"editor-desc",rows:2,placeholder:o("createManual.contentPlaceholder"),value:w,onChange:e=>k(e.target.value)}),a.jsx("div",{className:"editor-divider"}),a.jsx("div",{className:"blocks",children:S.map(e=>a.jsxs("div",{className:`block ${e.showToolbar?"block-show-toolbar":""}`,children:[a.jsx("button",{type:"button",className:"block-plus",onClick:()=>Q(e.id),children:"+"}),a.jsxs("div",{className:"block-toolbar",children:[a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="text"?"toolbar-btn-active":""}`,onClick:()=>y(e.id,"text"),children:"T"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="heading"?"toolbar-btn-active":""}`,onClick:()=>y(e.id,"heading"),children:"H"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="quote"?"toolbar-btn-active":""}`,onClick:()=>y(e.id,"quote"),children:"â"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="code"?"toolbar-btn-active":""}`,onClick:()=>y(e.id,"code"),children:"{ }"})," ",a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="image"?"toolbar-btn-active":""}`,onClick:()=>y(e.id,"image"),children:"ðŸ–¼ï¸"}),a.jsx("button",{type:"button",className:"toolbar-btn toolbar-btn-delete",onClick:()=>_(e.id),style:{marginLeft:"auto",color:"#ef4444",borderColor:"#ef4444"},title:"Delete this block",children:"ðŸ—‘ï¸"})]}),e.type==="image"?oe(e):a.jsx("textarea",{className:ie(e),placeholder:e.type==="heading"?o("createManual.blockPlaceholders.heading"):e.type==="quote"?o("createManual.blockPlaceholders.quote"):e.type==="code"?o("createManual.blockPlaceholders.code"):o("createManual.blockPlaceholders.text"),value:e.value,onChange:t=>$(e.id,t.target.value)})]},e.id))}),a.jsxs("button",{type:"button",className:"btn-add-block",onClick:()=>G("text"),children:["+ ",o("createManual.addBlock")]})]}),a.jsxs("aside",{className:"meta-panel",children:[a.jsxs("div",{className:"meta-card",children:[a.jsx("div",{className:"meta-title",children:"Manual details"}),a.jsx("div",{className:"meta-caption",children:"à¸à¸³à¸«à¸™à¸”à¸«à¸¡à¸§à¸”à¹ƒà¸«à¸à¹ˆ à¹à¸—à¹‡à¸ à¹à¸¥à¸°à¹„à¸Ÿà¸¥à¹Œà¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸ˆà¸£à¸´à¸‡"}),a.jsx("div",{className:"meta-field-label",children:"Thumbnail"}),T&&a.jsx("div",{className:"thumbnail-preview",children:a.jsx("img",{src:T,alt:"Thumbnail preview",style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"8px",marginBottom:"8px"}})}),a.jsxs("label",{className:"thumb-box",children:[a.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:ee}),E||"Click to upload thumbnail"]}),a.jsx("div",{className:"meta-field-label",children:"Category (à¸«à¸¡à¸§à¸”à¹ƒà¸«à¸à¹ˆ)"}),a.jsxs("select",{className:"meta-select",value:j,onChange:e=>B(e.target.value),children:[a.jsx("option",{children:"IT"}),a.jsx("option",{children:"Design"}),a.jsx("option",{children:"Marketing"}),a.jsx("option",{children:"HR"}),a.jsx("option",{children:"Operations"}),a.jsx("option",{children:"Customer Support"})]}),a.jsx("div",{className:"meta-field-label",children:"Tags"}),a.jsx("input",{className:"meta-input",placeholder:"Type tag and press Enter",onKeyDown:te}),a.jsxs("div",{className:"tag-box",children:[b.map((e,t)=>a.jsxs("span",{className:"tag-pill",onClick:()=>se(e),title:"Click to remove",children:[e," Ã—"]},t)),b.length===0&&a.jsx("span",{style:{color:"var(--text-muted)",fontSize:"12px"},children:"No tags added yet"})]}),a.jsxs("div",{className:"meta-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Version"}),a.jsx("input",{className:"meta-input",placeholder:"à¹€à¸Šà¹ˆà¸™ 1.0 à¸«à¸£à¸·à¸­ 2.1",value:C,onChange:e=>A(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Language"}),a.jsxs("select",{className:"meta-select",value:X,onChange:e=>Z(e.target.value),children:[a.jsx("option",{children:"TH"}),a.jsx("option",{children:"EN"})]})]})]}),a.jsx("div",{className:"meta-field-label",style:{marginTop:10},children:"Manual file (PDF / DOCX / ZIP)"}),a.jsxs("label",{className:"file-btn",children:[a.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.zip",style:{display:"none"},onChange:ae}),x?`ðŸ“Ž ${typeof x=="object"?x.name:x}`:i?.fileInfo?`ðŸ“Ž ${typeof i.fileInfo=="object"?i.fileInfo.name:i.fileInfo}`:"ðŸ“Ž Upload manual file"]})," ",(x||i?.fileInfo)&&a.jsx("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginTop:"4px"},children:(()=>{const e=x||i.fileInfo;return typeof e=="object"?`${(e.size/1024).toFixed(1)} KB â€¢ ${e.type||"Unknown type"}`:"File uploaded"})()}),a.jsx("p",{className:"meta-note",children:"à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹ƒà¸™à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¹€à¸žà¸µà¸¢à¸‡à¹€à¸à¸£à¸´à¹ˆà¸™à¸™à¸³à¹à¸¥à¸°à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸šà¸²à¸‡à¸ªà¹ˆà¸§à¸™ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸”à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œà¸”à¹‰à¸²à¸™à¸šà¸™à¹€à¸žà¸·à¹ˆà¸­à¸­à¹ˆà¸²à¸™à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸‰à¸šà¸±à¸šà¹€à¸•à¹‡à¸¡à¹„à¸”à¹‰"})," ",a.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[a.jsxs("button",{type:"button",className:"draft-btn",onClick:le,style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"1px solid var(--border)",background:"transparent",color:"var(--text)",cursor:"pointer",fontSize:"14px",fontWeight:500},children:["ðŸ’¾ ",o("editManual.saveAsDraft")||"Save as Draft"]}),a.jsx("button",{type:"button",className:"publish-btn",onClick:ne,style:{flex:1},children:o("editManual.updateManual")||"Update Manual"})]})]})," "]})]}),a.jsx(pe,{show:M.show,onHide:q,title:M.title,message:M.message,variant:M.variant})]}):a.jsx("div",{className:"root",children:a.jsx("div",{className:"page",children:a.jsxs("div",{className:"error-state",children:[a.jsx("h2",{children:o("editManual.notFound")||"Manual not found"}),a.jsx("button",{onClick:()=>h("/creator-dashboard"),children:o("editManual.backToDashboard")||"Back to Dashboard"})]})})})};export{Te as default};
