import{j as t}from"./ui-C0p69nPY.js";import{u as ne,h as oe,i as de,r as n}from"./vendor-D6EYvIws.js";import{u as ce}from"./utils-dQ_ya9vc.js";import{u as ue,A as me}from"./AlertModal-DN7yXDQv.js";import{m as he}from"./ManualData-CCWVZZls.js";/* empty css                   */const ye=()=>{const{t:l}=ce(),d=ne(),{id:A}=oe(),[W]=de(),u=A||W.get("edit"),{modalState:v,showAlert:m,hideAlert:q}=ue(),[J,L]=n.useState(!0),[h,V]=n.useState(null),[f,M]=n.useState(""),[D,I]=n.useState(""),[j,p]=n.useState([{id:1,type:"text",value:"",showToolbar:!1}]),[U,k]=n.useState(null),[pe,z]=n.useState(null),[N,E]=n.useState(null),[P,H]=n.useState(null),[x,$]=n.useState("IT"),[S,F]=n.useState(""),[Y,K]=n.useState("EN"),[g,T]=n.useState([]);n.useEffect(()=>{(()=>{try{const s=localStorage.getItem("userData"),a=localStorage.getItem("authToken");if(!s||!a){d("/login");return}const r=JSON.parse(s);if(r.role!=="creator"&&r.role!=="admin"){d("/");return}if(!u){d("/creator-dashboard");return}const i=[...JSON.parse(localStorage.getItem("customManuals")||"[]"),...he].find(o=>String(o.id)===String(u)||o.id===parseInt(u));if(!i){m(l("editDraft.notFound")||"Draft not found!","error"),setTimeout(()=>d("/creator-dashboard"),1500);return}if(i.status!=="draft"){d(`/edit-manual/${u}`);return}const ie=`${r.firstName} ${r.lastName}`;if(r.role!=="admin"&&i.author!==ie&&i.author!==r.username){m(l("editDraft.noPermission")||"You don't have permission to edit this draft!","error"),setTimeout(()=>d("/creator-dashboard"),1500);return}if(V(i),M(i.title||""),I(i.description||""),$(i.category||"IT"),T(i.tags||[]),i.thumbnail){E(i.thumbnail);const o=i.thumbnail.split("/");k(o[o.length-1])}let C="1.0";if(i.meta){const o=i.meta.match(/v(\d+\.\d+)/);o&&(C=o[1])}else i.version&&(C=i.version);F(C);let y=[];if(i.blocks&&i.blocks.length>0)y=i.blocks;else if(i.sections&&i.sections.length>0){let o=1;y=i.sections.flatMap(R=>[{id:o++,type:"heading",value:R.title,showToolbar:!1},{id:o++,type:"text",value:R.content,showToolbar:!1}])}else y=[{id:1,type:"text",value:i.description||"",showToolbar:!1}];p(y)}catch(s){console.error("Error loading draft:",s),d("/creator-dashboard")}finally{L(!1)}})()},[u]);const X=(e="text")=>{const s=Date.now()+Math.floor(Math.random()*1e3);p(a=>[...a,{id:s,type:e,value:"",imageFile:null,imageUrl:"",showToolbar:!1}])},Z=e=>{p(s=>s.map(a=>a.id===e?{...a,showToolbar:!a.showToolbar}:a))},b=(e,s)=>{p(a=>a.map(r=>r.id===e?{...r,type:s,value:s==="image"?"":r.value}:r))},w=(e,s)=>{p(a=>a.map(r=>r.id===e?{...r,value:s}:r))},G=e=>{if(j.length<=1){m(l("editDraft.minBlockWarning")||"You must have at least one block in your manual.","warning");return}p(s=>s.filter(a=>a.id!==e))},B=(e,s)=>{if(s){const a=new FileReader;a.onloadend=()=>{p(r=>r.map(c=>c.id===e?{...c,imageFile:s,imageUrl:a.result,value:s.name}:c))},a.readAsDataURL(s)}},O=(e,s)=>{p(a=>a.map(r=>r.id===e?{...r,imageUrl:s,value:s}:r))},Q=e=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];k(s.name),z(s);const a=new FileReader;a.onloadend=()=>{E(a.result)},a.readAsDataURL(s)}},_=e=>{e.target.files&&e.target.files[0]&&H(e.target.files[0].name)},ee=e=>{if(e.key==="Enter"){e.preventDefault();const s=e.target.value.trim();s&&!g.includes(s)&&(T([...g,s]),e.target.value="")}},te=e=>{T(g.filter(s=>s!==e))},ae=()=>{if(!f.trim()){m(l("editDraft.titleRequired")||"Please enter a manual title","warning");return}let e="Anonymous";try{const a=JSON.parse(localStorage.getItem("userData"));a&&(e=`${a.firstName} ${a.lastName}`)}catch(a){console.error("Error getting user data",a)}const s={...h,title:f,description:D,category:x,meta:`${x} â€¢ ${S||"v1.0"}`,tags:g,author:e,updatedAt:new Date().toISOString().split("T")[0],difficulty:h.difficulty||"Beginner",estimatedTime:h.estimatedTime||"10 min",thumbnail:N||h.thumbnail,blocks:j,status:"draft"};try{const a=JSON.parse(localStorage.getItem("customManuals")||"[]"),r=a.findIndex(c=>String(c.id)===String(u)||c.id===parseInt(u));r!==-1?a[r]=s:a.push(s),localStorage.setItem("customManuals",JSON.stringify(a)),window.dispatchEvent(new Event("manualUpdated")),m(l("editDraft.draftUpdated")||"Draft updated successfully! Redirecting to dashboard...","success"),setTimeout(()=>{d("/creator-dashboard")},1e3)}catch(a){console.error("Error updating draft:",a),m(l("editDraft.updateError")||"Failed to update draft","error")}},se=()=>{if(!f.trim()){m(l("editDraft.titleRequired")||"Please enter a manual title","warning");return}let e="Anonymous";try{const a=JSON.parse(localStorage.getItem("userData"));a&&(e=`${a.firstName} ${a.lastName}`)}catch(a){console.error("Error getting user data",a)}const s={...h,title:f,description:D,category:x,meta:`${x} â€¢ ${S||"v1.0"}`,tags:g,author:e,updatedAt:new Date().toISOString().split("T")[0],difficulty:h.difficulty||"Beginner",estimatedTime:h.estimatedTime||"10 min",thumbnail:N||h.thumbnail,blocks:j,status:"pending"};try{const a=JSON.parse(localStorage.getItem("customManuals")||"[]"),r=a.findIndex(c=>String(c.id)===String(u)||c.id===parseInt(u));r!==-1?a[r]=s:a.push(s),localStorage.setItem("customManuals",JSON.stringify(a)),window.dispatchEvent(new Event("manualUpdated")),m(l("editDraft.publishSuccess")||"Draft published successfully! Waiting for admin approval...","success"),setTimeout(()=>{d("/creator-dashboard")},1e3)}catch(a){console.error("Error publishing draft:",a),m(l("editDraft.publishError")||"Failed to publish draft","error")}},le=e=>{let s="block-input";return e.type==="heading"?s+=" block-heading":e.type==="quote"?s+=" block-quote":e.type==="code"&&(s+=" block-code"),s},re=e=>{const s=e.imageUrl&&(e.imageUrl.startsWith("data:")||e.imageUrl.startsWith("http://")||e.imageUrl.startsWith("https://"));return t.jsx("div",{className:"image-block",children:s?t.jsxs("div",{className:"image-preview",children:[t.jsx("img",{src:e.imageUrl,alt:"Preview",className:"image-preview-img",onError:a=>{a.target.style.display="none"}}),t.jsxs("div",{className:"image-controls",children:[t.jsx("input",{type:"text",placeholder:l("createManual.blockPlaceholders.image"),value:e.value,onChange:a=>{w(e.id,a.target.value),a.target.value.startsWith("http")&&O(e.id,a.target.value)},className:"image-url-input"}),t.jsxs("label",{className:"image-upload-btn",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:a=>B(e.id,a.target.files[0]),style:{display:"none"}}),l("createManual.uploadImage")]})]})]}):t.jsx("div",{className:"image-placeholder",children:t.jsxs("div",{className:"image-upload-area",children:[t.jsxs("label",{className:"image-upload-label",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:a=>B(e.id,a.target.files[0]),style:{display:"none"}}),t.jsx("div",{className:"upload-icon",children:"ðŸ“·"}),t.jsx("div",{children:l("createManual.uploadImage")})]}),t.jsx("div",{className:"or-divider",children:l("common.or")}),t.jsx("input",{type:"text",placeholder:l("createManual.blockPlaceholders.image"),value:e.value,onChange:a=>{w(e.id,a.target.value),a.target.value.startsWith("http")&&O(e.id,a.target.value)},className:"image-url-input"})]})})})};return J?t.jsx("div",{className:"root",children:t.jsx("div",{className:"page",children:t.jsx("div",{className:"loading-state",children:t.jsx("h2",{children:l("editDraft.loading")||"Loading draft..."})})})}):h?t.jsxs("div",{className:"root",children:[t.jsxs("div",{className:"page",children:[t.jsxs("section",{className:"editor-panel",children:[t.jsx("input",{className:"editor-title",placeholder:l("createManual.titlePlaceholder"),value:f,onChange:e=>M(e.target.value)}),t.jsx("textarea",{className:"editor-desc",rows:2,placeholder:l("createManual.contentPlaceholder"),value:D,onChange:e=>I(e.target.value)}),t.jsx("div",{className:"editor-divider"}),t.jsx("div",{className:"blocks",children:j.map(e=>t.jsxs("div",{className:`block ${e.showToolbar?"block-show-toolbar":""}`,children:[t.jsx("button",{type:"button",className:"block-plus",onClick:()=>Z(e.id),children:"+"}),t.jsxs("div",{className:"block-toolbar",children:[t.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="text"?"toolbar-btn-active":""}`,onClick:()=>b(e.id,"text"),children:"T"}),t.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="heading"?"toolbar-btn-active":""}`,onClick:()=>b(e.id,"heading"),children:"H"}),t.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="quote"?"toolbar-btn-active":""}`,onClick:()=>b(e.id,"quote"),children:"â"}),t.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="code"?"toolbar-btn-active":""}`,onClick:()=>b(e.id,"code"),children:"{ }"}),t.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="image"?"toolbar-btn-active":""}`,onClick:()=>b(e.id,"image"),children:"ðŸ–¼ï¸"}),t.jsx("button",{type:"button",className:"toolbar-btn toolbar-btn-delete",onClick:()=>G(e.id),style:{marginLeft:"auto",color:"#ef4444",borderColor:"#ef4444"},title:"Delete this block",children:"ðŸ—‘ï¸"})]}),e.type==="image"?re(e):t.jsx("textarea",{className:le(e),placeholder:e.type==="heading"?l("createManual.blockPlaceholders.heading"):e.type==="quote"?l("createManual.blockPlaceholders.quote"):e.type==="code"?l("createManual.blockPlaceholders.code"):l("createManual.blockPlaceholders.text"),value:e.value,onChange:s=>w(e.id,s.target.value)})]},e.id))}),t.jsxs("button",{type:"button",className:"btn-add-block",onClick:()=>X("text"),children:["+ ",l("createManual.addBlock")]})]}),t.jsx("aside",{className:"meta-panel",children:t.jsxs("div",{className:"meta-card",children:[t.jsx("div",{className:"meta-title",children:l("editDraft.draftDetails")||"Draft Details"}),t.jsx("div",{className:"meta-caption",children:l("editDraft.draftCaption")||"Configure your draft before publishing"}),t.jsx("div",{className:"meta-field-label",children:"Thumbnail"}),N&&t.jsx("div",{className:"thumbnail-preview",children:t.jsx("img",{src:N,alt:"Thumbnail preview",style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"8px",marginBottom:"8px"}})}),t.jsxs("label",{className:"thumb-box",children:[t.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:Q}),U||"Click to upload thumbnail"]}),t.jsx("div",{className:"meta-field-label",children:"Category (à¸«à¸¡à¸§à¸”à¹ƒà¸«à¸à¹ˆ)"}),t.jsxs("select",{className:"meta-select",value:x,onChange:e=>$(e.target.value),children:[t.jsx("option",{children:"IT"}),t.jsx("option",{children:"Design"}),t.jsx("option",{children:"Marketing"}),t.jsx("option",{children:"HR"}),t.jsx("option",{children:"Operations"}),t.jsx("option",{children:"Customer Support"})]}),t.jsx("div",{className:"meta-field-label",children:"Tags"}),t.jsx("input",{className:"meta-input",placeholder:"Type tag and press Enter",onKeyDown:ee}),t.jsxs("div",{className:"tag-box",children:[g.map((e,s)=>t.jsxs("span",{className:"tag-pill",onClick:()=>te(e),title:"Click to remove",children:[e," Ã—"]},s)),g.length===0&&t.jsx("span",{style:{color:"var(--text-muted)",fontSize:"12px"},children:"No tags added yet"})]}),t.jsxs("div",{className:"meta-row",children:[t.jsxs("div",{children:[t.jsx("div",{className:"meta-field-label",children:"Version"}),t.jsx("input",{className:"meta-input",placeholder:"à¹€à¸Šà¹ˆà¸™ 1.0 à¸«à¸£à¸·à¸­ 2.1",value:S,onChange:e=>F(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"meta-field-label",children:"Language"}),t.jsxs("select",{className:"meta-select",value:Y,onChange:e=>K(e.target.value),children:[t.jsx("option",{children:"TH"}),t.jsx("option",{children:"EN"})]})]})]}),t.jsx("div",{className:"meta-field-label",style:{marginTop:10},children:"Manual file (PDF / DOCX / ZIP)"}),t.jsxs("label",{className:"file-btn",children:[t.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.zip",style:{display:"none"},onChange:_}),P?`ðŸ“Ž ${P}`:"ðŸ“Ž Upload manual file"]}),t.jsx("p",{className:"meta-note",children:"à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹ƒà¸™à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¹€à¸žà¸µà¸¢à¸‡à¹€à¸à¸£à¸´à¹ˆà¸™à¸™à¸³à¹à¸¥à¸°à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸šà¸²à¸‡à¸ªà¹ˆà¸§à¸™ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸”à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œà¸”à¹‰à¸²à¸™à¸šà¸™à¹€à¸žà¸·à¹ˆà¸­à¸­à¹ˆà¸²à¸™à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸‰à¸šà¸±à¸šà¹€à¸•à¹‡à¸¡à¹„à¸”à¹‰"}),t.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[t.jsxs("button",{type:"button",className:"draft-btn",onClick:ae,style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"1px solid var(--border)",background:"transparent",color:"var(--text)",cursor:"pointer",fontSize:"14px",fontWeight:500},children:["ðŸ’¾ ",l("editDraft.updateDraft")||"Update Draft"]}),t.jsxs("button",{type:"button",className:"publish-btn",onClick:se,style:{flex:1,padding:"10px 16px",borderRadius:"8px",background:"linear-gradient(135deg, #10b981, #059669)",color:"#ffffff",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:600,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)"},children:["ðŸ“¤ ",l("editDraft.publishDraft")||"Publish"]})]})]})})]}),t.jsx(me,{show:v.show,onHide:q,title:v.title,message:v.message,variant:v.variant})]}):t.jsx("div",{className:"root",children:t.jsx("div",{className:"page",children:t.jsxs("div",{className:"error-state",children:[t.jsx("h2",{children:l("editDraft.notFound")||"Draft not found"}),t.jsx("button",{onClick:()=>d("/creator-dashboard"),children:l("editDraft.backToDashboard")||"Back to Dashboard"})]})})})};export{ye as default};
