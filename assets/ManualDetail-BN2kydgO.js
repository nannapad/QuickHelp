import{g as ge,h as pe,k as xe,l as ve,j as t,m as G,b as Ne,t as je}from"./ui-C0p69nPY.js";import{h as Ce,u as ye,r}from"./vendor-D6EYvIws.js";import{u as we,A as Se}from"./AlertModal-DN7yXDQv.js";import"./index-DmxUvXmh.js";import{m as N}from"./ManualData-CCWVZZls.js";import{g as ke}from"./versionControl-IdIhSDzI.js";import"./utils-dQ_ya9vc.js";const Y=[{id:1,manualId:1,userId:1,author:"John Doe",text:"Great guide! Very helpful for setting up VS Code.",createdAt:"2024-11-20"},{id:2,manualId:1,userId:2,author:"Maria Garcia",text:"Thanks for the detailed instructions. This saved me a lot of time!",createdAt:"2024-11-21"},{id:3,manualId:2,userId:1,author:"John Doe",text:"The Figma integration steps are spot on. Worked perfectly!",createdAt:"2024-11-19"},{id:4,manualId:3,userId:3,author:"Sarah Johnson",text:"This onboarding checklist is comprehensive. Will definitely use it for new hires.",createdAt:"2024-11-18"},{id:5,manualId:2,userId:3,author:"Sarah Johnson",text:"Could you add more screenshots? Visual examples would help.",createdAt:"2024-11-22"}],Ue=()=>{const{id:l}=Ce(),j=ye(),[C,$]=r.useState(!1),[y,F]=r.useState(!1),[E,w]=r.useState(!1),[Ie,z]=r.useState(0),[be,V]=r.useState(0),[u,g]=r.useState(""),[S,Q]=r.useState([]),[x,M]=r.useState(null),[X,J]=r.useState(!1),[c,Z]=r.useState(null),[k,P]=r.useState(""),[B,O]=r.useState(!1),[D,v]=r.useState([]),[T,_]=r.useState(0),[ee,A]=r.useState(null),[I,b]=r.useState(""),{modalState:p,showAlert:h,showConfirm:te,hideAlert:se}=we(),s=r.useMemo(()=>{if(!N||N.length===0)return null;const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),a=new Set(e.map(n=>n.id)),o=N.filter(n=>!a.has(n.id)),i=[...e,...o];return i.find(n=>String(n.id)===String(l))||i[0]},[l,T]),ae=r.useMemo(()=>{if(!c||!s)return!1;if(c.role==="admin")return!0;if(c.role==="creator"){const e=`${c.firstName} ${c.lastName}`;return s.author===e||s.author===c.username}return!1},[c,s]);r.useEffect(()=>{if(!s)return;const e=ke(s.id);Q(e),!u&&e.length>0?(g(e[0].version),M(e[0])):!u&&s.version&&g(s.version)},[s?.id,T]),r.useEffect(()=>{if(!u||!s)return;const e=S.find(a=>a.version===u);M(e||null)},[u,S,s]);const d=r.useMemo(()=>s?x&&x.data||s:null,[s,x]);r.useEffect(()=>{const e=localStorage.getItem("userData");if(e)try{const o=JSON.parse(e);if(Z(o),l){const n=ge()[l]||{likedBy:[]};$(n.likedBy?n.likedBy.includes(parseInt(o.id)):!1),F(pe(o.id,l))}}catch(o){console.error("Error parsing user data:",o)}if(l)try{const i=JSON.parse(localStorage.getItem("manualComments")||"{}")[l]||[];v(i)}catch(o){console.error("Error loading comments:",o),v([])}if(l){const o=localStorage.getItem("userData");let i=null;if(o)try{i=JSON.parse(o).id}catch{}const n=xe(l,i),m=ve(l);z(n),V(m.likes||0)}const a=()=>{if(_(o=>o+1),l)try{const i=JSON.parse(localStorage.getItem("manualComments")||"{}")[l]||[];v(i)}catch(o){console.error("Error reloading comments:",o)}};return window.addEventListener("storage",a),window.addEventListener("manualUpdated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("manualUpdated",a)}},[l]);const R=r.useMemo(()=>{const e=new Set;return s?.versions&&s.versions.forEach(a=>e.add(a)),S.forEach(a=>e.add(a.version)),s?.version&&e.add(s.version),Array.from(e).sort((a,o)=>{const[i,n]=a.split(".").map(Number),[m,f]=o.split(".").map(Number);return i!==m?m-i:f-n})},[s,S]),W=r.useMemo(()=>x?.changes?x.changes:null,[x]);r.useEffect(()=>{if(s&&s.version)g(s.version);else if(s&&s.versions&&s.versions.length>0)g(s.versions[0]);else if(s&&s.meta){const e=s.meta.match(/v(\d+\.\d+)/);e&&g(e[1])}},[s]);const H=r.useMemo(()=>{if(!N||!s)return[];const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),a=new Set(e.map(n=>n.id)),o=N.filter(n=>!a.has(n.id));return[...e,...o].filter(n=>n.id===s.id||(n.status||"published")!=="published"?!1:n.category===s.category||n.tags?.some(f=>s.tags?.includes(f))).slice(0,3)},[s,T]),L=r.useMemo(()=>s?[...Y?Y.filter(a=>String(a.manualId)===String(s.id)):[],...D].sort((a,o)=>new Date(o.createdAt)-new Date(a.createdAt)):D,[s,D]),ne=()=>{if(!c)return;const{liked:e,likes:a}=Ne(l,c.id);$(e),V(a)},oe=()=>{if(!c||!s)return;const e=je(c.id,s);F(e),e&&h("Bookmarked! You will be notified when this manual is updated.","success","Bookmark Added")},re=async()=>{try{await navigator.clipboard.writeText(window.location.href),w(!0),setTimeout(()=>{w(!1)},2e3),navigator.share&&await navigator.share({title:s.title,text:s.description,url:window.location.href})}catch(e){console.error("Error sharing:",e),w(!0),setTimeout(()=>{w(!1)},2e3)}},ie=e=>{const a=e.target.value;g(a),J(!0)},K=e=>{const a=document.getElementById(`section-${e}`);a&&a.scrollIntoView({behavior:"smooth"})},le=e=>{const a=new Date(e),i=Math.abs(new Date-a),n=Math.floor(i/(1e3*60*60*24)),m=Math.floor(i/(1e3*60*60)),f=Math.floor(i/(1e3*60)),U=Math.floor(i/1e3);return n>0?n===1?"1 day ago":`${n} days ago`:m>0?m===1?"1 hour ago":`${m} hours ago`:f>0?f===1?"1 minute ago":`${f} minutes ago`:U>0?U===1?"1 second ago":`${U} seconds ago`:"Just now"},q=async()=>{if(!(!k.trim()||!c)){O(!0);try{const e={id:Date.now(),manualId:parseInt(l),userId:c.id,author:`${c.firstName} ${c.lastName}`,text:k.trim(),createdAt:new Date().toISOString()},a=JSON.parse(localStorage.getItem("manualComments")||"{}"),o=a[l]||[];o.unshift(e),a[l]=o,localStorage.setItem("manualComments",JSON.stringify(a)),v(i=>[e,...i]),P(""),window.dispatchEvent(new Event("manualUpdated")),setTimeout(()=>{h("Comment posted successfully!","success","Comment Posted")},100)}catch(e){console.error("Error posting comment:",e),h("Failed to post comment. Please try again.","error","Error")}finally{O(!1)}}},ce=e=>{e.key==="Enter"&&(e.ctrlKey||e.metaKey)&&q()},de=e=>{A(e.id),b(e.text)},me=e=>{if(!I.trim()){h("Comment cannot be empty","error","Error");return}try{const a=JSON.parse(localStorage.getItem("manualComments")||"{}"),i=(a[l]||[]).map(n=>n.id===e?{...n,text:I.trim(),edited:!0}:n);a[l]=i,localStorage.setItem("manualComments",JSON.stringify(a)),v(n=>n.map(m=>m.id===e?{...m,text:I.trim(),edited:!0}:m)),A(null),b(""),window.dispatchEvent(new Event("manualUpdated")),h("Comment updated successfully!","success","Updated")}catch(a){console.error("Error updating comment:",a),h("Failed to update comment","error","Error")}},ue=()=>{A(null),b("")},he=e=>{te("Delete this comment? This action cannot be undone.",()=>fe(e.id),"danger","Confirm Deletion","Delete","Cancel")},fe=e=>{try{const a=JSON.parse(localStorage.getItem("manualComments")||"{}"),i=(a[l]||[]).filter(n=>n.id!==e);a[l]=i,localStorage.setItem("manualComments",JSON.stringify(a)),v(n=>n.filter(m=>m.id!==e)),window.dispatchEvent(new Event("manualUpdated")),h("Comment deleted successfully!","success","Deleted")}catch(a){console.error("Error deleting comment:",a),h("Failed to delete comment","error","Error")}};return s?t.jsxs("main",{className:"manualPage",children:[t.jsxs("div",{className:"manualPageInner",children:[t.jsxs("div",{className:"breadcrumbRow",children:[" ",t.jsx("button",{className:"backLink",type:"button",onClick:()=>j(-1),children:"â† Back"}),t.jsxs("div",{className:"breadcrumb",children:[d?.category,d?.subCategory?` â€¢ ${d.subCategory}`:"",` â€¢ ${d?.title}`]})]}),t.jsxs("div",{className:"grid",children:[" ",t.jsxs("article",{className:"left",children:[t.jsxs("header",{className:"header",children:[t.jsxs("div",{className:"topRow",children:[t.jsx("h1",{className:"title",children:d?.title}),R.length>1&&t.jsxs("div",{className:"versionRow",children:[t.jsxs("div",{className:"versionWrapper",children:[t.jsx("span",{className:"versionLabel",children:"Version"}),t.jsx("select",{className:"versionSelect",value:u,onChange:ie,"aria-label":"Select version",children:R.map(e=>t.jsxs("option",{value:e,children:[e," ",e===s?.version?"(Latest)":""]},e))})]}),t.jsx("div",{className:"versionLine"})]})]}),t.jsxs("div",{className:"bottomRow",children:[t.jsxs("div",{className:"authorMetaRow",children:[t.jsx("div",{className:"authorAvatar",title:s.author,children:s.author.charAt(0).toUpperCase()}),t.jsxs("div",{className:"authorDetails",children:[t.jsxs("div",{className:"authorTop",children:[t.jsx("span",{className:"authorName",children:s.author}),t.jsx("span",{className:"metaSeparator",children:"â€¢"}),t.jsx("span",{className:"categoryBadge",children:s.category})]}),t.jsx("div",{className:"authorBottom",children:t.jsxs("span",{className:"metaText",children:["Updated ",s.updatedAt]})})]})]}),t.jsxs("div",{className:"headerActions",children:[ae&&t.jsx("button",{className:"actionBtn editBtn",onClick:()=>j(`/edit-manual/${s.id}`),title:"Edit this manual",children:"Edit"}),t.jsx("button",{className:`actionBtn ${C?"liked":""}`,onClick:ne,"aria-pressed":C,title:C?"Unlike this manual":"Like this manual",children:C?"Liked":"Like"})," ",t.jsx("button",{className:`actionBtn ${y?"bookmarked":""}`,onClick:oe,"aria-pressed":y,title:y?"Remove bookmark":"Bookmark this manual",children:y?"Bookmarked":"Bookmark"})," ",t.jsx("button",{className:`actionBtn ${E?"copied":""}`,onClick:re,title:E?"Link copied!":"Share this manual",children:E?"Copied!":"Share"})]})," "]})]}),X&&W&&t.jsxs("div",{className:"changelogBanner",children:[t.jsxs("div",{className:"changelogHeader",children:[t.jsxs("h3",{children:["What's new in version ",u]}),t.jsx("button",{className:"closeChangelog",onClick:()=>J(!1),children:"Ã—"})]}),t.jsx("ul",{className:"changelogList",children:W.map((e,a)=>t.jsxs("li",{className:`changeType-${e.type}`,children:[t.jsx("span",{className:"changeIcon",children:e.type==="added"?"âœ¨":e.type==="fixed"?"ðŸ›":e.type==="changed"?"ðŸ”„":e.type==="removed"?"ðŸ—‘ï¸":"ðŸ“"}),e.description]},a))})]}),u&&u!==s?.version&&t.jsxs("div",{className:"versionWarning",children:["âš ï¸ You are viewing version ",u,".",t.jsxs("button",{onClick:()=>g(s.version),className:"viewLatestBtn",children:["View latest version (",s.version,")"]})]}),t.jsx("div",{className:"hero",children:t.jsx("div",{className:"heroContent",children:t.jsx("div",{className:"heroTitle",children:d?.description})})})," ",(d?.sections?.length>0||d?.blocks?.some(e=>e.type==="heading"))&&t.jsxs("div",{className:"tocContainer",children:[t.jsx("h3",{className:"tocTitle",children:"Table of Contents"}),t.jsx("ul",{className:"tocList",children:d.blocks?d.blocks.filter(e=>e.type==="heading").map((e,a)=>t.jsx("li",{children:t.jsx("button",{onClick:()=>K(a),children:e.value})},e.id||a)):d.sections?.map((e,a)=>t.jsx("li",{children:t.jsx("button",{onClick:()=>K(a),children:e.title})},a))})]}),t.jsx("div",{className:"contentBody",children:d?.blocks?d.blocks.map((e,a)=>t.jsxs("div",{id:`section-${a}`,className:"blockWrapper",children:[e.type==="heading"&&t.jsx("h2",{className:"sectionTitle",children:e.value}),e.type==="text"&&t.jsx("p",{className:"text",children:e.value}),e.type==="quote"&&t.jsx("blockquote",{className:"quote",children:e.value}),e.type==="code"&&t.jsx("pre",{className:"codeBlock",children:t.jsx("code",{children:e.value})})," ",e.type==="image"&&t.jsx("div",{className:"imageWrapper",children:G(e.imageUrl||e.value)?t.jsx("img",{src:G(e.imageUrl||e.value),alt:"Manual content",className:"contentImage",onError:o=>{o.target.style.display="none",console.warn("Failed to load image:",e.imageUrl||e.value)}}):t.jsx("div",{style:{padding:"2rem",textAlign:"center",background:"var(--bg-secondary)",borderRadius:"8px",color:"var(--text-muted)"},children:"ðŸ“· Image not available"})})]},e.id||a)):d?.sections?d.sections.map((e,a)=>t.jsxs("section",{id:`section-${a}`,className:"section",children:[t.jsx("h2",{className:"sectionTitle",children:e.title}),t.jsx("p",{className:"text",children:e.content})]},a)):t.jsx("section",{className:"section",children:t.jsx("p",{className:"text",children:d?.intro||"No content available for this manual."})})})]}),t.jsxs("aside",{className:"right",children:[" ",t.jsxs("section",{className:"card",children:[t.jsx("h3",{className:"cardTitle",children:"Download"}),t.jsxs("p",{className:"cardDesc",children:["Get the full ",s.fileInfo?"version":"PDF version"," for offline reading."]}),t.jsx("button",{type:"button",className:"btn primary full",onClick:()=>{if(s.fileInfo&&typeof s.fileInfo=="object"&&s.fileInfo.dataUrl){const e=document.createElement("a");e.href=s.fileInfo.dataUrl,e.download=s.fileInfo.name,document.body.appendChild(e),e.click(),document.body.removeChild(e),h("Download started!","success","Downloading")}else h("File not available for download","warning","No File")},children:s.fileInfo?"Download File":"Download PDF"})," ",t.jsx("div",{className:"fileInfo",children:s.fileInfo&&typeof s.fileInfo=="object"?t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:[s.fileInfo.type?.split("/")[1]?.toUpperCase()||"FILE"," ","â€¢ ",(s.fileInfo.size/1024/1024).toFixed(2)," MB"]}),t.jsx("span",{children:s.fileInfo.name})]}):s.fileInfo&&typeof s.fileInfo=="string"?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"FILE"}),t.jsx("span",{children:s.fileInfo})]}):t.jsx(t.Fragment,{children:t.jsx("span",{style:{color:"var(--text-muted)"},children:"ðŸ“„ No file uploaded yet"})})})]}),t.jsxs("section",{className:"card",children:[t.jsx("h3",{className:"cardTitle",children:"Tags"}),t.jsx("div",{className:"tagsRow",children:(s.tags||[]).map(e=>t.jsx("span",{className:"tagChip",children:e},e))})]}),t.jsxs("section",{className:"card",children:[t.jsx("h3",{className:"cardTitle",children:"Related Manuals"}),t.jsxs("div",{className:"relatedList",children:[H.map(e=>t.jsxs("button",{className:"relatedItem",onClick:()=>j(`/manual/${e.id}`),children:[t.jsx("div",{className:"relatedTitle",children:e.title}),t.jsxs("div",{className:"relatedMeta",children:[e.category," â€¢ ",e.views," views"]})]},e.id)),H.length===0&&t.jsx("div",{className:"empty",children:"No related manuals found"})]})]}),t.jsxs("section",{className:"card",children:[t.jsxs("h3",{className:"cardTitle",children:["Comments (",L.length,")"]}),c?t.jsxs("div",{className:"commentInputWrapper",children:[t.jsx("textarea",{className:"commentInput",rows:3,placeholder:"Add a comment... (Ctrl+Enter to post)",value:k,onChange:e=>P(e.target.value),onKeyPress:ce,disabled:B}),t.jsx("button",{className:"commentSubmitBtn",onClick:q,disabled:!k.trim()||B,children:B?"Posting...":"Post"})]}):t.jsx("div",{className:"commentLoginPrompt",children:t.jsxs("p",{children:["Please"," ",t.jsx("button",{onClick:()=>j("/login"),className:"loginLink",children:"login"})," ","to add a comment"]})}),t.jsxs("div",{className:"commentList",children:[L.map(e=>t.jsxs("div",{className:"commentRow",children:[t.jsx("div",{className:"commentAvatar",children:e.author?.[0]?.toUpperCase()}),t.jsxs("div",{className:"commentContent",children:[t.jsxs("div",{className:"commentHeader",children:[t.jsx("span",{className:"commentAuthor",children:e.author}),t.jsxs("span",{className:"commentTime",children:[le(e.createdAt),e.edited&&t.jsx("span",{className:"editedBadge",children:" (edited)"})]}),c&&e.userId===c.id&&t.jsxs("div",{className:"commentActions",children:[t.jsx("button",{className:"commentActionBtn",onClick:()=>de(e),title:"Edit comment",children:"âœï¸"}),t.jsx("button",{className:"commentActionBtn deleteBtn",onClick:()=>he(e),title:"Delete comment",children:"ðŸ—‘ï¸"})]})]}),ee===e.id?t.jsxs("div",{className:"commentEditWrapper",children:[t.jsx("textarea",{className:"commentEditInput",value:I,onChange:a=>b(a.target.value),rows:3,autoFocus:!0}),t.jsxs("div",{className:"commentEditActions",children:[t.jsx("button",{className:"commentEditSaveBtn",onClick:()=>me(e.id),children:"Save"}),t.jsx("button",{className:"commentEditCancelBtn",onClick:ue,children:"Cancel"})]})]}):t.jsx("p",{className:"commentText",children:e.text})]})]},e.id)),L.length===0&&t.jsxs("div",{className:"empty",children:["No comments yet."," ",c?"Be the first to comment!":"Login to be the first to comment!"]})]})]})," "]})]})]}),t.jsx(Se,{show:p.show,onHide:se,title:p.title,message:p.message,variant:p.variant,onConfirm:p.onConfirm,confirmText:p.confirmText,cancelText:p.cancelText})]}):t.jsx("main",{className:"manualPage",children:t.jsx("div",{className:"manualPageInner",children:t.jsx("p",{children:"Manual not found."})})})};export{Ue as default};
