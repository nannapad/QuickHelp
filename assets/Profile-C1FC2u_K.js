import{j as e,P as D,m as y}from"./ui-C0p69nPY.js";import{r as d,u as R}from"./vendor-D6EYvIws.js";import{u as T,A as I}from"./AlertModal-DN7yXDQv.js";import{u as M}from"./utils-dQ_ya9vc.js";import{g as F,u as L}from"./UserData-CNiV9beM.js";const W=()=>{const[a,v]=d.useState(null),[w,C]=d.useState(!0),[r,h]=d.useState(!1),[i,o]=d.useState({}),[$,u]=d.useState(null),[N,m]=d.useState(null),[x,P]=d.useState(!1),{t:l}=M(),j=R(),{modalState:f,showAlert:c,hideAlert:k}=T();d.useEffect(()=>{const s=()=>{try{const t=localStorage.getItem("userData"),p=localStorage.getItem("authToken");if(!t||!p){j("/login");return}const b=JSON.parse(t),n=F(b.id)||b;v(n),o({firstName:n.firstName,lastName:n.lastName,department:n.department||"",position:n.position||"",bio:n.bio||"",phone:n.phone||"",location:n.location||""});const U=y(n.profilePicture);m(U)}catch(t){console.error("Error loading user profile:",t),j("/login")}finally{C(!1)}};return s(),window.addEventListener("authStateChanged",s),()=>window.removeEventListener("authStateChanged",s)},[j]);const A=()=>{try{const s={...i,profilePicture:N},t=L(a.id,s);t?(localStorage.setItem("userData",JSON.stringify(t)),v(t),h(!1),window.dispatchEvent(new Event("authStateChanged")),c("Profile updated successfully!","success")):c("Failed to update profile","error")}catch(s){console.error("Error saving profile:",s),c("Error saving profile","error")}},S=s=>{if(s.target.files&&s.target.files[0]){const t=s.target.files[0];u(t);const p=new FileReader;p.onloadend=()=>{m(p.result)},p.readAsDataURL(t)}},E=()=>{u(null),m(null)},g=s=>s?new Date(s).toLocaleDateString():"N/A";return w?e.jsx("main",{className:"profile-page",children:e.jsx("div",{className:"profile-inner",children:e.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:l("common.loading")})})}):a?(a.role==="admin"&&a.systemStats,a.role==="admin"&&a.recentActions,e.jsxs("main",{className:"profile-page",children:[e.jsxs("div",{className:"profile-inner",children:[" ",e.jsxs("header",{className:"profile-header",children:[e.jsxs("div",{className:"profile-user",children:[e.jsxs("div",{className:"profile-avatar-container",children:[e.jsx(D,{user:a,size:"xlarge",className:"bordered-white"}),r&&e.jsxs("div",{className:"profile-avatar-edit",children:[e.jsxs("label",{className:"profile-avatar-upload",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:S,style:{display:"none"}}),"üì∑"]}),N&&e.jsx("button",{className:"profile-avatar-remove",onClick:E,type:"button",children:"üóëÔ∏è"})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"profile-name",children:a.firstName&&a.lastName?`${a.firstName} ${a.lastName}`:a.username}),e.jsxs("div",{className:"profile-meta",children:[e.jsx("span",{children:a.role==="admin"?"Administrator":a.role==="creator"?"Content Creator":"Member"}),a.position&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"profile-dot",children:"‚Ä¢"}),e.jsx("span",{children:a.position})]}),e.jsx("span",{className:"profile-dot",children:"‚Ä¢"}),e.jsxs("span",{children:[l("profile.memberSince")," ",g(a.createdAt)]})]}),a.bio&&!r&&e.jsx("div",{className:"profile-bio",children:a.bio})]})]}),e.jsx("button",{className:"profile-btn ghost",onClick:()=>h(!r),children:l(r?"common.cancel":"profile.editProfile")})]}),e.jsxs("div",{className:"profile-grid",children:[e.jsxs("section",{className:"profile-card",children:[e.jsx("h2",{className:"profile-card-title",children:l("profile.personalInfo")}),e.jsx("p",{className:"profile-card-sub",children:"Update your personal information and contact details"}),e.jsxs("div",{className:"profile-field",children:[e.jsxs("label",{children:[l("profile.firstName")," *"]}),e.jsx("input",{type:"text",value:i.firstName||"",onChange:s=>o({...i,firstName:s.target.value}),placeholder:"Your first name",disabled:!r})]}),e.jsxs("div",{className:"profile-field",children:[e.jsxs("label",{children:[l("profile.lastName")," *"]}),e.jsx("input",{type:"text",value:i.lastName||"",onChange:s=>o({...i,lastName:s.target.value}),placeholder:"Your last name",disabled:!r})]}),a.role!=="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:"Bio / About Me"}),e.jsx("textarea",{value:i.bio||"",onChange:s=>o({...i,bio:s.target.value}),placeholder:"Tell others about yourself...",disabled:!r,rows:3}),e.jsx("div",{className:"profile-hint",children:"A brief description that appears on your profile"})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:"Location"}),e.jsx("input",{type:"text",value:i.location||"",onChange:s=>o({...i,location:s.target.value}),placeholder:"City, Country",disabled:!r})]})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:i.phone||"",onChange:s=>o({...i,phone:s.target.value}),placeholder:"+1 (555) 123-4567",disabled:!r})]}),e.jsx("div",{className:"profile-divider"}),e.jsx("h3",{className:"profile-section-title",children:"Work Information"}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:l("profile.position")}),e.jsx("input",{type:"text",value:i.position||"",onChange:s=>o({...i,position:s.target.value}),placeholder:"System Administrator, Manager, etc.",disabled:!r})]}),a.role!=="admin"&&e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:l("profile.department")}),e.jsx("input",{type:"text",value:i.department||"",onChange:s=>o({...i,department:s.target.value}),placeholder:"Engineering, Design, Marketing, HR, etc.",disabled:!r})]}),e.jsx("div",{className:"profile-divider"}),e.jsx("h3",{className:"profile-section-title",children:"Account Information"}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:l("profile.username")}),e.jsx("input",{type:"text",value:a.username,placeholder:"Username (read-only)",disabled:!0,style:{backgroundColor:"var(--bg-light)",opacity:.7}})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:l("profile.email")}),e.jsx("input",{type:"email",value:a.email,placeholder:"Email (read-only)",disabled:!0,style:{backgroundColor:"var(--bg-light)",opacity:.7}})]}),e.jsxs("div",{className:"profile-field",children:[e.jsx("label",{children:"Account Created"}),e.jsx("input",{type:"text",value:g(a.createdAt),disabled:!0,style:{backgroundColor:"var(--bg-light)",opacity:.7}})]}),e.jsx("div",{className:"profile-divider"}),e.jsx("h3",{className:"profile-section-title",children:"Security"}),e.jsxs("div",{className:"profile-security-row",children:[e.jsx("div",{className:"profile-security-text",children:"Change your password to keep your account secure."})," ",e.jsx("button",{type:"button",className:"profile-btn ghost",onClick:()=>c("This is a demo view. Password changes are not implemented.","info"),children:"Change password"})]}),e.jsxs("div",{className:"profile-security-row",children:[e.jsx("div",{className:"profile-security-text",children:"Two-factor authentication (2FA) adds an extra layer of security."}),e.jsx("button",{type:"button",className:`profile-toggle ${x?"on":""}`,onClick:()=>{const s=!x;P(s),c(`Two-factor authentication is now ${s?"enabled":"disabled"} (demo only).`,"success")},children:x?"2FA enabled":"Enable 2FA"})]}),r&&e.jsxs("div",{className:"profile-actions",children:[e.jsx("button",{className:"profile-btn primary",onClick:A,children:l("profile.saveChanges")}),e.jsx("button",{className:"profile-btn ghost",onClick:()=>{h(!1),o({firstName:a.firstName,lastName:a.lastName,department:a.department||"",position:a.position||"",bio:a.bio||"",phone:a.phone||"",location:a.location||""}),m(y(a.profilePicture)),u(null)},children:l("common.cancel")})]})]}),e.jsxs("section",{className:"profile-card",children:[e.jsx("h2",{className:"profile-card-title",children:l("profile.accountStats")}),e.jsx("p",{className:"profile-card-sub",children:"Your activity and contributions to QuickHelp"}),e.jsxs("div",{className:"profile-statRow",children:[e.jsxs("div",{children:[e.jsx("div",{className:"profile-stat-label",children:l("profile.manualsViewed")}),e.jsx("div",{className:"profile-stat-value",children:a.stats?.manualsViewed||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"profile-stat-label",children:l("profile.manualsDownloaded")}),e.jsx("div",{className:"profile-stat-value",children:a.stats?.manualsDownloaded||0})]})]}),e.jsx("div",{className:"profile-statRow",children:e.jsxs("div",{children:[e.jsx("div",{className:"profile-stat-label",children:l("profile.manualsBookmarked")}),e.jsx("div",{className:"profile-stat-value",children:a.stats?.manualsBookmarked||0})]})}),(a.role==="creator"||a.role==="admin")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profile-divider"}),e.jsx("h3",{className:"profile-section-title",children:"Content Creation"}),e.jsxs("div",{className:"profile-statRow",children:[e.jsxs("div",{children:[e.jsx("div",{className:"profile-stat-label",children:"Manuals Created"}),e.jsx("div",{className:"profile-stat-value",children:a.stats?.manualsCreated||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"profile-stat-label",children:"Total Likes Received"}),e.jsx("div",{className:"profile-stat-value",children:a.stats?.likesReceived||0})]})]}),e.jsx("div",{className:"profile-statRow",children:e.jsxs("div",{children:[e.jsx("div",{className:"profile-stat-label",children:"Total Manual Views"}),e.jsx("div",{className:"profile-stat-value",children:a.stats?.totalManualViews||0})]})})]}),e.jsx("div",{className:"profile-divider"}),e.jsx("div",{className:"profile-tagsTitle",children:"Roles & Permissions"}),e.jsxs("div",{className:"profile-tagsRow",children:[e.jsx("span",{className:`profile-tagChip role-${a.role}`,children:a.role==="admin"?"Administrator":a.role==="creator"?"Content Creator":"Member"}),a.role!=="admin"&&a.department&&e.jsx("span",{className:"profile-tagChip",children:a.department}),a.position&&e.jsx("span",{className:"profile-tagChip",children:a.position}),a.role!=="admin"&&a.location&&e.jsxs("span",{className:"profile-tagChip",children:["üìç ",a.location]})]})," "]})]})]}),e.jsx(I,{show:f.show,onHide:k,title:f.title,message:f.message,variant:f.variant})]})):e.jsx("main",{className:"profile-page",children:e.jsx("div",{className:"profile-inner",children:e.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:"User not found"})})})};export{W as default};
