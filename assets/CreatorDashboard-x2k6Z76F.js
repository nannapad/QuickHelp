import{j as a}from"./ui-DKY0DGm9.js";import{r as b,u as C}from"./vendor-D6EYvIws.js";import{u as D,A as T}from"./AlertModal-CrmLqu_t.js";import{m as A}from"./ManualData-CVKivWWw.js";import{u as $}from"./utils-CDqJ1pPe.js";const V=()=>{const[g,v]=b.useState(null),[r,x]=b.useState([]),{t:e}=$(),i=C(),{modalState:n,showAlert:u,showConfirm:p,hideAlert:f}=D();if(b.useEffect(()=>{const s=localStorage.getItem("userData"),d=localStorage.getItem("authToken");if(!s||!d){i("/login");return}const c=JSON.parse(s);if(c.role!=="creator"&&c.role!=="admin"){i("/");return}v(c);const l=`${c.firstName} ${c.lastName}`,o=A.filter(t=>t.author===l||t.author===c.username),N=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(t=>t.author===l||t.author===c.username),M=new Set(N.map(t=>t.id)),w=o.filter(t=>!M.has(t.id)),S=[...N.map(t=>({...t,status:t.status||"published",views:t.views||0})),...w.map(t=>({...t,status:"published",views:t.views||0}))];x(S)},[i]),!g)return a.jsx("main",{className:"cd-page",children:a.jsx("div",{className:"cd-inner",children:a.jsx("div",{className:"cd-loading",children:"Loading..."})})});const j=r.filter(s=>s.status==="published"),m=r.filter(s=>s.status==="draft"),h=r.filter(s=>s.status==="pending"),y=j.reduce((s,d)=>s+(d.views||0),0);return a.jsxs("main",{className:"cd-page",children:[a.jsxs("div",{className:"cd-inner",children:[" ",a.jsxs("header",{className:"cd-header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"cd-title",children:e("dashboard.creator.title")||"Creator Dashboard"}),a.jsx("p",{className:"cd-sub",children:e("dashboard.creator.subtitle")||"Overview of your manuals, drafts, and recent activity"})]}),a.jsxs("button",{className:"cd-btn primary",onClick:()=>i("/create-manual"),children:[" ","+ ",e("dashboard.creator.createManual")||"Create manual"]})]})," ",a.jsxs("section",{className:"cd-summaryGrid",children:[a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:e("dashboard.creator.publishedManuals")||"Published manuals"}),a.jsx("div",{className:"cd-summaryValue",children:j.length}),a.jsx("div",{className:"cd-summarySub",children:e("dashboard.creator.publishedDesc")||"Manuals that are live and searchable"})]}),a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:e("dashboard.creator.pendingManuals")||"Pending approval"}),a.jsx("div",{className:"cd-summaryValue",children:h.length}),a.jsx("div",{className:"cd-summarySub",children:e("dashboard.creator.pendingDesc")||"Manuals awaiting admin approval"})]}),a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:e("dashboard.creator.drafts")||"Drafts"}),a.jsx("div",{className:"cd-summaryValue",children:m.length}),a.jsx("div",{className:"cd-summarySub",children:e("dashboard.creator.draftsDesc")||"Unpublished manuals you can continue editing"})]}),a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:e("dashboard.creator.totalViews")||"Total views"}),a.jsx("div",{className:"cd-summaryValue",children:y}),a.jsx("div",{className:"cd-summarySub",children:e("dashboard.creator.viewsDesc")||"Total views across all your manuals"})]})]}),a.jsxs("div",{className:"cd-mainGrid",children:[" ",a.jsxs("section",{className:"cd-card",children:[a.jsxs("div",{className:"cd-cardHeader",children:[a.jsx("h2",{className:"cd-cardTitle",children:e("dashboard.creator.myManuals")||"My manuals"}),a.jsxs("span",{className:"cd-cardMeta",children:[r.length," total â€¢ ",j.length," ",e("dashboard.creator.published")||"published",h.length>0&&a.jsxs(a.Fragment,{children:[" â€¢ ",h.length," pending"]})]})]})," ",a.jsxs("div",{className:"cd-table",children:[a.jsxs("div",{className:"cd-tableHead",children:[a.jsx("span",{children:e("dashboard.admin.title")||"Title"}),a.jsx("span",{children:e("dashboard.creator.category")||"Category"}),a.jsx("span",{children:e("dashboard.creator.status")||"Status"}),a.jsx("span",{children:e("dashboard.creator.lastUpdated")||"Last updated"}),a.jsx("span",{children:e("dashboard.creator.views")||"Views"}),a.jsx("span",{children:e("dashboard.creator.actions")||"Actions"})]}),r.map(s=>a.jsxs("div",{className:"cd-tableRow cd-tableRowActions",children:[a.jsx("span",{className:"cd-tableTitle",children:s.title}),a.jsx("span",{className:"cd-tableCategory",children:s.category}),a.jsx("span",{className:`cd-statusPill cd-${s.status}`,children:s.status}),a.jsx("span",{className:"cd-tableDate",children:s.updatedAt||s.createdAt}),a.jsx("span",{className:"cd-tableViews",children:s.views}),a.jsxs("span",{className:"cd-tableActions",children:[s.status==="published"&&a.jsx("button",{className:"cd-btn ghost small",onClick:()=>i(`/manual/${s.id}`),title:"View manual",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"cd-btn ghost small",onClick:()=>i(`/edit-manual/${s.id}`),title:"Edit manual",children:"âœï¸"})," ",a.jsx("button",{className:"cd-btn ghost small",onClick:()=>{p(`Delete manual "${s.title}"? This action cannot be undone.`,()=>{try{const c=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(l=>l.id!==s.id);localStorage.setItem("customManuals",JSON.stringify(c)),x(l=>l.filter(o=>o.id!==s.id)),window.dispatchEvent(new Event("manualUpdated")),u("Manual deleted successfully","success")}catch(d){console.error(d),u("Failed to delete manual","error")}},"danger","Confirm Deletion","Delete","Cancel")},title:"Delete manual",style:{color:"#ef4444"},children:"ðŸ—‘ï¸"})]})]},s.id))," ",r.length===0&&a.jsx("div",{className:"cd-empty",children:e("dashboard.creator.noManuals")||"No manuals yet. Try creating your first manual!"})]})," "]})," ",a.jsxs("section",{className:"cd-card",children:[a.jsxs("div",{className:"cd-cardHeader",children:[a.jsx("h2",{className:"cd-cardTitle",children:e("dashboard.creator.draftManuals")||"Draft Manuals"}),a.jsxs("span",{className:"cd-cardMeta",children:[m.length," ",e("dashboard.creator.draft")||"draft",m.length!==1&&"s"]})]}),a.jsxs("div",{className:"cd-draftList",children:[m.map(s=>a.jsxs("div",{className:"cd-draftItem",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"cd-draftTitle",children:[s.title,a.jsx("span",{className:`cd-statusPill cd-${s.status}`,style:{marginLeft:"8px",fontSize:"9px"},children:s.status})]}),a.jsxs("div",{className:"cd-draftMeta",children:[s.category," â€¢"," ",e("dashboard.creator.lastEdited")||"last edited"," ",s.updatedAt||s.createdAt]})]})," ",a.jsxs("div",{style:{display:"flex",gap:"8px"},children:[a.jsx("button",{className:"cd-btn ghost",onClick:()=>i(`/edit-draft/${s.id}`),children:e("dashboard.creator.publish")||"Publish"}),a.jsx("button",{className:"cd-btn ghost",onClick:()=>{p(`${e("common.delete")||"Delete"} "${s.title}"? This action cannot be undone.`,()=>{try{const c=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(l=>l.id!==s.id);localStorage.setItem("customManuals",JSON.stringify(c)),x(l=>l.filter(o=>o.id!==s.id)),window.dispatchEvent(new Event("manualUpdated")),u("Draft deleted successfully","success")}catch(d){console.error(d),u("Failed to delete draft","error")}},"danger","Confirm Deletion","Delete","Cancel")},title:e("common.delete")||"Delete draft",style:{color:"#ef4444"},children:"ðŸ—‘ï¸"})]})]},s.id)),m.length===0&&a.jsx("div",{className:"cd-empty",children:e("dashboard.creator.noDraftsMessage")||"No draft manuals. When you save as draft, they will appear here."})]}),h.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"cd-divider",style:{margin:"20px 0"}}),a.jsxs("div",{className:"cd-cardHeader",children:[a.jsx("h2",{className:"cd-cardTitle",children:e("dashboard.creator.pendingManuals")||"Pending Approval"}),a.jsxs("span",{className:"cd-cardMeta",children:[h.length," ",e("dashboard.creator.pending")||"pending"]})]}),a.jsx("div",{className:"cd-draftList",children:h.map(s=>a.jsxs("div",{className:"cd-draftItem",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"cd-draftTitle",children:[s.title,a.jsx("span",{className:`cd-statusPill cd-${s.status}`,style:{marginLeft:"8px",fontSize:"9px"},children:s.status})]}),a.jsxs("div",{className:"cd-draftMeta",children:[s.category," â€¢"," ",e("dashboard.creator.submitted")||"submitted"," ",s.updatedAt||s.createdAt]})]}),a.jsxs("div",{style:{display:"flex",gap:"8px"},children:[a.jsx("button",{className:"cd-btn ghost",onClick:()=>i(`/edit-manual/${s.id}`),children:e("dashboard.creator.edit")||"Edit"}),a.jsx("button",{className:"cd-btn ghost",onClick:()=>{p(`${e("common.delete")||"Delete"} "${s.title}"? This action cannot be undone.`,()=>{try{const c=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(l=>l.id!==s.id);localStorage.setItem("customManuals",JSON.stringify(c)),x(l=>l.filter(o=>o.id!==s.id)),window.dispatchEvent(new Event("manualUpdated")),u("Pending manual deleted successfully","success")}catch(d){console.error(d),u("Failed to delete manual","error")}},"danger","Confirm Deletion","Delete","Cancel")},title:e("common.delete")||"Delete",style:{color:"#ef4444"},children:"ðŸ—‘ï¸"})]})]},s.id))})]})," ",a.jsx("div",{className:"cd-divider"}),a.jsx("div",{className:"cd-cardHeader",children:a.jsx("h2",{className:"cd-cardTitle",children:e("dashboard.creator.recentActivity")||"Recent activity"})}),a.jsxs("ul",{className:"cd-activityList",children:[r.length>0?a.jsx(a.Fragment,{children:r.slice(0,3).map((s,d)=>a.jsxs("li",{children:[a.jsx("span",{className:"cd-dot"}),s.status==="published"?`Manual "${s.title}" is published and live`:s.status==="pending"?`Manual "${s.title}" is pending approval`:`Draft "${s.title}" was last updated ${s.updatedAt||s.createdAt}`]},d))}):a.jsxs("li",{children:[a.jsx("span",{className:"cd-dot"}),e("dashboard.creator.noActivity")||"No recent activity. Create your first manual to get started!"]})," "]})]})]})]}),a.jsx(T,{show:n.show,onHide:f,title:n.title,message:n.message,variant:n.variant,onConfirm:n.onConfirm,confirmText:n.confirmText,cancelText:n.cancelText})]})};export{V as default};
