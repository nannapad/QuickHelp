import{j as a,l as b}from"./ui-HD-sGl07.js";import{r as g,u as H}from"./vendor-D6EYvIws.js";import{u as P,A as L}from"./AlertModal-C9C8unQ8.js";import{m as V}from"./ManualData-BXjgqMK4.js";import{b as q}from"./UserData-WMet23Oe.js";import{b as F,u as y}from"./CreatorRequests-CrYA46hB.js";import{u as Y}from"./utils-DIoNpZQj.js";const Z=()=>{const[x,A]=g.useState(null),[o,u]=g.useState({totalUsers:0,creators:0,admins:0,manuals:0,pendingRequests:0}),[v,N]=g.useState([]),[m,j]=g.useState([]),{t}=Y(),h=H(),{modalState:p,showAlert:l,showConfirm:f,hideAlert:S}=P();g.useEffect(()=>{const e=localStorage.getItem("userData"),d=localStorage.getItem("authToken");if(!e||!d){h("/login");return}const n=JSON.parse(e);if(n.role!=="admin"){h("/");return}A(n),w()},[h]);const w=()=>{try{const e=q(),d=e.filter(i=>i.role==="creator"),n=e.filter(i=>i.role==="admin"),s=F().filter(i=>i.status==="pending"),c=JSON.parse(localStorage.getItem("customManuals")||"[]"),M=[...V,...c],E=M.sort((i,J)=>new Date(J.createdAt)-new Date(i.createdAt)).slice(0,5).map(i=>({...i,status:i.status||"published"})),U=c.filter(i=>i.status==="pending"),O=c.filter(i=>i.status==="draft");u({totalUsers:e.length,creators:d.length,admins:n.length,manuals:M.length,pendingRequests:s.length,pendingManuals:U.length,draftManuals:O.length}),N(s.slice(0,3)),j(E)}catch(e){console.error("Error loading dashboard data:",e)}},C=e=>{try{const d=JSON.parse(localStorage.getItem("customManuals")||"[]"),n=d.find(s=>s.id===e),r=d.map(s=>s.id===e?{...s,status:"published"}:s);localStorage.setItem("customManuals",JSON.stringify(r)),n&&n.authorId&&b({userId:n.authorId,message:`Your manual "${n.title}" has been approved and published!`,type:"success",link:`/manual/${e}`}),j(s=>s.map(c=>c.id===e?{...c,status:"published"}:c)),u(s=>({...s,pendingManuals:s.pendingManuals-1})),l("Manual approved and published successfully!","success")}catch(d){console.error("Error approving manual:",d),l("Failed to approve manual","error")}},R=(e,d)=>{f(`Reject and delete manual "${d}"? This action cannot be undone.`,()=>{D(e)},"danger","Confirm Rejection","Reject","Cancel")},D=e=>{try{const d=JSON.parse(localStorage.getItem("customManuals")||"[]"),n=d.find(s=>s.id===e),r=d.filter(s=>s.id!==e);localStorage.setItem("customManuals",JSON.stringify(r)),n&&n.authorId&&b({userId:n.authorId,message:`Your manual "${n.title}" was not approved.`,type:"warning",link:null}),j(s=>s.filter(c=>c.id!==e)),u(s=>({...s,manuals:s.manuals-1,pendingManuals:s.pendingManuals-1})),l("Manual rejected and deleted successfully!","success")}catch(d){console.error("Error rejecting manual:",d),l("Failed to reject manual","error")}},I=(e,d)=>{f(`Delete draft "${d}"? This action cannot be undone.`,()=>{T(e)},"danger","Confirm Deletion","Delete","Cancel")},T=e=>{try{const d=JSON.parse(localStorage.getItem("customManuals")||"[]"),n=d.find(s=>s.id===e),r=d.filter(s=>s.id!==e);localStorage.setItem("customManuals",JSON.stringify(r)),n&&n.authorId&&b({userId:n.authorId,message:`Your draft "${n.title}" has been deleted by an admin.`,type:"warning",link:null}),j(s=>s.filter(c=>c.id!==e)),u(s=>({...s,manuals:s.manuals-1,draftManuals:s.draftManuals-1})),l("Draft deleted successfully!","success")}catch(d){console.error("Error deleting draft:",d),l("Failed to delete draft","error")}},k=(e,d)=>{f(`Delete manual "${d}"? This action cannot be undone.`,()=>{$(e)},"danger","Confirm Deletion","Delete","Cancel")},$=e=>{try{const n=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(r=>r.id!==e);localStorage.setItem("customManuals",JSON.stringify(n)),j(r=>r.filter(s=>s.id!==e)),u(r=>({...r,manuals:r.manuals-1})),l("Manual deleted successfully!","success")}catch(d){console.error("Error deleting manual:",d),l("Failed to delete manual","error")}};return x?a.jsxs("main",{className:"ad-page",children:[a.jsxs("div",{className:"ad-inner",children:[a.jsxs("header",{className:"ad-header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"ad-title",children:t("dashboard.admin.title")||"Admin Dashboard"}),a.jsx("p",{className:"ad-sub",children:t("dashboard.admin.subtitle")||"Overview of users, manuals, and creator requests in your organization"})]})," ",a.jsx("div",{className:"ad-headerRight",children:a.jsx("button",{className:"ad-btn ghost",onClick:()=>l("Export report functionality would be implemented here","info"),children:t("dashboard.admin.exportReport")||"Export report"})})]})," ",a.jsxs("section",{className:"ad-statsGrid",children:[a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.users")||"Users"}),a.jsx("div",{className:"ad-statValue",children:o.totalUsers}),a.jsxs("div",{className:"ad-statSub",children:[t("dashboard.admin.creators")||"Creators",": ",o.creators," â€¢"," ",t("dashboard.admin.admins")||"Admin",": ",o.admins]})]}),a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.manuals")||"Manuals"}),a.jsx("div",{className:"ad-statValue",children:o.manuals}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.totalManuals")||"Total manuals in system"})]})," ",a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.pendingManuals")||"Pending manuals"}),a.jsx("div",{className:"ad-statValue",children:o.pendingManuals||0}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.awaitingApproval")||"Awaiting approval"})]}),a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsx("div",{className:"ad-statValue",children:o.pendingRequests}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.pendingApproval")||"Requests pending approval"})]})]}),a.jsxs("div",{className:"ad-mainGrid",children:[a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingRequests," ",t("dashboard.admin.pending")||"pending"]})]}),a.jsxs("div",{className:"ad-requestList",children:[" ",v.map(e=>a.jsxs("div",{className:"ad-requestItem",children:[a.jsxs("div",{className:"ad-requestMain",children:[a.jsx("div",{className:"ad-requestName",children:e.username}),a.jsxs("div",{className:"ad-requestMeta",children:[e.team," â€¢ requested"," ",new Date(e.createdAt).toLocaleDateString()]}),a.jsx("div",{className:"ad-requestReason",children:e.reason})]})," ",a.jsxs("div",{className:"ad-requestActions",children:[" ",a.jsx("button",{className:"ad-btn ghost",onClick:()=>l(`Types: ${e.types?.join(", ")||"N/A"}

Reason: ${e.reason}`,"info","Request Details"),children:t("dashboard.admin.view")||"View"}),a.jsx("button",{className:"ad-btn approve",onClick:()=>{if(window.confirm(`Approve creator request for ${e.username}?`))try{y(e.id,{status:"approved",reviewerId:x.id,note:"Request approved by admin"});const n=q().map(s=>s.id===e.userId?{...s,role:"creator"}:s);localStorage.setItem("quickhelp_users",JSON.stringify(n));const r=localStorage.getItem("userData");if(r){const s=JSON.parse(r);s.id===e.userId&&(s.role="creator",localStorage.setItem("userData",JSON.stringify(s)),window.dispatchEvent(new Event("authStateChanged")))}b({userId:e.userId,message:"Your creator request has been approved! You can now create manuals.",type:"success",link:"/creator-dashboard"}),N(s=>s.filter(c=>c.id!==e.id)),u(s=>({...s,pendingRequests:s.pendingRequests-1,creators:s.creators+1})),l(`Approved ${e.username} as a creator.`,"success")}catch(d){console.error("Error approving request:",d),l("Failed to approve request","error")}},children:t("dashboard.admin.approve")||"Approve"}),a.jsx("button",{className:"ad-btn reject",onClick:()=>{if(window.confirm(`Reject creator request for ${e.username}?`))try{y(e.id,{status:"rejected",reviewerId:x.id,note:"Request rejected by admin"}),b({userId:e.userId,message:"Your creator request was not approved at this time.",type:"warning",link:"/creator-request"}),N(d=>d.filter(n=>n.id!==e.id)),u(d=>({...d,pendingRequests:d.pendingRequests-1})),l(`Rejected request for ${e.username}.`,"success")}catch(d){console.error("Error rejecting request:",d),l("Failed to reject request","error")}},children:t("dashboard.admin.reject")||"Reject"})]})]},e.id))," ",v.length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noRequests")||"No pending requests. Approved requests are recorded in the system."})]})]})," ",a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.pendingManuals")||"Pending Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingManuals||0," ",t("dashboard.admin.pending")||"pending"]})]}),a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.title")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.category")||"Category"}),a.jsx("span",{children:t("dashboard.admin.submitted")||"Submitted"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),m.filter(e=>e.status==="pending").map(e=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:e.title}),a.jsx("span",{className:"ad-tableAuthor",children:e.author}),a.jsx("span",{className:"ad-tableCategory",children:e.category}),a.jsx("span",{className:"ad-tableDate",children:e.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/manual/${e.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn approve small",onClick:d=>{d.stopPropagation(),window.confirm(`Approve and publish manual "${e.title}"?`)&&C(e.id)},title:"Approve",children:"âœ…"}),a.jsx("button",{className:"ad-btn reject small",onClick:d=>{d.stopPropagation(),R(e.id,e.title)},title:"Reject",children:"âŒ"})]})]},e.id)),m.filter(e=>e.status==="pending").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noPendingManuals")||"No pending manuals. All manuals have been reviewed."})]})]}),a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.draftManuals")||"Draft Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.draftManuals||0," ",t("dashboard.admin.drafts")||"drafts"]})]}),a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.title")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.category")||"Category"}),a.jsx("span",{children:t("dashboard.admin.created")||"Created"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),m.filter(e=>e.status==="draft").map(e=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:e.title}),a.jsx("span",{className:"ad-tableAuthor",children:e.author}),a.jsx("span",{className:"ad-tableCategory",children:e.category}),a.jsx("span",{className:"ad-tableDate",children:e.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/edit-manual/${e.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:d=>{d.stopPropagation(),I(e.id,e.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},e.id)),m.filter(e=>e.status==="draft").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noDrafts")||"No draft manuals found."})]})]})," ",a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.publishedManuals")||"Published Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[m.filter(e=>e.status==="published").length," ",t("dashboard.admin.published")||"published"]})]}),a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.title")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.category")||"Category"}),a.jsx("span",{children:t("dashboard.admin.created")||"Created"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),m.filter(e=>e.status==="published").map(e=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:e.title}),a.jsx("span",{className:"ad-tableAuthor",children:e.author}),a.jsx("span",{className:"ad-tableCategory",children:e.category}),a.jsx("span",{className:"ad-tableDate",children:e.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/manual/${e.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/edit-manual/${e.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:d=>{d.stopPropagation(),k(e.id,e.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},e.id))," ",m.filter(e=>e.status==="published").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noPublishedManuals")||"No published manuals found"})]}),a.jsx("div",{className:"ad-divider"})," ",a.jsx("div",{className:"ad-cardHeader",children:a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.userSnapshot")||"User snapshot"})}),a.jsxs("ul",{className:"ad-list",children:[a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.newUsers")||"8 new users this week"]}),a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.recentEdits")||"5 manuals edited in the last 24 hours"]}),a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.newCreators")||"2 creators added from requests this week"]})]})," "]})]})]}),a.jsx(L,{show:p.show,onHide:S,title:p.title,message:p.message,variant:p.variant,onConfirm:p.onConfirm,confirmText:p.confirmText,cancelText:p.cancelText})]}):a.jsx("main",{className:"ad-page",children:a.jsx("div",{className:"ad-inner",children:a.jsx("div",{className:"ad-loading",children:"Loading..."})})})};export{Z as default};
