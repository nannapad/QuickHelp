import{j as a,n as ce,m as ue}from"./ui-DKY0DGm9.js";import{u as me,h as he,i as pe,r as c}from"./vendor-D6EYvIws.js";import{u as ge}from"./utils-CDqJ1pPe.js";import{u as fe,A as xe}from"./AlertModal-CrmLqu_t.js";import{b as ve}from"./UserData-CNiV9beM.js";import{m as be}from"./ManualData-CVKivWWw.js";/* empty css                   */const Ce=()=>{const{t:o}=ge(),p=me(),{id:J}=he(),[q]=pe(),m=J||q.get("edit"),{modalState:T,showAlert:g,hideAlert:W}=fe(),[H,K]=c.useState(!0),[i,Y]=c.useState(null),[f,F]=c.useState(""),[U,P]=c.useState(""),[I,x]=c.useState([{id:1,type:"text",value:"",showToolbar:!1}]),[B,A]=c.useState(null),[ye,X]=c.useState(null),[w,R]=c.useState(null),[v,Z]=c.useState(null),[M,O]=c.useState("IT"),[$,V]=c.useState(""),[G,Q]=c.useState("EN"),[y,k]=c.useState([]);c.useEffect(()=>{(()=>{try{const t=localStorage.getItem("userData"),s=localStorage.getItem("authToken");if(!t||!s){p("/login");return}const l=JSON.parse(t);if(l.role!=="creator"&&l.role!=="admin"){p("/");return}if(!m){p("/creator-dashboard");return}const u=JSON.parse(localStorage.getItem("customManuals")||"[]"),h=new Set(u.map(r=>r.id)),C=be.filter(r=>!h.has(r.id)),n=[...u,...C].find(r=>String(r.id)===String(m)||r.id===parseInt(m));if(!n){g(o("editManual.notFound")||"Manual not found!","error"),setTimeout(()=>p("/creator-dashboard"),1500);return}const d=`${l.firstName} ${l.lastName}`;if(l.role!=="admin"&&n.author!==d&&n.author!==l.username){g(o("editManual.noPermission")||"You don't have permission to edit this manual!","error"),setTimeout(()=>p("/creator-dashboard"),1500);return}if(Y(n),F(n.title||""),P(n.description||""),O(n.category||"IT"),k(n.tags||[]),console.log("âœ… Manual loaded successfully:",{id:n.id,title:n.title,status:n.status,hasBlocks:!!n.blocks,hasSections:!!n.sections}),n.thumbnail){R(n.thumbnail);const r=n.thumbnail.split("/");A(r[r.length-1])}let j="1.0";if(n.version)j=n.version;else if(n.meta){const r=n.meta.match(/v(\d+\.\d+)/);r&&(j=r[1])}V(j);let b=[];if(n.blocks&&n.blocks.length>0)b=n.blocks;else if(n.sections&&n.sections.length>0){let r=1;b=n.sections.flatMap(N=>[{id:r++,type:"heading",value:N.title,showToolbar:!1},{id:r++,type:"text",value:N.content,showToolbar:!1}])}else b=[{id:1,type:"text",value:n.description||"",showToolbar:!1}];x(b)}catch(t){console.error("Error loading manual:",t),p("/creator-dashboard")}finally{K(!1)}})()},[m]);const _=(e="text")=>{const t=Date.now()+Math.floor(Math.random()*1e3);x(s=>[...s,{id:t,type:e,value:"",imageFile:null,imageUrl:"",showToolbar:!1}])},ee=e=>{x(t=>t.map(s=>s.id===e?{...s,showToolbar:!s.showToolbar}:s))},S=(e,t)=>{x(s=>s.map(l=>l.id===e?{...l,type:t,value:t==="image"?"":l.value}:l))},D=(e,t)=>{x(s=>s.map(l=>l.id===e?{...l,value:t}:l))},ae=e=>{if(I.length<=1){g("You must have at least one block in your manual.","warning");return}x(t=>t.filter(s=>s.id!==e))},L=(e,t)=>{if(t){const s=new FileReader;s.onloadend=()=>{x(l=>l.map(u=>u.id===e?{...u,imageFile:t,imageUrl:s.result,value:t.name}:u))},s.readAsDataURL(t)}},z=(e,t)=>{x(s=>s.map(l=>l.id===e?{...l,imageUrl:t,value:t}:l))},te=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];A(t.name),X(t);const s=new FileReader;s.onloadend=()=>{R(s.result)},s.readAsDataURL(t)}},se=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0],s=new FileReader;s.onloadend=()=>{const l={name:t.name,size:t.size,type:t.type,dataUrl:s.result};Z(l)},s.readAsDataURL(t)}},le=e=>{if(e.key==="Enter"){e.preventDefault();const t=e.target.value.trim();t&&!y.includes(t)&&(k([...y,t]),e.target.value="")}},ne=e=>{k(y.filter(t=>t!==e))},ie=()=>{if(!f.trim()){g("Please enter a manual title","warning");return}console.log("ðŸ’¾ Saving as draft...",{editId:m,title:f});let e="Anonymous",t=null;try{const l=JSON.parse(localStorage.getItem("userData"));l&&(t=l,e=`${l.firstName} ${l.lastName}`)}catch(l){console.error("Error getting user data",l)}const s={...i,title:f,description:U,category:M,meta:`${M} â€¢ ${$||"v1.0"}`,tags:y,author:e,updatedAt:new Date().toISOString().split("T")[0],difficulty:i.difficulty||"Beginner",estimatedTime:i.estimatedTime||"10 min",thumbnail:w||i.thumbnail,blocks:I,fileInfo:v||i.fileInfo,status:"draft"};try{const l=JSON.parse(localStorage.getItem("customManuals")||"[]"),u=l.findIndex(h=>String(h.id)===String(m)||h.id===parseInt(m));u!==-1?l[u]=s:l.push(s),localStorage.setItem("customManuals",JSON.stringify(l)),console.log("Manual saved as draft:",s),window.dispatchEvent(new Event("manualUpdated")),g("Manual saved as draft! Redirecting to dashboard...","success"),setTimeout(()=>{p("/creator-dashboard")},1e3)}catch(l){console.error("Error saving manual:",l),g("Failed to save manual","error")}},oe=()=>{if(!f.trim()){g("Please enter a manual title","warning");return}console.log("ðŸ“ Updating manual...",{editId:m,title:f,status:i?.status});let e="Anonymous",t=null;try{const d=JSON.parse(localStorage.getItem("userData"));d&&(t=d,e=`${d.firstName} ${d.lastName}`)}catch(d){console.error("Error getting user data",d)}let s;t?.role==="admin"?s=i.status==="draft"?"published":i.status||"published":t?.role==="creator"?i.status==="published"?s="pending":s=i.status||"pending":s=i.status||"published";const l=i.author||e,u=i.version||"1.0",h=$?.trim()||i.version||"1.0",C=i.versions||[u];let E=[...C];C.includes(h)||E.push(h);const n={...i,title:f,description:U,category:M,version:h,versions:E,meta:`${M} â€¢ v${h}`,tags:y,author:l,updatedBy:t?`${t.firstName} ${t.lastName}`:void 0,updatedAt:new Date().toISOString().split("T")[0],difficulty:i.difficulty||"Beginner",estimatedTime:i.estimatedTime||"10 min",thumbnail:w||i.thumbnail,blocks:I,fileInfo:v||i.fileInfo,status:s};try{const d=JSON.parse(localStorage.getItem("customManuals")||"[]"),j=d.findIndex(b=>String(b.id)===String(m)||b.id===parseInt(m));j!==-1?d[j]=n:d.push(n),localStorage.setItem("customManuals",JSON.stringify(d)),console.log("Manual updated:",n),window.dispatchEvent(new Event("manualUpdated")),u!==h&&(console.log(`Version changed from ${u} to ${h}, notifying bookmarked users`),ce(m,f)),t?.role==="creator"&&i.status==="published"&&s==="pending"&&ve().filter(N=>N.role==="admin").forEach(N=>{ue({userId:N.id,message:`Manual "${f}" by ${l} updated and needs re-approval`,type:"info",link:"/admin-dashboard"})}),t?.role==="admin"?(g("Manual updated successfully! Redirecting to manual page...","success"),setTimeout(()=>{p(`/manual/${m}`)},1e3)):(g("Manual updated successfully! Redirecting to dashboard...","success"),setTimeout(()=>{p("/creator-dashboard")},1e3))}catch(d){console.error("Error saving manual:",d),g("Failed to save manual","error")}},re=e=>{let t="block-input";return e.type==="heading"?t+=" block-heading":e.type==="quote"?t+=" block-quote":e.type==="code"&&(t+=" block-code"),t},de=e=>{const t=e.imageUrl&&(e.imageUrl.startsWith("data:")||e.imageUrl.startsWith("http://")||e.imageUrl.startsWith("https://"));return a.jsx("div",{className:"image-block",children:t?a.jsxs("div",{className:"image-preview",children:[a.jsx("img",{src:e.imageUrl,alt:"Preview",className:"image-preview-img",onError:s=>{s.target.style.display="none",console.warn("Failed to load image:",e.imageUrl)}}),a.jsxs("div",{className:"image-controls",children:[a.jsx("input",{type:"text",placeholder:o("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{D(e.id,s.target.value),s.target.value.startsWith("http")&&z(e.id,s.target.value)},className:"image-url-input"}),a.jsxs("label",{className:"image-upload-btn",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>L(e.id,s.target.files[0]),style:{display:"none"}}),o("createManual.uploadImage")]})]})]}):a.jsx("div",{className:"image-placeholder",children:a.jsxs("div",{className:"image-upload-area",children:[a.jsxs("label",{className:"image-upload-label",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>L(e.id,s.target.files[0]),style:{display:"none"}}),a.jsx("div",{className:"upload-icon",children:"ðŸ“·"}),a.jsx("div",{children:o("createManual.uploadImage")})]}),a.jsx("div",{className:"or-divider",children:o("common.or")}),a.jsx("input",{type:"text",placeholder:o("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{D(e.id,s.target.value),s.target.value.startsWith("http")&&z(e.id,s.target.value)},className:"image-url-input"})]})})})};return H?a.jsx("div",{className:"root",children:a.jsx("div",{className:"page",children:a.jsx("div",{className:"loading-state",children:a.jsx("h2",{children:o("editManual.loading")||"Loading manual..."})})})}):i?a.jsxs("div",{className:"root",children:[a.jsxs("div",{className:"page",children:[a.jsxs("section",{className:"editor-panel",children:[a.jsx("input",{className:"editor-title",placeholder:o("createManual.titlePlaceholder"),value:f,onChange:e=>F(e.target.value)}),a.jsx("textarea",{className:"editor-desc",rows:2,placeholder:o("createManual.contentPlaceholder"),value:U,onChange:e=>P(e.target.value)}),a.jsx("div",{className:"editor-divider"}),a.jsx("div",{className:"blocks",children:I.map(e=>a.jsxs("div",{className:`block ${e.showToolbar?"block-show-toolbar":""}`,children:[a.jsx("button",{type:"button",className:"block-plus",onClick:()=>ee(e.id),children:"+"}),a.jsxs("div",{className:"block-toolbar",children:[a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="text"?"toolbar-btn-active":""}`,onClick:()=>S(e.id,"text"),children:"T"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="heading"?"toolbar-btn-active":""}`,onClick:()=>S(e.id,"heading"),children:"H"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="quote"?"toolbar-btn-active":""}`,onClick:()=>S(e.id,"quote"),children:"â"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="code"?"toolbar-btn-active":""}`,onClick:()=>S(e.id,"code"),children:"{ }"})," ",a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="image"?"toolbar-btn-active":""}`,onClick:()=>S(e.id,"image"),children:"ðŸ–¼ï¸"}),a.jsx("button",{type:"button",className:"toolbar-btn toolbar-btn-delete",onClick:()=>ae(e.id),style:{marginLeft:"auto",color:"#ef4444",borderColor:"#ef4444"},title:"Delete this block",children:"ðŸ—‘ï¸"})]}),e.type==="image"?de(e):a.jsx("textarea",{className:re(e),placeholder:e.type==="heading"?o("createManual.blockPlaceholders.heading"):e.type==="quote"?o("createManual.blockPlaceholders.quote"):e.type==="code"?o("createManual.blockPlaceholders.code"):o("createManual.blockPlaceholders.text"),value:e.value,onChange:t=>D(e.id,t.target.value)})]},e.id))}),a.jsxs("button",{type:"button",className:"btn-add-block",onClick:()=>_("text"),children:["+ ",o("createManual.addBlock")]})]}),a.jsxs("aside",{className:"meta-panel",children:[a.jsxs("div",{className:"meta-card",children:[a.jsx("div",{className:"meta-title",children:"Manual details"}),a.jsx("div",{className:"meta-caption",children:"à¸à¸³à¸«à¸™à¸”à¸«à¸¡à¸§à¸”à¹ƒà¸«à¸à¹ˆ à¹à¸—à¹‡à¸ à¹à¸¥à¸°à¹„à¸Ÿà¸¥à¹Œà¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸ˆà¸£à¸´à¸‡"}),a.jsx("div",{className:"meta-field-label",children:"Thumbnail"}),w&&a.jsx("div",{className:"thumbnail-preview",children:a.jsx("img",{src:w,alt:"Thumbnail preview",style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"8px",marginBottom:"8px"}})}),a.jsxs("label",{className:"thumb-box",children:[a.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:te}),B||"Click to upload thumbnail"]}),a.jsx("div",{className:"meta-field-label",children:"Category (à¸«à¸¡à¸§à¸”à¹ƒà¸«à¸à¹ˆ)"}),a.jsxs("select",{className:"meta-select",value:M,onChange:e=>O(e.target.value),children:[a.jsx("option",{children:"IT"}),a.jsx("option",{children:"Design"}),a.jsx("option",{children:"Marketing"}),a.jsx("option",{children:"HR"}),a.jsx("option",{children:"Operations"}),a.jsx("option",{children:"Customer Support"})]}),a.jsx("div",{className:"meta-field-label",children:"Tags"}),a.jsx("input",{className:"meta-input",placeholder:"Type tag and press Enter",onKeyDown:le}),a.jsxs("div",{className:"tag-box",children:[y.map((e,t)=>a.jsxs("span",{className:"tag-pill",onClick:()=>ne(e),title:"Click to remove",children:[e," Ã—"]},t)),y.length===0&&a.jsx("span",{style:{color:"var(--text-muted)",fontSize:"12px"},children:"No tags added yet"})]}),a.jsxs("div",{className:"meta-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Version"}),a.jsx("input",{className:"meta-input",placeholder:"à¹€à¸Šà¹ˆà¸™ 1.0 à¸«à¸£à¸·à¸­ 2.1",value:$,onChange:e=>V(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Language"}),a.jsxs("select",{className:"meta-select",value:G,onChange:e=>Q(e.target.value),children:[a.jsx("option",{children:"TH"}),a.jsx("option",{children:"EN"})]})]})]}),a.jsx("div",{className:"meta-field-label",style:{marginTop:10},children:"Manual file (PDF / DOCX / ZIP)"}),a.jsxs("label",{className:"file-btn",children:[a.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.zip",style:{display:"none"},onChange:se}),v?`ðŸ“Ž ${typeof v=="object"?v.name:v}`:i?.fileInfo?`ðŸ“Ž ${typeof i.fileInfo=="object"?i.fileInfo.name:i.fileInfo}`:"ðŸ“Ž Upload manual file"]})," ",(v||i?.fileInfo)&&a.jsx("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginTop:"4px"},children:(()=>{const e=v||i.fileInfo;return typeof e=="object"?`${(e.size/1024).toFixed(1)} KB â€¢ ${e.type||"Unknown type"}`:"File uploaded"})()}),a.jsx("p",{className:"meta-note",children:"à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹ƒà¸™à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¹€à¸žà¸µà¸¢à¸‡à¹€à¸à¸£à¸´à¹ˆà¸™à¸™à¸³à¹à¸¥à¸°à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸šà¸²à¸‡à¸ªà¹ˆà¸§à¸™ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸”à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œà¸”à¹‰à¸²à¸™à¸šà¸™à¹€à¸žà¸·à¹ˆà¸­à¸­à¹ˆà¸²à¸™à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸‰à¸šà¸±à¸šà¹€à¸•à¹‡à¸¡à¹„à¸”à¹‰"})," ",a.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[a.jsxs("button",{type:"button",className:"draft-btn",onClick:ie,style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"1px solid var(--border)",background:"transparent",color:"var(--text)",cursor:"pointer",fontSize:"14px",fontWeight:500},children:["ðŸ’¾ ",o("editManual.saveAsDraft")||"Save as Draft"]}),a.jsx("button",{type:"button",className:"publish-btn",onClick:oe,style:{flex:1},children:o("editManual.updateManual")||"Update Manual"})]})]})," "]})]}),a.jsx(xe,{show:T.show,onHide:W,title:T.title,message:T.message,variant:T.variant})]}):a.jsx("div",{className:"root",children:a.jsx("div",{className:"page",children:a.jsxs("div",{className:"error-state",children:[a.jsx("h2",{children:o("editManual.notFound")||"Manual not found"}),a.jsx("button",{onClick:()=>p("/creator-dashboard"),children:o("editManual.backToDashboard")||"Back to Dashboard"})]})})})};export{Ce as default};
