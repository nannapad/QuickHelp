import{j as a,n as x}from"./ui-C0p69nPY.js";import{r as g,u as z}from"./vendor-D6EYvIws.js";import{u as B,A as _}from"./AlertModal-DN7yXDQv.js";import{g as K}from"./manualRepository-BSTK98NG.js";import{b as q}from"./UserData-CNiV9beM.js";import{b as W,u as A}from"./CreatorRequests-CrYA46hB.js";import{u as X}from"./utils-dQ_ya9vc.js";import{g as Z}from"./searchAnalytics-Bz9FKtRP.js";import"./ManualData-CCWVZZls.js";const ua=()=>{const[j,C]=g.useState(null),[o,u]=g.useState({totalUsers:0,creators:0,admins:0,manuals:0,pendingRequests:0}),[w,v]=g.useState([]),[m,b]=g.useState([]),[N,R]=g.useState([]),[S,M]=g.useState([]),{t:n}=X(),h=z(),{modalState:p,showAlert:i,showConfirm:y,hideAlert:D}=B();g.useEffect(()=>{const e=localStorage.getItem("userData"),s=localStorage.getItem("authToken");if(!e||!s){h("/login");return}const r=JSON.parse(e);if(r.role!=="admin"){h("/");return}C(r),T()},[h]);const T=()=>{try{const e=q(),s=e.filter(c=>c.role==="creator"),r=e.filter(c=>c.role==="admin"),t=W().filter(c=>c.status==="pending"),l=K(),f=JSON.parse(localStorage.getItem("customManuals")||"[]"),H=l.sort((c,G)=>new Date(G.createdAt)-new Date(c.createdAt)).slice(0,5).map(c=>({...c,status:c.status||"published"})),L=f.filter(c=>c.status==="pending"),P=f.filter(c=>c.status==="draft");u({totalUsers:e.length,creators:s.length,admins:r.length,manuals:l.length,pendingRequests:t.length,pendingManuals:L.length,draftManuals:P.length}),v(t.slice(0,3)),b(H);const V=Z({days:7,limit:5});R(V);const Y=JSON.parse(localStorage.getItem("userQuestions")||"[]").filter(c=>c.status==="pending");M(Y)}catch(e){console.error("Error loading dashboard data:",e)}},I=e=>{try{const s=JSON.parse(localStorage.getItem("customManuals")||"[]"),r=s.find(t=>t.id===e),d=s.map(t=>t.id===e?{...t,status:"published"}:t);localStorage.setItem("customManuals",JSON.stringify(d)),r&&r.authorId&&x({userId:String(r.authorId),message:`Your manual "${r.title}" has been approved and published!`,type:"success",link:`/manual/${e}`}),b(t=>t.map(l=>l.id===e?{...l,status:"published"}:l)),u(t=>({...t,pendingManuals:t.pendingManuals-1})),i("Manual approved and published successfully!","success")}catch(s){console.error("Error approving manual:",s),i("Failed to approve manual","error")}},Q=(e,s)=>{y(`Reject and delete manual "${s}"? This action cannot be undone.`,()=>{k(e)},"danger","Confirm Rejection","Reject","Cancel")},k=e=>{try{const s=JSON.parse(localStorage.getItem("customManuals")||"[]"),r=s.find(t=>t.id===e),d=s.filter(t=>t.id!==e);localStorage.setItem("customManuals",JSON.stringify(d)),r&&r.authorId&&x({userId:String(r.authorId),message:`Your manual "${r.title}" was not approved.`,type:"warning",link:null}),b(t=>t.filter(l=>l.id!==e)),u(t=>({...t,manuals:t.manuals-1,pendingManuals:t.pendingManuals-1})),i("Manual rejected and deleted successfully!","success")}catch(s){console.error("Error rejecting manual:",s),i("Failed to reject manual","error")}},O=(e,s)=>{y(`Delete draft "${s}"? This action cannot be undone.`,()=>{$(e)},"danger","Confirm Deletion","Delete","Cancel")},$=e=>{try{const s=JSON.parse(localStorage.getItem("customManuals")||"[]"),r=s.find(t=>t.id===e),d=s.filter(t=>t.id!==e);localStorage.setItem("customManuals",JSON.stringify(d)),r&&r.authorId&&x({userId:String(r.authorId),message:`Your draft "${r.title}" has been deleted by an admin.`,type:"warning",link:null}),b(t=>t.filter(l=>l.id!==e)),u(t=>({...t,manuals:t.manuals-1,draftManuals:t.draftManuals-1})),i("Draft deleted successfully!","success")}catch(s){console.error("Error deleting draft:",s),i("Failed to delete draft","error")}},E=(e,s)=>{y(`Delete manual "${s}"? This action cannot be undone.`,()=>{J(e)},"danger","Confirm Deletion","Delete","Cancel")},J=e=>{try{const r=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(d=>d.id!==e);localStorage.setItem("customManuals",JSON.stringify(r)),b(d=>d.filter(t=>t.id!==e)),u(d=>({...d,manuals:d.manuals-1})),i("Manual deleted successfully!","success")}catch(s){console.error("Error deleting manual:",s),i("Failed to delete manual","error")}},U=(e,s)=>{try{const r=JSON.parse(localStorage.getItem("userQuestions")||"[]"),d=j?`${j.firstName} ${j.lastName}`:"Admin",t=r.map(l=>l.id===e?{...l,status:"answered",answer:s,answeredAt:new Date().toISOString(),answeredBy:d}:l);localStorage.setItem("userQuestions",JSON.stringify(t)),M(l=>l.filter(f=>f.id!==e)),i("Question answered successfully!","success")}catch(r){console.error("Error answering question:",r),i("Failed to answer question","error")}},F=e=>{try{const r=JSON.parse(localStorage.getItem("userQuestions")||"[]").map(d=>d.id===e?{...d,status:"archived",archivedAt:new Date().toISOString()}:d);localStorage.setItem("userQuestions",JSON.stringify(r)),M(d=>d.filter(t=>t.id!==e)),i("Question archived successfully!","success")}catch(s){console.error("Error archiving question:",s),i("Failed to archive question","error")}};return j?a.jsxs("main",{className:"ad-page",children:[a.jsxs("div",{className:"ad-inner",children:[a.jsxs("header",{className:"ad-header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"ad-title",children:n("dashboard.admin.title")||"Admin Dashboard"}),a.jsx("p",{className:"ad-sub",children:n("dashboard.admin.subtitle")||"Overview of users, manuals, and creator requests in your organization"})]})," ",a.jsx("div",{className:"ad-headerRight",children:a.jsx("button",{className:"ad-btn ghost",onClick:()=>i("Export report functionality would be implemented here","info"),children:n("dashboard.admin.exportReport")||"Export report"})})]})," ",a.jsxs("section",{className:"ad-statsGrid",children:[a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:n("dashboard.admin.users")||"Users"}),a.jsx("div",{className:"ad-statValue",children:o.totalUsers}),a.jsxs("div",{className:"ad-statSub",children:[n("dashboard.admin.creators")||"Creators",": ",o.creators," â€¢"," ",n("dashboard.admin.admins")||"Admin",": ",o.admins]})]}),a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:n("dashboard.admin.manuals")||"Manuals"}),a.jsx("div",{className:"ad-statValue",children:o.manuals}),a.jsx("div",{className:"ad-statSub",children:n("dashboard.admin.totalManuals")||"Total manuals in system"})]})," ",a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:n("dashboard.admin.pendingManuals")||"Pending manuals"}),a.jsx("div",{className:"ad-statValue",children:o.pendingManuals||0}),a.jsx("div",{className:"ad-statSub",children:n("dashboard.admin.awaitingApproval")||"Awaiting approval"})]}),a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:n("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsx("div",{className:"ad-statValue",children:o.pendingRequests}),a.jsx("div",{className:"ad-statSub",children:n("dashboard.admin.pendingApproval")||"Requests pending approval"})]})]}),a.jsxs("div",{className:"ad-mainGrid",children:[a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:n("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingRequests," ",n("dashboard.admin.pending")||"pending"]})]}),a.jsxs("div",{className:"ad-requestList",children:[" ",w.map(e=>a.jsxs("div",{className:"ad-requestItem",children:[a.jsxs("div",{className:"ad-requestMain",children:[a.jsx("div",{className:"ad-requestName",children:e.username}),a.jsxs("div",{className:"ad-requestMeta",children:[e.team," â€¢ requested"," ",new Date(e.createdAt).toLocaleDateString()]}),a.jsx("div",{className:"ad-requestReason",children:e.reason})]})," ",a.jsxs("div",{className:"ad-requestActions",children:[" ",a.jsx("button",{className:"ad-btn ghost",onClick:()=>i(`Types: ${e.types?.join(", ")||"N/A"}

Reason: ${e.reason}`,"info","Request Details"),children:n("dashboard.admin.view")||"View"}),a.jsx("button",{className:"ad-btn approve",onClick:()=>{if(window.confirm(`Approve creator request for ${e.username}?`))try{A(e.id,{status:"approved",reviewerId:j.id,note:"Request approved by admin"});const r=q().map(t=>t.id===e.userId?{...t,role:"creator"}:t);localStorage.setItem("quickhelp_users",JSON.stringify(r));const d=localStorage.getItem("userData");if(d){const t=JSON.parse(d);t.id===e.userId&&(t.role="creator",localStorage.setItem("userData",JSON.stringify(t)),window.dispatchEvent(new Event("authStateChanged")))}x({userId:String(e.userId),message:"Your creator request has been approved! You can now create manuals.",type:"success",link:"/creator-dashboard"}),v(t=>t.filter(l=>l.id!==e.id)),u(t=>({...t,pendingRequests:t.pendingRequests-1,creators:t.creators+1})),i(`Approved ${e.username} as a creator.`,"success")}catch(s){console.error("Error approving request:",s),i("Failed to approve request","error")}},children:n("dashboard.admin.approve")||"Approve"}),a.jsx("button",{className:"ad-btn reject",onClick:()=>{if(window.confirm(`Reject creator request for ${e.username}?`))try{A(e.id,{status:"rejected",reviewerId:j.id,note:"Request rejected by admin"}),x({userId:String(e.userId),message:"Your creator request was not approved at this time.",type:"warning",link:"/creator-request"}),v(s=>s.filter(r=>r.id!==e.id)),u(s=>({...s,pendingRequests:s.pendingRequests-1})),i(`Rejected request for ${e.username}.`,"success")}catch(s){console.error("Error rejecting request:",s),i("Failed to reject request","error")}},children:n("dashboard.admin.reject")||"Reject"})]})]},e.id))," ",w.length===0&&a.jsx("div",{className:"ad-empty",children:n("dashboard.admin.noRequests")||"No pending requests. Approved requests are recorded in the system."})]})]})," ",a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:n("dashboard.admin.pendingManuals")||"Pending Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingManuals||0," ",n("dashboard.admin.pending")||"pending"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:n("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:n("dashboard.admin.author")||"Author"}),a.jsx("span",{children:n("dashboard.admin.category")||"Category"}),a.jsx("span",{children:n("dashboard.admin.submitted")||"Submitted"}),a.jsx("span",{children:n("dashboard.admin.actions")||"Actions"})]}),m.filter(e=>e.status==="pending").map(e=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:e.title}),a.jsx("span",{className:"ad-tableAuthor",children:e.author}),a.jsx("span",{className:"ad-tableCategory",children:e.category}),a.jsx("span",{className:"ad-tableDate",children:e.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/manual/${e.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn approve small",onClick:s=>{s.stopPropagation(),window.confirm(`Approve and publish manual "${e.title}"?`)&&I(e.id)},title:"Approve",children:"âœ…"}),a.jsx("button",{className:"ad-btn reject small",onClick:s=>{s.stopPropagation(),Q(e.id,e.title)},title:"Reject",children:"âŒ"})]})]},e.id)),m.filter(e=>e.status==="pending").length===0&&a.jsx("div",{className:"ad-empty",children:n("dashboard.admin.noPendingManuals")||"No pending manuals. All manuals have been reviewed."})]})," "]}),a.jsxs("section",{className:"ad-card ad-card-compact",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:n("dashboard.admin.draftManuals")||"Draft Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.draftManuals||0," ",n("dashboard.admin.drafts")||"drafts"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:n("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:n("dashboard.admin.author")||"Author"}),a.jsx("span",{children:n("dashboard.admin.actions")||"Actions"})]}),m.filter(e=>e.status==="draft").slice(0,3).map(e=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:e.title}),a.jsx("span",{className:"ad-tableAuthor",children:e.author}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/edit-manual/${e.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:s=>{s.stopPropagation(),O(e.id,e.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},e.id)),m.filter(e=>e.status==="draft").length===0&&a.jsx("div",{className:"ad-empty",children:n("dashboard.admin.noDrafts")||"No draft manuals found."})]})]}),a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsxs("h2",{className:"ad-cardTitle",children:["ðŸ’¬"," ",n("dashboard.admin.userQuestions")||"User Questions from FAQ"]}),a.jsxs("span",{className:"ad-cardMeta",children:[S.length," ",n("dashboard.admin.pending")||"pending"]})]}),S.length===0?a.jsx("div",{className:"ad-empty",children:n("dashboard.admin.noQuestions")||"No pending questions. Users can submit questions from the FAQ page."}):a.jsx("div",{className:"ad-questionList",children:S.slice(0,5).map(e=>a.jsxs("div",{className:"ad-questionItem",children:[a.jsx("div",{className:"ad-questionHeader",children:a.jsxs("div",{className:"ad-questionMeta",children:[a.jsx("strong",{children:e.name}),a.jsx("span",{className:"ad-questionEmail",children:e.email}),a.jsx("span",{className:"ad-questionDate",children:new Date(e.createdAt).toLocaleDateString()})]})}),a.jsx("div",{className:"ad-questionText",children:e.question}),a.jsxs("div",{className:"ad-questionActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>{const s=prompt("Enter your answer to this question:");s&&s.trim()&&U(e.id,s.trim())},children:"âœï¸ Answer"}),a.jsx("button",{className:"ad-btn ghost small",onClick:()=>{window.confirm("Archive this question without answering?")&&F(e.id)},children:"ðŸ“ Archive"})]})]},e.id))})]}),a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:n("dashboard.admin.publishedManuals")||"Published Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[m.filter(e=>e.status==="published").length," ",n("dashboard.admin.published")||"published"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:n("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:n("dashboard.admin.author")||"Author"}),a.jsx("span",{children:n("dashboard.admin.category")||"Category"}),a.jsx("span",{children:n("dashboard.admin.created")||"Created"}),a.jsx("span",{children:n("dashboard.admin.actions")||"Actions"})]}),m.filter(e=>e.status==="published").map(e=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:e.title}),a.jsx("span",{className:"ad-tableAuthor",children:e.author}),a.jsx("span",{className:"ad-tableCategory",children:e.category}),a.jsx("span",{className:"ad-tableDate",children:e.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/manual/${e.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/edit-manual/${e.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:s=>{s.stopPropagation(),E(e.id,e.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},e.id))," ",m.filter(e=>e.status==="published").length===0&&a.jsx("div",{className:"ad-empty",children:n("dashboard.admin.noPublishedManuals")||"No published manuals found"})]})]}),a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsxs("h2",{className:"ad-cardTitle",children:["ðŸ”"," ",n("dashboard.admin.topSearches")||"Top search terms (last 7 days)"]}),a.jsxs("span",{className:"ad-cardMeta",children:[N.length," ",n("dashboard.admin.queries")||"queries"]})]}),N.length===0?a.jsx("div",{className:"ad-empty",children:n("dashboard.admin.noSearchData")||"No search data yet. Search analytics will appear here once users start searching for manuals."}):a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:n("dashboard.admin.query")||"Query"}),a.jsx("span",{children:n("dashboard.admin.searchCount")||"Count"}),a.jsx("span",{children:n("dashboard.admin.noResults")||"No-result searches"})]}),N.map((e,s)=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:a.jsxs("strong",{children:['"',e.query,'"']})}),a.jsx("span",{className:"ad-tableCount",children:e.count}),a.jsx("span",{className:`ad-tableNoResults ${e.noResultCount>0?"ad-warning":""}`,children:e.noResultCount>0?a.jsxs(a.Fragment,{children:["âš ï¸ ",e.noResultCount]}):a.jsxs(a.Fragment,{children:["âœ“ ",e.noResultCount]})})]},s))]}),N.some(e=>e.noResultCount>0)&&a.jsxs("div",{className:"ad-searchTip",children:[a.jsx("span",{className:"ad-tipIcon",children:"ðŸ’¡"}),a.jsx("span",{children:n("dashboard.admin.searchTip")||"Queries with no results may indicate missing manuals. Consider creating guides for these topics."})]})]})]})]}),a.jsx(_,{show:p.show,onHide:D,title:p.title,message:p.message,variant:p.variant,onConfirm:p.onConfirm,confirmText:p.confirmText,cancelText:p.cancelText})]}):a.jsx("main",{className:"ad-page",children:a.jsx("div",{className:"ad-inner",children:a.jsx("div",{className:"ad-loading",children:"Loading..."})})})};export{ua as default};
