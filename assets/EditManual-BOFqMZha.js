import{j as a,o as ue,n as me}from"./ui-Cx5CCx16.js";import{u as he,h as pe,i as ge,r as c}from"./vendor-D6EYvIws.js";import{u as fe}from"./utils-BWPLNOGI.js";import{u as xe,A as ve}from"./AlertModal-BK-lIpzZ.js";import{b as be}from"./UserData-CNiV9beM.js";import{m as ye}from"./ManualData-CCWVZZls.js";/* empty css                   */const Ue=()=>{const{t:o}=fe(),h=he(),{id:q}=pe(),[W]=ge(),u=q||W.get("edit"),{modalState:T,showAlert:p,hideAlert:H}=xe(),[K,Y]=c.useState(!0),[i,X]=c.useState(null),[g,P]=c.useState(""),[C,B]=c.useState(""),[I,x]=c.useState([{id:1,type:"text",value:"",showToolbar:!1}]),[A,R]=c.useState(null),[je,Z]=c.useState(null),[w,O]=c.useState(null),[v,G]=c.useState(null),[N,V]=c.useState("IT"),[U,L]=c.useState(""),[Q,_]=c.useState("EN"),[y,k]=c.useState([]);c.useEffect(()=>{(()=>{try{const t=localStorage.getItem("userData"),s=localStorage.getItem("authToken");if(!t||!s){h("/login");return}const l=JSON.parse(t);if(l.role!=="creator"&&l.role!=="admin"){h("/");return}if(!u){h("/creator-dashboard");return}const m=JSON.parse(localStorage.getItem("customManuals")||"[]"),f=new Set(m.map(d=>d.id)),b=ye.filter(d=>!f.has(d.id)),n=[...m,...b].find(d=>String(d.id)===String(u)||d.id===parseInt(u));if(!n){p(o("editManual.notFound")||"Manual not found!","error"),setTimeout(()=>h("/creator-dashboard"),1500);return}const S=`${l.firstName} ${l.lastName}`;if(l.role!=="admin"&&n.author!==S&&n.author!==l.username){p(o("editManual.noPermission")||"You don't have permission to edit this manual!","error"),setTimeout(()=>h("/creator-dashboard"),1500);return}if(X(n),P(n.title||""),B(n.description||""),V(n.category||"IT"),k(n.tags||[]),console.log("âœ… Manual loaded successfully:",{id:n.id,title:n.title,status:n.status,hasBlocks:!!n.blocks,hasSections:!!n.sections}),n.thumbnail){O(n.thumbnail);const d=n.thumbnail.split("/");R(d[d.length-1])}let r="1.0";if(n.version)r=n.version;else if(n.meta){const d=n.meta.match(/v(\d+\.\d+)/);d&&(r=d[1])}L(r);let j=[];if(n.blocks&&n.blocks.length>0)j=n.blocks;else if(n.sections&&n.sections.length>0){let d=1;j=n.sections.flatMap(E=>[{id:d++,type:"heading",value:E.title,showToolbar:!1},{id:d++,type:"text",value:E.content,showToolbar:!1}])}else j=[{id:1,type:"text",value:n.description||"",showToolbar:!1}];x(j)}catch(t){console.error("Error loading manual:",t),h("/creator-dashboard")}finally{Y(!1)}})()},[u]);const ee=(e="text")=>{const t=Date.now()+Math.floor(Math.random()*1e3);x(s=>[...s,{id:t,type:e,value:"",imageFile:null,imageUrl:"",showToolbar:!1}])},ae=e=>{x(t=>t.map(s=>s.id===e?{...s,showToolbar:!s.showToolbar}:s))},M=(e,t)=>{x(s=>s.map(l=>l.id===e?{...l,type:t,value:t==="image"?"":l.value}:l))},$=(e,t)=>{x(s=>s.map(l=>l.id===e?{...l,value:t}:l))},te=e=>{if(I.length<=1){p("You must have at least one block in your manual.","warning");return}x(t=>t.filter(s=>s.id!==e))},z=(e,t)=>{if(t){const s=new FileReader;s.onloadend=()=>{x(l=>l.map(m=>m.id===e?{...m,imageFile:t,imageUrl:s.result,value:t.name}:m))},s.readAsDataURL(t)}},J=(e,t)=>{x(s=>s.map(l=>l.id===e?{...l,imageUrl:t,value:t}:l))},se=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];R(t.name),Z(t);const s=new FileReader;s.onloadend=()=>{O(s.result)},s.readAsDataURL(t)}},le=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0],s=new FileReader;s.onloadend=()=>{const l={name:t.name,size:t.size,type:t.type,dataUrl:s.result};G(l)},s.readAsDataURL(t)}},ne=e=>{if(e.key==="Enter"){e.preventDefault();const t=e.target.value.trim();t&&!y.includes(t)&&(k([...y,t]),e.target.value="")}},ie=e=>{k(y.filter(t=>t!==e))},oe=()=>{if(!g.trim()){p("Please enter a manual title","warning");return}console.log("ðŸ’¾ Saving as draft...",{editId:u,title:g});let e="Anonymous",t=null;try{const l=JSON.parse(localStorage.getItem("userData"));l&&(t=l,e=`${l.firstName} ${l.lastName}`)}catch(l){console.error("Error getting user data",l)}const s={...i,title:g,description:C,category:N,meta:`${N} â€¢ ${U||"v1.0"}`,tags:y,author:e,updatedAt:new Date().toISOString().split("T")[0],difficulty:i.difficulty||"Beginner",estimatedTime:i.estimatedTime||"10 min",thumbnail:w||i.thumbnail,blocks:I,fileInfo:v||i.fileInfo,status:"draft"};try{const l=JSON.parse(localStorage.getItem("customManuals")||"[]"),m=l.findIndex(f=>String(f.id)===String(u)||f.id===parseInt(u));m!==-1?l[m]=s:l.push(s),localStorage.setItem("customManuals",JSON.stringify(l)),console.log("Manual saved as draft:",s),window.dispatchEvent(new Event("manualUpdated")),p("Manual saved as draft! Redirecting to dashboard...","success"),setTimeout(()=>{h("/creator-dashboard")},1e3)}catch(l){console.error("Error saving manual:",l),p("Failed to save manual","error")}},re=()=>{if(!g.trim()){p("Please enter a manual title","warning");return}console.log("ðŸ“ Updating manual...",{editId:u,title:g,status:i?.status});let e="Anonymous",t=null;try{const r=JSON.parse(localStorage.getItem("userData"));r&&(t=r,e=`${r.firstName} ${r.lastName}`)}catch(r){console.error("Error getting user data",r)}let s;t?.role==="admin"?s=i.status==="draft"?"published":i.status||"published":t?.role==="creator"?i.status==="published"?s="pending":s=i.status||"pending":s=i.status||"published";const l=i.author||e,m=r=>String(r||"").trim().replace(/^v/i,"")||"1.0",f=m(i.version),b=m(U),D=i.versions||[f];let n=[...D];D.includes(b)||n.push(b);const S={...i,title:g,description:C,category:N,version:b,versions:n,meta:`${N} â€¢ v${b}`,tags:y,author:l,updatedBy:t?`${t.firstName} ${t.lastName}`:void 0,updatedAt:new Date().toISOString().split("T")[0],difficulty:i.difficulty||"Beginner",estimatedTime:i.estimatedTime||"10 min",thumbnail:w||i.thumbnail,blocks:I,fileInfo:v||i.fileInfo,status:s};try{const r=JSON.parse(localStorage.getItem("customManuals")||"[]"),j=r.findIndex(d=>String(d.id)===String(u)||d.id===parseInt(u));j!==-1?r[j]=S:r.push(S),localStorage.setItem("customManuals",JSON.stringify(r)),console.log("Manual updated:",S),window.dispatchEvent(new Event("manualUpdated")),f!==b?(console.log(`Version changed from ${f} to ${b}, notifying bookmarked users`),ue(u,g)):console.log(`Version unchanged (${f}), skipping bookmark notifications`),t?.role==="creator"&&i.status==="published"&&s==="pending"&&be().filter(F=>F.role==="admin").forEach(F=>{me({userId:String(F.id),message:`Manual "${g}" by ${l} updated and needs re-approval`,type:"info",link:"/admin-dashboard"})}),t?.role==="admin"?(p("Manual updated successfully! Redirecting to manual page...","success"),setTimeout(()=>{h(`/manual/${u}`)},1e3)):(p("Manual updated successfully! Redirecting to dashboard...","success"),setTimeout(()=>{h("/creator-dashboard")},1e3))}catch(r){console.error("Error saving manual:",r),p("Failed to save manual","error")}},de=e=>{let t="block-input";return e.type==="heading"?t+=" block-heading":e.type==="quote"?t+=" block-quote":e.type==="code"&&(t+=" block-code"),t},ce=e=>{const t=e.imageUrl&&(e.imageUrl.startsWith("data:")||e.imageUrl.startsWith("http://")||e.imageUrl.startsWith("https://"));return a.jsx("div",{className:"image-block",children:t?a.jsxs("div",{className:"image-preview",children:[a.jsx("img",{src:e.imageUrl,alt:"Preview",className:"image-preview-img",onError:s=>{s.target.style.display="none",console.warn("Failed to load image:",e.imageUrl)}}),a.jsxs("div",{className:"image-controls",children:[a.jsx("input",{type:"text",placeholder:o("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{$(e.id,s.target.value),s.target.value.startsWith("http")&&J(e.id,s.target.value)},className:"image-url-input"}),a.jsxs("label",{className:"image-upload-btn",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>z(e.id,s.target.files[0]),style:{display:"none"}}),o("createManual.uploadImage")]})]})]}):a.jsx("div",{className:"image-placeholder",children:a.jsxs("div",{className:"image-upload-area",children:[a.jsxs("label",{className:"image-upload-label",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>z(e.id,s.target.files[0]),style:{display:"none"}}),a.jsx("div",{className:"upload-icon",children:"ðŸ“·"}),a.jsx("div",{children:o("createManual.uploadImage")})]}),a.jsx("div",{className:"or-divider",children:o("common.or")}),a.jsx("input",{type:"text",placeholder:o("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{$(e.id,s.target.value),s.target.value.startsWith("http")&&J(e.id,s.target.value)},className:"image-url-input"})]})})})};return K?a.jsx("div",{className:"root",children:a.jsx("div",{className:"page",children:a.jsx("div",{className:"loading-state",children:a.jsx("h2",{children:o("editManual.loading")||"Loading manual..."})})})}):i?a.jsxs("div",{className:"root",children:[a.jsxs("div",{className:"page",children:[a.jsxs("section",{className:"editor-panel",children:[a.jsx("input",{className:"editor-title",placeholder:o("createManual.titlePlaceholder"),value:g,onChange:e=>P(e.target.value)}),a.jsx("textarea",{className:"editor-desc",rows:2,placeholder:o("createManual.contentPlaceholder"),value:C,onChange:e=>B(e.target.value)}),a.jsx("div",{className:"editor-divider"}),a.jsx("div",{className:"blocks",children:I.map(e=>a.jsxs("div",{className:`block ${e.showToolbar?"block-show-toolbar":""}`,children:[a.jsx("button",{type:"button",className:"block-plus",onClick:()=>ae(e.id),children:"+"}),a.jsxs("div",{className:"block-toolbar",children:[a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="text"?"toolbar-btn-active":""}`,onClick:()=>M(e.id,"text"),children:"T"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="heading"?"toolbar-btn-active":""}`,onClick:()=>M(e.id,"heading"),children:"H"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="quote"?"toolbar-btn-active":""}`,onClick:()=>M(e.id,"quote"),children:"â"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="code"?"toolbar-btn-active":""}`,onClick:()=>M(e.id,"code"),children:"{ }"})," ",a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="image"?"toolbar-btn-active":""}`,onClick:()=>M(e.id,"image"),children:"ðŸ–¼ï¸"}),a.jsx("button",{type:"button",className:"toolbar-btn toolbar-btn-delete",onClick:()=>te(e.id),style:{marginLeft:"auto",color:"#ef4444",borderColor:"#ef4444"},title:"Delete this block",children:"ðŸ—‘ï¸"})]}),e.type==="image"?ce(e):a.jsx("textarea",{className:de(e),placeholder:e.type==="heading"?o("createManual.blockPlaceholders.heading"):e.type==="quote"?o("createManual.blockPlaceholders.quote"):e.type==="code"?o("createManual.blockPlaceholders.code"):o("createManual.blockPlaceholders.text"),value:e.value,onChange:t=>$(e.id,t.target.value)})]},e.id))}),a.jsxs("button",{type:"button",className:"btn-add-block",onClick:()=>ee("text"),children:["+ ",o("createManual.addBlock")]})]})," ",a.jsxs("aside",{className:"meta-panel",children:[a.jsxs("div",{className:"meta-card",children:[a.jsx("div",{className:"meta-title",children:o("editManual.manualDetails")}),a.jsx("div",{className:"meta-caption",children:o("editManual.manualDetailsCaption")}),a.jsx("div",{className:"meta-field-label",children:o("editManual.thumbnailLabel")}),w&&a.jsx("div",{className:"thumbnail-preview",children:a.jsx("img",{src:w,alt:"Thumbnail preview",style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"8px",marginBottom:"8px"}})}),a.jsxs("label",{className:"thumb-box",children:[a.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:se}),A||"Click to upload thumbnail"]}),a.jsx("div",{className:"meta-field-label",children:"Category (à¸«à¸¡à¸§à¸”à¹ƒà¸«à¸à¹ˆ)"}),a.jsxs("select",{className:"meta-select",value:N,onChange:e=>V(e.target.value),children:[a.jsx("option",{children:"IT"}),a.jsx("option",{children:"Design"}),a.jsx("option",{children:"Marketing"}),a.jsx("option",{children:"HR"}),a.jsx("option",{children:"Operations"}),a.jsx("option",{children:"Customer Support"})]}),a.jsx("div",{className:"meta-field-label",children:"Tags"}),a.jsx("input",{className:"meta-input",placeholder:"Type tag and press Enter",onKeyDown:ne}),a.jsxs("div",{className:"tag-box",children:[y.map((e,t)=>a.jsxs("span",{className:"tag-pill",onClick:()=>ie(e),title:"Click to remove",children:[e," Ã—"]},t)),y.length===0&&a.jsx("span",{style:{color:"var(--text-muted)",fontSize:"12px"},children:"No tags added yet"})]}),a.jsxs("div",{className:"meta-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Version"}),a.jsx("input",{className:"meta-input",placeholder:"à¹€à¸Šà¹ˆà¸™ 1.0 à¸«à¸£à¸·à¸­ 2.1",value:U,onChange:e=>L(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Language"}),a.jsxs("select",{className:"meta-select",value:Q,onChange:e=>_(e.target.value),children:[a.jsx("option",{children:"TH"}),a.jsx("option",{children:"EN"})]})]})]}),a.jsx("div",{className:"meta-field-label",style:{marginTop:10},children:"Manual file (PDF / DOCX / ZIP)"}),a.jsxs("label",{className:"file-btn",children:[a.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.zip",style:{display:"none"},onChange:le}),v?`ðŸ“Ž ${typeof v=="object"?v.name:v}`:i?.fileInfo?`ðŸ“Ž ${typeof i.fileInfo=="object"?i.fileInfo.name:i.fileInfo}`:"ðŸ“Ž Upload manual file"]})," ",(v||i?.fileInfo)&&a.jsx("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginTop:"4px"},children:(()=>{const e=v||i.fileInfo;return typeof e=="object"?`${(e.size/1024).toFixed(1)} KB â€¢ ${e.type||"Unknown type"}`:"File uploaded"})()}),a.jsx("p",{className:"meta-note",children:"à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹ƒà¸™à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¹€à¸žà¸µà¸¢à¸‡à¹€à¸à¸£à¸´à¹ˆà¸™à¸™à¸³à¹à¸¥à¸°à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸šà¸²à¸‡à¸ªà¹ˆà¸§à¸™ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸”à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œà¸”à¹‰à¸²à¸™à¸šà¸™à¹€à¸žà¸·à¹ˆà¸­à¸­à¹ˆà¸²à¸™à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸‰à¸šà¸±à¸šà¹€à¸•à¹‡à¸¡à¹„à¸”à¹‰"})," ",a.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[a.jsxs("button",{type:"button",className:"draft-btn",onClick:oe,style:{flex:1,padding:"10px 16px",borderRadius:"8px",border:"1px solid var(--border)",background:"transparent",color:"var(--text)",cursor:"pointer",fontSize:"14px",fontWeight:500},children:["ðŸ’¾ ",o("editManual.saveAsDraft")||"Save as Draft"]}),a.jsx("button",{type:"button",className:"publish-btn",onClick:re,style:{flex:1},children:o("editManual.updateManual")||"Update Manual"})]})]})," "]})]}),a.jsx(ve,{show:T.show,onHide:H,title:T.title,message:T.message,variant:T.variant})]}):a.jsx("div",{className:"root",children:a.jsx("div",{className:"page",children:a.jsxs("div",{className:"error-state",children:[a.jsx("h2",{children:o("editManual.notFound")||"Manual not found"}),a.jsx("button",{onClick:()=>h("/creator-dashboard"),children:o("editManual.backToDashboard")||"Back to Dashboard"})]})})})};export{Ue as default};
