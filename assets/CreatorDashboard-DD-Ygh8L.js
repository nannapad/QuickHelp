import{j as a}from"./ui-C0p69nPY.js";import{r as b,u as C}from"./vendor-D6EYvIws.js";import{u as D,A as S}from"./AlertModal-1ndUfbGP.js";import{g as T}from"./manualRepository-BSTK98NG.js";import{u as A}from"./utils-dQ_ya9vc.js";import"./ManualData-CCWVZZls.js";const V=()=>{const[N,g]=b.useState(null),[r,x]=b.useState([]),{t:s}=A(),i=C(),{modalState:n,showAlert:u,showConfirm:p,hideAlert:v}=D();if(b.useEffect(()=>{const e=localStorage.getItem("userData"),t=localStorage.getItem("authToken");if(!e||!t){i("/login");return}const c=JSON.parse(e);if(c.role!=="creator"&&c.role!=="admin"){i("/");return}g(c);const d=`${c.firstName} ${c.lastName}`;T();const o=manuals.filter(l=>l.author===d||l.author===c.username),y=customManuals.filter(l=>l.author===d||l.author===c.username),M=o.filter(l=>!customIds.has(l.id)),w=[...y.map(l=>({...l,status:l.status||"published",views:l.views||0})),...M.map(l=>({...l,status:"published",views:l.views||0}))];x(w)},[i]),!N)return a.jsx("main",{className:"cd-page",children:a.jsx("div",{className:"cd-inner",children:a.jsx("div",{className:"cd-loading",children:"Loading..."})})});const j=r.filter(e=>e.status==="published"),m=r.filter(e=>e.status==="draft"),h=r.filter(e=>e.status==="pending"),f=j.reduce((e,t)=>e+(t.views||0),0);return a.jsxs("main",{className:"cd-page",children:[a.jsxs("div",{className:"cd-inner",children:[" ",a.jsxs("header",{className:"cd-header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"cd-title",children:s("dashboard.creator.title")||"Creator Dashboard"}),a.jsx("p",{className:"cd-sub",children:s("dashboard.creator.subtitle")||"Overview of your manuals, drafts, and recent activity"})]}),a.jsxs("button",{className:"cd-btn primary",onClick:()=>i("/create-manual"),children:[" ","+ ",s("dashboard.creator.createManual")||"Create manual"]})]})," ",a.jsxs("section",{className:"cd-summaryGrid",children:[a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:s("dashboard.creator.publishedManuals")||"Published manuals"}),a.jsx("div",{className:"cd-summaryValue",children:j.length}),a.jsx("div",{className:"cd-summarySub",children:s("dashboard.creator.publishedDesc")||"Manuals that are live and searchable"})]}),a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:s("dashboard.creator.pendingManuals")||"Pending approval"}),a.jsx("div",{className:"cd-summaryValue",children:h.length}),a.jsx("div",{className:"cd-summarySub",children:s("dashboard.creator.pendingDesc")||"Manuals awaiting admin approval"})]}),a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:s("dashboard.creator.drafts")||"Drafts"}),a.jsx("div",{className:"cd-summaryValue",children:m.length}),a.jsx("div",{className:"cd-summarySub",children:s("dashboard.creator.draftsDesc")||"Unpublished manuals you can continue editing"})]}),a.jsxs("div",{className:"cd-summaryCard",children:[a.jsx("div",{className:"cd-summaryLabel",children:s("dashboard.creator.totalViews")||"Total views"}),a.jsx("div",{className:"cd-summaryValue",children:f}),a.jsx("div",{className:"cd-summarySub",children:s("dashboard.creator.viewsDesc")||"Total views across all your manuals"})]})]}),a.jsxs("div",{className:"cd-mainGrid",children:[" ",a.jsxs("section",{className:"cd-card",children:[a.jsxs("div",{className:"cd-cardHeader",children:[a.jsx("h2",{className:"cd-cardTitle",children:s("dashboard.creator.myManuals")||"My manuals"}),a.jsxs("span",{className:"cd-cardMeta",children:[r.length," total â€¢ ",j.length," ",s("dashboard.creator.published")||"published",h.length>0&&a.jsxs(a.Fragment,{children:[" â€¢ ",h.length," pending"]})]})]})," ",a.jsxs("div",{className:"cd-table",children:[a.jsxs("div",{className:"cd-tableHead",children:[a.jsx("span",{children:s("dashboard.admin.title")||"Title"}),a.jsx("span",{children:s("dashboard.creator.category")||"Category"}),a.jsx("span",{children:s("dashboard.creator.status")||"Status"}),a.jsx("span",{children:s("dashboard.creator.lastUpdated")||"Last updated"}),a.jsx("span",{children:s("dashboard.creator.views")||"Views"}),a.jsx("span",{children:s("dashboard.creator.actions")||"Actions"})]}),r.map(e=>a.jsxs("div",{className:"cd-tableRow cd-tableRowActions",children:[a.jsx("span",{className:"cd-tableTitle",children:e.title}),a.jsx("span",{className:"cd-tableCategory",children:e.category}),a.jsx("span",{className:`cd-statusPill cd-${e.status}`,children:e.status}),a.jsx("span",{className:"cd-tableDate",children:e.updatedAt||e.createdAt}),a.jsx("span",{className:"cd-tableViews",children:e.views}),a.jsxs("span",{className:"cd-tableActions",children:[e.status==="published"&&a.jsx("button",{className:"cd-btn ghost small",onClick:()=>i(`/manual/${e.id}`),title:"View manual",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"cd-btn ghost small",onClick:()=>i(`/edit-manual/${e.id}`),title:"Edit manual",children:"âœï¸"})," ",a.jsx("button",{className:"cd-btn ghost small",onClick:()=>{p(`Delete manual "${e.title}"? This action cannot be undone.`,()=>{try{const c=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(d=>d.id!==e.id);localStorage.setItem("customManuals",JSON.stringify(c)),x(d=>d.filter(o=>o.id!==e.id)),window.dispatchEvent(new Event("manualUpdated")),u("Manual deleted successfully","success")}catch(t){console.error(t),u("Failed to delete manual","error")}},"danger","Confirm Deletion","Delete","Cancel")},title:"Delete manual",style:{color:"#ef4444"},children:"ðŸ—‘ï¸"})]})]},e.id))," ",r.length===0&&a.jsx("div",{className:"cd-empty",children:s("dashboard.creator.noManuals")||"No manuals yet. Try creating your first manual!"})]})," "]})," ",a.jsxs("section",{className:"cd-card",children:[a.jsxs("div",{className:"cd-cardHeader",children:[a.jsx("h2",{className:"cd-cardTitle",children:s("dashboard.creator.draftManuals")||"Draft Manuals"}),a.jsxs("span",{className:"cd-cardMeta",children:[m.length," ",s("dashboard.creator.draft")||"draft",m.length!==1&&"s"]})]}),a.jsxs("div",{className:"cd-draftList",children:[m.map(e=>a.jsxs("div",{className:"cd-draftItem",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"cd-draftTitle",children:[e.title,a.jsx("span",{className:`cd-statusPill cd-${e.status}`,style:{marginLeft:"8px",fontSize:"9px"},children:e.status})]}),a.jsxs("div",{className:"cd-draftMeta",children:[e.category," â€¢"," ",s("dashboard.creator.lastEdited")||"last edited"," ",e.updatedAt||e.createdAt]})]})," ",a.jsxs("div",{style:{display:"flex",gap:"8px"},children:[a.jsx("button",{className:"cd-btn ghost",onClick:()=>i(`/edit-draft/${e.id}`),children:s("dashboard.creator.publish")||"Publish"}),a.jsx("button",{className:"cd-btn ghost",onClick:()=>{p(`${s("common.delete")||"Delete"} "${e.title}"? This action cannot be undone.`,()=>{try{const c=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(d=>d.id!==e.id);localStorage.setItem("customManuals",JSON.stringify(c)),x(d=>d.filter(o=>o.id!==e.id)),window.dispatchEvent(new Event("manualUpdated")),u("Draft deleted successfully","success")}catch(t){console.error(t),u("Failed to delete draft","error")}},"danger","Confirm Deletion","Delete","Cancel")},title:s("common.delete")||"Delete draft",style:{color:"#ef4444"},children:"ðŸ—‘ï¸"})]})]},e.id)),m.length===0&&a.jsx("div",{className:"cd-empty",children:s("dashboard.creator.noDraftsMessage")||"No draft manuals. When you save as draft, they will appear here."})]}),h.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"cd-divider",style:{margin:"20px 0"}}),a.jsxs("div",{className:"cd-cardHeader",children:[a.jsx("h2",{className:"cd-cardTitle",children:s("dashboard.creator.pendingManuals")||"Pending Approval"}),a.jsxs("span",{className:"cd-cardMeta",children:[h.length," ",s("dashboard.creator.pending")||"pending"]})]}),a.jsx("div",{className:"cd-draftList",children:h.map(e=>a.jsxs("div",{className:"cd-draftItem",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"cd-draftTitle",children:[e.title,a.jsx("span",{className:`cd-statusPill cd-${e.status}`,style:{marginLeft:"8px",fontSize:"9px"},children:e.status})]}),a.jsxs("div",{className:"cd-draftMeta",children:[e.category," â€¢"," ",s("dashboard.creator.submitted")||"submitted"," ",e.updatedAt||e.createdAt]})]}),a.jsxs("div",{style:{display:"flex",gap:"8px"},children:[a.jsx("button",{className:"cd-btn ghost",onClick:()=>i(`/edit-manual/${e.id}`),children:s("dashboard.creator.edit")||"Edit"}),a.jsx("button",{className:"cd-btn ghost",onClick:()=>{p(`${s("common.delete")||"Delete"} "${e.title}"? This action cannot be undone.`,()=>{try{const c=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(d=>d.id!==e.id);localStorage.setItem("customManuals",JSON.stringify(c)),x(d=>d.filter(o=>o.id!==e.id)),window.dispatchEvent(new Event("manualUpdated")),u("Pending manual deleted successfully","success")}catch(t){console.error(t),u("Failed to delete manual","error")}},"danger","Confirm Deletion","Delete","Cancel")},title:s("common.delete")||"Delete",style:{color:"#ef4444"},children:"ðŸ—‘ï¸"})]})]},e.id))})]})," ",a.jsx("div",{className:"cd-divider"}),a.jsx("div",{className:"cd-cardHeader",children:a.jsx("h2",{className:"cd-cardTitle",children:s("dashboard.creator.recentActivity")||"Recent activity"})}),a.jsxs("ul",{className:"cd-activityList",children:[r.length>0?a.jsx(a.Fragment,{children:r.slice(0,3).map((e,t)=>a.jsxs("li",{children:[a.jsx("span",{className:"cd-dot"}),e.status==="published"?`Manual "${e.title}" is published and live`:e.status==="pending"?`Manual "${e.title}" is pending approval`:`Draft "${e.title}" was last updated ${e.updatedAt||e.createdAt}`]},t))}):a.jsxs("li",{children:[a.jsx("span",{className:"cd-dot"}),s("dashboard.creator.noActivity")||"No recent activity. Create your first manual to get started!"]})," "]})]})]})]}),a.jsx(S,{show:n.show,onHide:v,title:n.title,message:n.message,variant:n.variant,onConfirm:n.onConfirm,confirmText:n.confirmText,cancelText:n.cancelText})]})};export{V as default};
