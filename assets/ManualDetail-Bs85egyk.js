import{g as ie,h as oe,k as le,l as re,j as e,m as P,b as ce,t as de}from"./ui-C0p69nPY.js";import{h as me,u as ue,r as l}from"./vendor-D6EYvIws.js";import{u as he,A as xe}from"./AlertModal-1ndUfbGP.js";import"./index-DGOrCYxL.js";import{m as x}from"./ManualData-CCWVZZls.js";import"./utils-dQ_ya9vc.js";const R=[{id:1,manualId:1,userId:1,author:"John Doe",text:"Great guide! Very helpful for setting up VS Code.",createdAt:"2024-11-20"},{id:2,manualId:1,userId:2,author:"Maria Garcia",text:"Thanks for the detailed instructions. This saved me a lot of time!",createdAt:"2024-11-21"},{id:3,manualId:2,userId:1,author:"John Doe",text:"The Figma integration steps are spot on. Worked perfectly!",createdAt:"2024-11-19"},{id:4,manualId:3,userId:3,author:"Sarah Johnson",text:"This onboarding checklist is comprehensive. Will definitely use it for new hires.",createdAt:"2024-11-18"},{id:5,manualId:2,userId:3,author:"Sarah Johnson",text:"Could you add more screenshots? Visual examples would help.",createdAt:"2024-11-22"}],ke=()=>{const{id:r}=me(),f=ue(),[p,E]=l.useState(!1),[g,T]=l.useState(!1),[w,j]=l.useState(!1),[fe,V]=l.useState(0),[pe,B]=l.useState(0),[J,N]=l.useState(""),[o,W]=l.useState(null),[v,D]=l.useState(""),[k,A]=l.useState(!1),[y,I]=l.useState([]),[L,K]=l.useState(0),[O,S]=l.useState(null),[b,C]=l.useState(""),{modalState:m,showAlert:d,showConfirm:q,hideAlert:G}=he(),s=l.useMemo(()=>{if(!x||x.length===0)return null;const t=JSON.parse(localStorage.getItem("customManuals")||"[]"),a=new Set(t.map(i=>i.id)),n=x.filter(i=>!a.has(i.id)),c=[...t,...n];return c.find(i=>String(i.id)===String(r))||c[0]},[r,L]),H=l.useMemo(()=>{if(!o||!s)return!1;if(o.role==="admin")return!0;if(o.role==="creator"){const t=`${o.firstName} ${o.lastName}`;return s.author===t||s.author===o.username}return!1},[o,s]);l.useEffect(()=>{const t=localStorage.getItem("userData");if(t)try{const n=JSON.parse(t);if(W(n),r){const i=ie()[r]||{likedBy:[]};E(i.likedBy?i.likedBy.includes(parseInt(n.id)):!1),T(oe(n.id,r))}}catch(n){console.error("Error parsing user data:",n)}if(r){const n=localStorage.getItem("userData");let c=null;if(n)try{c=JSON.parse(n).id}catch{}const i=le(r,c),u=re(r);V(i),B(u.likes||0)}const a=()=>{K(n=>n+1)};return window.addEventListener("storage",a),window.addEventListener("manualUpdated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("manualUpdated",a)}},[r]),l.useEffect(()=>{if(s&&s.version)N(s.version);else if(s&&s.versions&&s.versions.length>0)N(s.versions[0]);else if(s&&s.meta){const t=s.meta.match(/v(\d+\.\d+)/);t&&N(t[1])}},[s]);const $=l.useMemo(()=>{if(!x||!s)return[];const t=JSON.parse(localStorage.getItem("customManuals")||"[]"),a=new Set(t.map(i=>i.id)),n=x.filter(i=>!a.has(i.id));return[...t,...n].filter(i=>i.id!==s.id&&(i.category===s.category||i.tags?.some(u=>s.tags?.includes(u)))).slice(0,3)},[s,L]),M=l.useMemo(()=>s?[...R?R.filter(a=>String(a.manualId)===String(s.id)):[],...y].sort((a,n)=>new Date(n.createdAt)-new Date(a.createdAt)):y,[s,y]),z=()=>{if(!o)return;const{liked:t,likes:a}=ce(r,o.id);E(t),B(a)},Y=()=>{if(!o||!s)return;const t=de(o.id,s);T(t),t&&d("Bookmarked! You will be notified when this manual is updated.","success","Bookmark Added")},Q=async()=>{try{await navigator.clipboard.writeText(window.location.href),j(!0),setTimeout(()=>{j(!1)},2e3),navigator.share&&await navigator.share({title:s.title,text:s.description,url:window.location.href})}catch(t){console.error("Error sharing:",t),j(!0),setTimeout(()=>{j(!1)},2e3)}},X=t=>{N(t.target.value)},F=t=>{const a=document.getElementById(`section-${t}`);a&&a.scrollIntoView({behavior:"smooth"})},Z=t=>{const a=new Date(t),c=Math.abs(new Date-a),i=Math.floor(c/(1e3*60*60*24)),u=Math.floor(c/(1e3*60*60)),h=Math.floor(c/(1e3*60*60));return i>0?i===1?"1d ago":`${i}d ago`:u>0?u===1?"1h ago":`${u}h ago`:h>0?h===1?"1m ago":`${h}m ago`:"Just now"},U=async()=>{if(!(!v.trim()||!o)){A(!0);try{const t={id:Date.now(),manualId:parseInt(r),userId:o.id,author:`${o.firstName} ${o.lastName}`,text:v.trim(),createdAt:new Date().toISOString().split("T")[0]};I(a=>[t,...a]),D(""),setTimeout(()=>{d("Comment posted successfully!","success","Comment Posted")},100)}catch(t){console.error("Error posting comment:",t),d("Failed to post comment. Please try again.","error","Error")}finally{A(!1)}}},_=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&U()},ee=t=>{S(t.id),C(t.text)},te=t=>{if(!b.trim()){d("Comment cannot be empty","error","Error");return}I(a=>a.map(n=>n.id===t?{...n,text:b.trim(),edited:!0}:n)),S(null),C(""),d("Comment updated successfully!","success","Updated")},se=()=>{S(null),C("")},ae=t=>{q("Delete this comment? This action cannot be undone.",()=>ne(t.id),"danger","Confirm Deletion","Delete","Cancel")},ne=t=>{I(a=>a.filter(n=>n.id!==t)),d("Comment deleted successfully!","success","Deleted")};return s?e.jsxs("main",{className:"manualPage",children:[e.jsxs("div",{className:"manualPageInner",children:[e.jsxs("div",{className:"breadcrumbRow",children:[e.jsx("button",{className:"backLink",type:"button",onClick:()=>f(-1),children:"â† Back"}),e.jsxs("div",{className:"breadcrumb",children:[s.category,s.subCategory?` â€¢ ${s.subCategory}`:"",` â€¢ ${s.title}`]})]}),e.jsxs("div",{className:"grid",children:[e.jsxs("article",{className:"left",children:[e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"topRow",children:[e.jsx("h1",{className:"title",children:s.title}),s.versions&&e.jsxs("div",{className:"versionRow",children:[e.jsxs("div",{className:"versionWrapper",children:[e.jsx("span",{className:"versionLabel",children:"Version"}),e.jsx("select",{className:"versionSelect",value:J,onChange:X,"aria-label":"Select version",children:s.versions.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("div",{className:"versionLine"})]})]}),e.jsxs("div",{className:"bottomRow",children:[e.jsxs("div",{className:"authorMetaRow",children:[e.jsx("div",{className:"authorAvatar",title:s.author,children:s.author.charAt(0).toUpperCase()}),e.jsxs("div",{className:"authorDetails",children:[e.jsxs("div",{className:"authorTop",children:[e.jsx("span",{className:"authorName",children:s.author}),e.jsx("span",{className:"metaSeparator",children:"â€¢"}),e.jsx("span",{className:"categoryBadge",children:s.category})]}),e.jsx("div",{className:"authorBottom",children:e.jsxs("span",{className:"metaText",children:["Updated ",s.updatedAt]})})]})]}),e.jsxs("div",{className:"headerActions",children:[H&&e.jsx("button",{className:"actionBtn editBtn",onClick:()=>f(`/edit-manual/${s.id}`),title:"Edit this manual",children:"Edit"}),e.jsx("button",{className:`actionBtn ${p?"liked":""}`,onClick:z,"aria-pressed":p,title:p?"Unlike this manual":"Like this manual",children:p?"Liked":"Like"})," ",e.jsx("button",{className:`actionBtn ${g?"bookmarked":""}`,onClick:Y,"aria-pressed":g,title:g?"Remove bookmark":"Bookmark this manual",children:g?"Bookmarked":"Bookmark"})," ",e.jsx("button",{className:`actionBtn ${w?"copied":""}`,onClick:Q,title:w?"Link copied!":"Share this manual",children:w?"Copied!":"Share"})]})]})]}),e.jsx("div",{className:"hero",children:e.jsx("div",{className:"heroContent",children:e.jsx("div",{className:"heroTitle",children:s.description})})}),(s.sections?.length>0||s.blocks?.some(t=>t.type==="heading"))&&e.jsxs("div",{className:"tocContainer",children:[e.jsx("h3",{className:"tocTitle",children:"Table of Contents"}),e.jsx("ul",{className:"tocList",children:s.blocks?s.blocks.filter(t=>t.type==="heading").map((t,a)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>F(a),children:t.value})},t.id||a)):s.sections.map((t,a)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>F(a),children:t.title})},a))})]}),e.jsx("div",{className:"contentBody",children:s.blocks?s.blocks.map((t,a)=>e.jsxs("div",{id:`section-${a}`,className:"blockWrapper",children:[t.type==="heading"&&e.jsx("h2",{className:"sectionTitle",children:t.value}),t.type==="text"&&e.jsx("p",{className:"text",children:t.value}),t.type==="quote"&&e.jsx("blockquote",{className:"quote",children:t.value}),t.type==="code"&&e.jsx("pre",{className:"codeBlock",children:e.jsx("code",{children:t.value})})," ",t.type==="image"&&e.jsx("div",{className:"imageWrapper",children:P(t.imageUrl||t.value)?e.jsx("img",{src:P(t.imageUrl||t.value),alt:"Manual content",className:"contentImage",onError:n=>{n.target.style.display="none",console.warn("Failed to load image:",t.imageUrl||t.value)}}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",background:"var(--bg-secondary)",borderRadius:"8px",color:"var(--text-muted)"},children:"ðŸ“· Image not available"})})]},t.id||a)):s.sections?s.sections.map((t,a)=>e.jsxs("section",{id:`section-${a}`,className:"section",children:[e.jsx("h2",{className:"sectionTitle",children:t.title}),e.jsx("p",{className:"text",children:t.content})]},a)):e.jsx("section",{className:"section",children:e.jsx("p",{className:"text",children:s.intro||"No content available for this manual."})})})]}),e.jsxs("aside",{className:"right",children:[" ",e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Download"}),e.jsxs("p",{className:"cardDesc",children:["Get the full ",s.fileInfo?"version":"PDF version"," for offline reading."]}),e.jsx("button",{type:"button",className:"btn primary full",onClick:()=>{if(s.fileInfo&&typeof s.fileInfo=="object"&&s.fileInfo.dataUrl){const t=document.createElement("a");t.href=s.fileInfo.dataUrl,t.download=s.fileInfo.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),d("Download started!","success","Downloading")}else d("File not available for download","warning","No File")},children:s.fileInfo?"Download File":"Download PDF"})," ",e.jsx("div",{className:"fileInfo",children:s.fileInfo&&typeof s.fileInfo=="object"?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[s.fileInfo.type?.split("/")[1]?.toUpperCase()||"FILE"," ","â€¢ ",(s.fileInfo.size/1024/1024).toFixed(2)," MB"]}),e.jsx("span",{children:s.fileInfo.name})]}):s.fileInfo&&typeof s.fileInfo=="string"?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"FILE"}),e.jsx("span",{children:s.fileInfo})]}):e.jsx(e.Fragment,{children:e.jsx("span",{style:{color:"var(--text-muted)"},children:"ðŸ“„ No file uploaded yet"})})})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Tags"}),e.jsx("div",{className:"tagsRow",children:(s.tags||[]).map(t=>e.jsx("span",{className:"tagChip",children:t},t))})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Related Manuals"}),e.jsxs("div",{className:"relatedList",children:[$.map(t=>e.jsxs("button",{className:"relatedItem",onClick:()=>f(`/manual/${t.id}`),children:[e.jsx("div",{className:"relatedTitle",children:t.title}),e.jsxs("div",{className:"relatedMeta",children:[t.category," â€¢ ",t.views," views"]})]},t.id)),$.length===0&&e.jsx("div",{className:"empty",children:"No related manuals found"})]})]}),e.jsxs("section",{className:"card",children:[e.jsxs("h3",{className:"cardTitle",children:["Comments (",M.length,")"]}),o?e.jsxs("div",{className:"commentInputWrapper",children:[e.jsx("textarea",{className:"commentInput",rows:3,placeholder:"Add a comment... (Ctrl+Enter to post)",value:v,onChange:t=>D(t.target.value),onKeyPress:_,disabled:k}),e.jsx("button",{className:"commentSubmitBtn",onClick:U,disabled:!v.trim()||k,children:k?"Posting...":"Post"})]}):e.jsx("div",{className:"commentLoginPrompt",children:e.jsxs("p",{children:["Please"," ",e.jsx("button",{onClick:()=>f("/login"),className:"loginLink",children:"login"})," ","to add a comment"]})}),e.jsxs("div",{className:"commentList",children:[M.map(t=>e.jsxs("div",{className:"commentRow",children:[e.jsx("div",{className:"commentAvatar",children:t.author?.[0]?.toUpperCase()}),e.jsxs("div",{className:"commentContent",children:[e.jsxs("div",{className:"commentHeader",children:[e.jsx("span",{className:"commentAuthor",children:t.author}),e.jsxs("span",{className:"commentTime",children:[Z(t.createdAt),t.edited&&e.jsx("span",{className:"editedBadge",children:" (edited)"})]}),o&&t.userId===o.id&&e.jsxs("div",{className:"commentActions",children:[e.jsx("button",{className:"commentActionBtn",onClick:()=>ee(t),title:"Edit comment",children:"âœï¸"}),e.jsx("button",{className:"commentActionBtn deleteBtn",onClick:()=>ae(t),title:"Delete comment",children:"ðŸ—‘ï¸"})]})]}),O===t.id?e.jsxs("div",{className:"commentEditWrapper",children:[e.jsx("textarea",{className:"commentEditInput",value:b,onChange:a=>C(a.target.value),rows:3,autoFocus:!0}),e.jsxs("div",{className:"commentEditActions",children:[e.jsx("button",{className:"commentEditSaveBtn",onClick:()=>te(t.id),children:"Save"}),e.jsx("button",{className:"commentEditCancelBtn",onClick:se,children:"Cancel"})]})]}):e.jsx("p",{className:"commentText",children:t.text})]})]},t.id)),M.length===0&&e.jsxs("div",{className:"empty",children:["No comments yet."," ",o?"Be the first to comment!":"Login to be the first to comment!"]})]})]})," "]})]})]}),e.jsx(xe,{show:m.show,onHide:G,title:m.title,message:m.message,variant:m.variant,onConfirm:m.onConfirm,confirmText:m.confirmText,cancelText:m.cancelText})]}):e.jsx("main",{className:"manualPage",children:e.jsx("div",{className:"manualPageInner",children:e.jsx("p",{children:"Manual not found."})})})};export{ke as default};
