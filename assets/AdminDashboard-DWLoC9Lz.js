import{j as a,n as b}from"./ui-Cx5CCx16.js";import{r as g,u as z}from"./vendor-D6EYvIws.js";import{u as B,A as _}from"./AlertModal-BK-lIpzZ.js";import{g as K}from"./manualRepository-BSTK98NG.js";import{b as q}from"./UserData-CNiV9beM.js";import{b as W,u as A}from"./CreatorRequests-CrYA46hB.js";import{u as X}from"./utils-BWPLNOGI.js";import{g as Z}from"./searchAnalytics-Bz9FKtRP.js";import"./ManualData-CCWVZZls.js";const ua=()=>{const[j,C]=g.useState(null),[o,u]=g.useState({totalUsers:0,creators:0,admins:0,manuals:0,pendingRequests:0}),[y,v]=g.useState([]),[h,x]=g.useState([]),[N,R]=g.useState([]),[S,M]=g.useState([]),{t}=X(),m=z(),{modalState:p,showAlert:i,showConfirm:w,hideAlert:D}=B();g.useEffect(()=>{const s=localStorage.getItem("userData"),e=localStorage.getItem("authToken");if(!s||!e){m("/login");return}const d=JSON.parse(s);if(d.role!=="admin"){m("/");return}C(d),T()},[m]);const T=()=>{try{const s=q(),e=s.filter(c=>c.role==="creator"),d=s.filter(c=>c.role==="admin"),n=W().filter(c=>c.status==="pending"),l=K(),f=JSON.parse(localStorage.getItem("customManuals")||"[]"),F=l.sort((c,G)=>new Date(G.createdAt)-new Date(c.createdAt)).slice(0,5).map(c=>({...c,status:c.status||"published"})),L=f.filter(c=>c.status==="pending"),P=f.filter(c=>c.status==="draft");u({totalUsers:s.length,creators:e.length,admins:d.length,manuals:l.length,pendingRequests:n.length,pendingManuals:L.length,draftManuals:P.length}),v(n.slice(0,3)),x(F);const V=Z({days:7,limit:5});R(V);const Y=JSON.parse(localStorage.getItem("userQuestions")||"[]").filter(c=>c.status==="pending");M(Y)}catch(s){console.error("Error loading dashboard data:",s)}},I=s=>{try{const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),d=e.find(n=>n.id===s),r=e.map(n=>n.id===s?{...n,status:"published"}:n);localStorage.setItem("customManuals",JSON.stringify(r)),d&&d.authorId&&b({userId:String(d.authorId),message:`Your manual "${d.title}" has been approved and published!`,type:"success",link:`/manual/${s}`}),x(n=>n.map(l=>l.id===s?{...l,status:"published"}:l)),u(n=>({...n,pendingManuals:n.pendingManuals-1})),i("Manual approved and published successfully!","success")}catch(e){console.error("Error approving manual:",e),i("Failed to approve manual","error")}},k=(s,e)=>{w(`Reject and delete manual "${e}"? This action cannot be undone.`,()=>{Q(s)},"danger","Confirm Rejection","Reject","Cancel")},Q=s=>{try{const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),d=e.find(n=>n.id===s),r=e.filter(n=>n.id!==s);localStorage.setItem("customManuals",JSON.stringify(r)),d&&d.authorId&&b({userId:String(d.authorId),message:`Your manual "${d.title}" was not approved.`,type:"warning",link:null}),x(n=>n.filter(l=>l.id!==s)),u(n=>({...n,manuals:n.manuals-1,pendingManuals:n.pendingManuals-1})),i("Manual rejected and deleted successfully!","success")}catch(e){console.error("Error rejecting manual:",e),i("Failed to reject manual","error")}},E=(s,e)=>{w(`Delete draft "${e}"? This action cannot be undone.`,()=>{O(s)},"danger","Confirm Deletion","Delete","Cancel")},O=s=>{try{const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),d=e.find(n=>n.id===s),r=e.filter(n=>n.id!==s);localStorage.setItem("customManuals",JSON.stringify(r)),d&&d.authorId&&b({userId:String(d.authorId),message:`Your draft "${d.title}" has been deleted by an admin.`,type:"warning",link:null}),x(n=>n.filter(l=>l.id!==s)),u(n=>({...n,manuals:n.manuals-1,draftManuals:n.draftManuals-1})),i("Draft deleted successfully!","success")}catch(e){console.error("Error deleting draft:",e),i("Failed to delete draft","error")}},$=(s,e)=>{w(`Delete manual "${e}"? This action cannot be undone.`,()=>{J(s)},"danger","Confirm Deletion","Delete","Cancel")},J=s=>{try{const d=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(r=>r.id!==s);localStorage.setItem("customManuals",JSON.stringify(d)),x(r=>r.filter(n=>n.id!==s)),u(r=>({...r,manuals:r.manuals-1})),i("Manual deleted successfully!","success")}catch(e){console.error("Error deleting manual:",e),i("Failed to delete manual","error")}},U=(s,e)=>{try{const d=JSON.parse(localStorage.getItem("userQuestions")||"[]"),r=j?`${j.firstName} ${j.lastName}`:"Admin",n=d.map(l=>l.id===s?{...l,status:"answered",answer:e,answeredAt:new Date().toISOString(),answeredBy:r}:l);localStorage.setItem("userQuestions",JSON.stringify(n)),M(l=>l.filter(f=>f.id!==s)),i("Question answered successfully!","success")}catch(d){console.error("Error answering question:",d),i("Failed to answer question","error")}},H=s=>{try{const d=JSON.parse(localStorage.getItem("userQuestions")||"[]").map(r=>r.id===s?{...r,status:"archived",archivedAt:new Date().toISOString()}:r);localStorage.setItem("userQuestions",JSON.stringify(d)),M(r=>r.filter(n=>n.id!==s)),i("Question archived successfully!","success")}catch(e){console.error("Error archiving question:",e),i("Failed to archive question","error")}};return j?a.jsxs("main",{className:"ad-page",children:[a.jsxs("div",{className:"ad-inner",children:[a.jsxs("header",{className:"ad-header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"ad-title",children:t("dashboard.admin.title")||"Admin Dashboard"}),a.jsx("p",{className:"ad-sub",children:t("dashboard.admin.subtitle")||"Overview of users, manuals, and creator requests in your organization"})]})," ",a.jsx("div",{className:"ad-headerRight",children:a.jsx("button",{className:"ad-btn ghost",onClick:()=>i("Export report functionality would be implemented here","info"),children:t("dashboard.admin.exportReport")||"Export report"})})]})," ",a.jsxs("section",{className:"ad-statsGrid",children:[a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.users")||"Users"}),a.jsx("div",{className:"ad-statValue",children:o.totalUsers}),a.jsxs("div",{className:"ad-statSub",children:[t("dashboard.admin.creators")||"Creators",": ",o.creators," â€¢"," ",t("dashboard.admin.admins")||"Admin",": ",o.admins]})]}),a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.manuals")||"Manuals"}),a.jsx("div",{className:"ad-statValue",children:o.manuals}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.totalManuals")||"Total manuals in system"})]})," ",a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.pendingManuals")||"Pending manuals"}),a.jsx("div",{className:"ad-statValue",children:o.pendingManuals||0}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.awaitingApproval")||"Awaiting approval"})]}),a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsx("div",{className:"ad-statValue",children:o.pendingRequests}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.pendingApproval")||"Requests pending approval"})]})]}),a.jsxs("div",{className:"ad-mainGrid",children:[a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingRequests," ",t("dashboard.admin.pending")||"pending"]})]}),a.jsxs("div",{className:"ad-requestList",children:[" ",y.map(s=>a.jsxs("div",{className:"ad-requestItem",children:[a.jsxs("div",{className:"ad-requestMain",children:[a.jsx("div",{className:"ad-requestName",children:s.username}),a.jsxs("div",{className:"ad-requestMeta",children:[s.team," â€¢ requested"," ",new Date(s.createdAt).toLocaleDateString()]}),a.jsx("div",{className:"ad-requestReason",children:s.reason})]})," ",a.jsxs("div",{className:"ad-requestActions",children:[" ",a.jsx("button",{className:"ad-btn ghost",onClick:()=>i(`Types: ${s.types?.join(", ")||"N/A"}

Reason: ${s.reason}`,"info","Request Details"),children:t("dashboard.admin.view")||"View"}),a.jsx("button",{className:"ad-btn approve",onClick:()=>{if(window.confirm(`Approve creator request for ${s.username}?`))try{A(s.id,{status:"approved",reviewerId:j.id,note:"Request approved by admin"});const d=q().map(n=>n.id===s.userId?{...n,role:"creator"}:n);localStorage.setItem("quickhelp_users",JSON.stringify(d));const r=localStorage.getItem("userData");if(r){const n=JSON.parse(r);n.id===s.userId&&(n.role="creator",localStorage.setItem("userData",JSON.stringify(n)),window.dispatchEvent(new Event("authStateChanged")))}b({userId:String(s.userId),message:"Your creator request has been approved! You can now create manuals.",type:"success",link:"/creator-dashboard"}),v(n=>n.filter(l=>l.id!==s.id)),u(n=>({...n,pendingRequests:n.pendingRequests-1,creators:n.creators+1})),i(`Approved ${s.username} as a creator.`,"success")}catch(e){console.error("Error approving request:",e),i("Failed to approve request","error")}},children:t("dashboard.admin.approve")||"Approve"}),a.jsx("button",{className:"ad-btn reject",onClick:()=>{if(window.confirm(`Reject creator request for ${s.username}?`))try{A(s.id,{status:"rejected",reviewerId:j.id,note:"Request rejected by admin"}),b({userId:String(s.userId),message:"Your creator request was not approved at this time.",type:"warning",link:"/creator-request"}),v(e=>e.filter(d=>d.id!==s.id)),u(e=>({...e,pendingRequests:e.pendingRequests-1})),i(`Rejected request for ${s.username}.`,"success")}catch(e){console.error("Error rejecting request:",e),i("Failed to reject request","error")}},children:t("dashboard.admin.reject")||"Reject"})]})]},s.id))," ",y.length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noRequests")||"No pending requests. Approved requests are recorded in the system."})]})]})," ",a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.pendingManuals")||"Pending Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingManuals||0," ",t("dashboard.admin.pending")||"pending"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.category")||"Category"}),a.jsx("span",{children:t("dashboard.admin.submitted")||"Submitted"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),h.filter(s=>s.status==="pending").map(s=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:s.title}),a.jsx("span",{className:"ad-tableAuthor",children:s.author}),a.jsx("span",{className:"ad-tableCategory",children:s.category}),a.jsx("span",{className:"ad-tableDate",children:s.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>m(`/manual/${s.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn approve small",onClick:e=>{e.stopPropagation(),window.confirm(`Approve and publish manual "${s.title}"?`)&&I(s.id)},title:"Approve",children:"âœ…"}),a.jsx("button",{className:"ad-btn reject small",onClick:e=>{e.stopPropagation(),k(s.id,s.title)},title:"Reject",children:"âŒ"})]})]},s.id)),h.filter(s=>s.status==="pending").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noPendingManuals")||"No pending manuals. All manuals have been reviewed."})]})," "]}),a.jsxs("section",{className:"ad-card ad-card-compact",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.draftManuals")||"Draft Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.draftManuals||0," ",t("dashboard.admin.drafts")||"drafts"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),h.filter(s=>s.status==="draft").slice(0,3).map(s=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:s.title}),a.jsx("span",{className:"ad-tableAuthor",children:s.author}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>m(`/edit-manual/${s.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:e=>{e.stopPropagation(),E(s.id,s.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},s.id)),h.filter(s=>s.status==="draft").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noDrafts")||"No draft manuals found."})]})]}),a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsxs("h2",{className:"ad-cardTitle",children:["ðŸ’¬"," ",t("dashboard.admin.userQuestions")||"User Questions from FAQ"]}),a.jsxs("span",{className:"ad-cardMeta",children:[S.length," ",t("dashboard.admin.pending")||"pending"]})]}),S.length===0?a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noQuestions")||"No pending questions. Users can submit questions from the FAQ page."}):a.jsx("div",{className:"ad-questionList",children:S.slice(0,5).map(s=>a.jsxs("div",{className:"ad-questionItem",children:[a.jsx("div",{className:"ad-questionHeader",children:a.jsxs("div",{className:"ad-questionMeta",children:[a.jsx("strong",{children:s.name}),a.jsx("span",{className:"ad-questionEmail",children:s.email}),a.jsx("span",{className:"ad-questionDate",children:new Date(s.createdAt).toLocaleDateString()})]})}),a.jsx("div",{className:"ad-questionText",children:s.question}),a.jsxs("div",{className:"ad-questionActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>{const e=prompt("Enter your answer to this question:");e&&e.trim()&&U(s.id,e.trim())},children:"âœï¸ Answer"}),a.jsx("button",{className:"ad-btn ghost small",onClick:()=>{window.confirm("Archive this question without answering?")&&H(s.id)},children:"ðŸ“ Archive"})]})]},s.id))})]}),a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.publishedManuals")||"Published Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[h.filter(s=>s.status==="published").length," ",t("dashboard.admin.published")||"published"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.category")||"Category"}),a.jsx("span",{children:t("dashboard.admin.created")||"Created"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),h.filter(s=>s.status==="published").map(s=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:s.title}),a.jsx("span",{className:"ad-tableAuthor",children:s.author}),a.jsx("span",{className:"ad-tableCategory",children:s.category}),a.jsx("span",{className:"ad-tableDate",children:s.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>m(`/manual/${s.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn ghost small",onClick:()=>m(`/edit-manual/${s.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:e=>{e.stopPropagation(),$(s.id,s.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},s.id))," ",h.filter(s=>s.status==="published").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noPublishedManuals")||"No published manuals found"})]}),a.jsx("div",{className:"ad-divider"})," ",a.jsx("div",{className:"ad-cardHeader",children:a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.userSnapshot")||"User snapshot"})}),a.jsxs("ul",{className:"ad-list",children:[a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.newUsers")||"8 new users this week"]}),a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.recentEdits")||"5 manuals edited in the last 24 hours"]}),a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.newCreators")||"2 creators added from requests this week"]})]})," "]}),a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsxs("h2",{className:"ad-cardTitle",children:["ðŸ”"," ",t("dashboard.admin.topSearches")||"Top search terms (last 7 days)"]}),a.jsxs("span",{className:"ad-cardMeta",children:[N.length," ",t("dashboard.admin.queries")||"queries"]})]}),N.length===0?a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noSearchData")||"No search data yet. Search analytics will appear here once users start searching for manuals."}):a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.query")||"Query"}),a.jsx("span",{children:t("dashboard.admin.searchCount")||"Count"}),a.jsx("span",{children:t("dashboard.admin.noResults")||"No-result searches"})]}),N.map((s,e)=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:a.jsxs("strong",{children:['"',s.query,'"']})}),a.jsx("span",{className:"ad-tableCount",children:s.count}),a.jsx("span",{className:`ad-tableNoResults ${s.noResultCount>0?"ad-warning":""}`,children:s.noResultCount>0?a.jsxs(a.Fragment,{children:["âš ï¸ ",s.noResultCount]}):a.jsxs(a.Fragment,{children:["âœ“ ",s.noResultCount]})})]},e))]}),N.some(s=>s.noResultCount>0)&&a.jsxs("div",{className:"ad-searchTip",children:[a.jsx("span",{className:"ad-tipIcon",children:"ðŸ’¡"}),a.jsx("span",{children:t("dashboard.admin.searchTip")||"Queries with no results may indicate missing manuals. Consider creating guides for these topics."})]})]})]})]}),a.jsx(_,{show:p.show,onHide:D,title:p.title,message:p.message,variant:p.variant,onConfirm:p.onConfirm,confirmText:p.confirmText,cancelText:p.cancelText})]}):a.jsx("main",{className:"ad-page",children:a.jsx("div",{className:"ad-inner",children:a.jsx("div",{className:"ad-loading",children:"Loading..."})})})};export{ua as default};
