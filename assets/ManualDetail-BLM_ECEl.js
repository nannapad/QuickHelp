import{g as ie,h as oe,j as e,k as P,b as le,t as re}from"./ui-HD-sGl07.js";import{h as ce,u as de,r as o}from"./vendor-D6EYvIws.js";import{u as me,A as he}from"./AlertModal-C9C8unQ8.js";import"./index-CZoC9ciW.js";import{m}from"./ManualData-BXjgqMK4.js";import"./utils-DIoNpZQj.js";const $=[{id:1,manualId:1,userId:1,author:"John Doe",text:"Great guide! Very helpful for setting up VS Code.",createdAt:"2024-11-20"},{id:2,manualId:1,userId:2,author:"Maria Garcia",text:"Thanks for the detailed instructions. This saved me a lot of time!",createdAt:"2024-11-21"},{id:3,manualId:2,userId:1,author:"John Doe",text:"The Figma integration steps are spot on. Worked perfectly!",createdAt:"2024-11-19"},{id:4,manualId:3,userId:3,author:"Sarah Johnson",text:"This onboarding checklist is comprehensive. Will definitely use it for new hires.",createdAt:"2024-11-18"},{id:5,manualId:2,userId:3,author:"Sarah Johnson",text:"Could you add more screenshots? Visual examples would help.",createdAt:"2024-11-22"}],Ne=()=>{const{id:l}=ce(),h=de(),[u,S]=o.useState(!1),[x,E]=o.useState(!1),[R,V]=o.useState(0),[J,M]=o.useState(0),[B,j]=o.useState(""),[i,K]=o.useState(null),[p,T]=o.useState(""),[g,D]=o.useState(!1),[N,v]=o.useState([]),[A,W]=o.useState(0),[O,C]=o.useState(null),[k,f]=o.useState(""),{modalState:c,showAlert:r,showConfirm:q,hideAlert:G}=me(),t=o.useMemo(()=>{if(!m||m.length===0)return null;const a=[...JSON.parse(localStorage.getItem("customManuals")||"[]"),...m];return a.find(n=>String(n.id)===String(l))||a[0]},[l,A]),H=o.useMemo(()=>{if(!i||!t)return!1;if(i.role==="admin")return!0;if(i.role==="creator"){const s=`${i.firstName} ${i.lastName}`;return t.author===s||t.author===i.username}return!1},[i,t]);o.useEffect(()=>{const s=localStorage.getItem("userData");if(s)try{const n=JSON.parse(s);K(n),l&&(S(isLikedByUser(l,n.id)),E(isBookmarkedByUser(l,n.id)))}catch(n){console.error("Error parsing user data:",n)}if(l){const n=ie(l),d=oe(l);V(n),M(d.likes||0)}const a=()=>{W(n=>n+1)};return window.addEventListener("storage",a),window.addEventListener("manualUpdated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("manualUpdated",a)}},[l]),o.useEffect(()=>{if(t&&t.versions&&t.versions.length>0){const a=(t.meta?t.meta.split("v")[1]:null)||t.versions[0];j(a)}else t&&t.version&&j(t.version)},[t]);const L=o.useMemo(()=>!m||!t?[]:[...JSON.parse(localStorage.getItem("customManuals")||"[]"),...m].filter(n=>n.id!==t.id&&(n.category===t.category||n.tags?.some(d=>t.tags?.includes(d)))).slice(0,3),[t,A]),w=o.useMemo(()=>t?[...$?$.filter(a=>String(a.manualId)===String(t.id)):[],...N].sort((a,n)=>new Date(n.createdAt)-new Date(a.createdAt)):N,[t,N]),z=()=>{if(!i)return;const{isLiked:s,likes:a}=le(l,i.id);S(s),M(a)},Y=()=>{if(!i)return;const s=re(l,i.id);E(s),s&&r("Bookmarked! You will be notified when this manual is updated.","success","Bookmark Added")},Q=async()=>{try{navigator.share?await navigator.share({title:t.title,text:t.description,url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),r("Share link copied to clipboard!","success","Link Copied"))}catch(s){console.error("Error sharing:",s),r("Share link copied to clipboard!","success","Link Copied")}},X=s=>{j(s.target.value)},F=s=>{const a=document.getElementById(`section-${s}`);a&&a.scrollIntoView({behavior:"smooth"})},Z=s=>{const a=new Date(s),d=Math.abs(new Date-a),y=Math.floor(d/(1e3*60*60*24)),b=Math.floor(d/(1e3*60*60)),I=Math.floor(d/(1e3*60*60));return y>0?y===1?"1d ago":`${y}d ago`:b>0?b===1?"1h ago":`${b}h ago`:I>0?I===1?"1m ago":`${I}m ago`:"Just now"},U=async()=>{if(!(!p.trim()||!i)){D(!0);try{const s={id:Date.now(),manualId:parseInt(l),userId:i.id,author:`${i.firstName} ${i.lastName}`,text:p.trim(),createdAt:new Date().toISOString().split("T")[0]};v(a=>[s,...a]),T(""),setTimeout(()=>{r("Comment posted successfully!","success","Comment Posted")},100)}catch(s){console.error("Error posting comment:",s),r("Failed to post comment. Please try again.","error","Error")}finally{D(!1)}}},_=s=>{s.key==="Enter"&&(s.ctrlKey||s.metaKey)&&U()},ee=s=>{C(s.id),f(s.text)},se=s=>{if(!k.trim()){r("Comment cannot be empty","error","Error");return}v(a=>a.map(n=>n.id===s?{...n,text:k.trim(),edited:!0}:n)),C(null),f(""),r("Comment updated successfully!","success","Updated")},te=()=>{C(null),f("")},ae=s=>{q("Delete this comment? This action cannot be undone.",()=>ne(s.id),"danger","Confirm Deletion","Delete","Cancel")},ne=s=>{v(a=>a.filter(n=>n.id!==s)),r("Comment deleted successfully!","success","Deleted")};return t?e.jsxs("main",{className:"manualPage",children:[e.jsxs("div",{className:"manualPageInner",children:[e.jsxs("div",{className:"breadcrumbRow",children:[e.jsx("button",{className:"backLink",type:"button",onClick:()=>h(-1),children:"â† Back"}),e.jsxs("div",{className:"breadcrumb",children:[t.category,t.subCategory?` â€¢ ${t.subCategory}`:"",` â€¢ ${t.title}`]})]}),e.jsxs("div",{className:"grid",children:[e.jsxs("article",{className:"left",children:[e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"topRow",children:[e.jsx("h1",{className:"title",children:t.title}),t.versions&&e.jsxs("div",{className:"versionRow",children:[e.jsxs("div",{className:"versionWrapper",children:[e.jsx("span",{className:"versionLabel",children:"Version"}),e.jsx("select",{className:"versionSelect",value:B,onChange:X,"aria-label":"Select version",children:t.versions.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsx("div",{className:"versionLine"})]})]}),e.jsxs("div",{className:"bottomRow",children:[e.jsxs("div",{className:"authorMetaRow",children:[e.jsx("div",{className:"authorAvatar",title:t.author,children:t.author.charAt(0).toUpperCase()}),e.jsxs("div",{className:"authorDetails",children:[e.jsxs("div",{className:"authorTop",children:[e.jsx("span",{className:"authorName",children:t.author}),e.jsx("span",{className:"metaSeparator",children:"â€¢"}),e.jsx("span",{className:"categoryBadge",children:t.category})]}),e.jsx("div",{className:"authorBottom",children:e.jsxs("span",{className:"metaText",children:["Updated ",t.updatedAt]})})]})]}),e.jsxs("div",{className:"headerActions",children:[H&&e.jsx("button",{className:"actionBtn editBtn",onClick:()=>h(`/edit-manual/${t.id}`),title:"Edit this manual",children:"Edit"}),e.jsx("button",{className:`actionBtn ${u?"liked":""}`,onClick:z,"aria-pressed":u,title:u?"Unlike this manual":"Like this manual",children:u?"Liked":"Like"}),e.jsx("button",{className:`actionBtn ${x?"bookmarked":""}`,onClick:Y,"aria-pressed":x,title:x?"Remove bookmark":"Bookmark this manual",children:x?"Bookmarked":"Bookmark"}),e.jsx("button",{className:"actionBtn",onClick:Q,title:"Share this manual",children:"Share"})]})]})]}),e.jsx("div",{className:"hero",children:e.jsxs("div",{className:"heroContent",children:[e.jsx("div",{className:"heroTitle",children:t.description}),e.jsxs("div",{className:"heroStats",children:[e.jsxs("span",{children:["â± ",t.estimatedTime||"10 min"," read"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["ðŸ‘ ",R," views"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["â˜… ",t.difficulty||"Beginner"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["ðŸ‘ ",J," likes"]})]})]})}),(t.sections?.length>0||t.blocks?.some(s=>s.type==="heading"))&&e.jsxs("div",{className:"tocContainer",children:[e.jsx("h3",{className:"tocTitle",children:"Table of Contents"}),e.jsx("ul",{className:"tocList",children:t.blocks?t.blocks.filter(s=>s.type==="heading").map((s,a)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>F(a),children:s.value})},s.id||a)):t.sections.map((s,a)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>F(a),children:s.title})},a))})]}),e.jsx("div",{className:"contentBody",children:t.blocks?t.blocks.map((s,a)=>e.jsxs("div",{id:`section-${a}`,className:"blockWrapper",children:[s.type==="heading"&&e.jsx("h2",{className:"sectionTitle",children:s.value}),s.type==="text"&&e.jsx("p",{className:"text",children:s.value}),s.type==="quote"&&e.jsx("blockquote",{className:"quote",children:s.value}),s.type==="code"&&e.jsx("pre",{className:"codeBlock",children:e.jsx("code",{children:s.value})})," ",s.type==="image"&&e.jsx("div",{className:"imageWrapper",children:P(s.imageUrl||s.value)?e.jsx("img",{src:P(s.imageUrl||s.value),alt:"Manual content",className:"contentImage",onError:n=>{n.target.style.display="none",console.warn("Failed to load image:",s.imageUrl||s.value)}}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",background:"var(--bg-secondary)",borderRadius:"8px",color:"var(--text-muted)"},children:"ðŸ“· Image not available"})})]},s.id||a)):t.sections?t.sections.map((s,a)=>e.jsxs("section",{id:`section-${a}`,className:"section",children:[e.jsx("h2",{className:"sectionTitle",children:s.title}),e.jsx("p",{className:"text",children:s.content})]},a)):e.jsx("section",{className:"section",children:e.jsx("p",{className:"text",children:t.intro||"No content available for this manual."})})})]}),e.jsxs("aside",{className:"right",children:[" ",e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Download"}),e.jsxs("p",{className:"cardDesc",children:["Get the full ",t.fileInfo?"version":"PDF version"," for offline reading."]}),e.jsx("button",{type:"button",className:"btn primary full",onClick:()=>{if(t.fileInfo&&typeof t.fileInfo=="object"&&t.fileInfo.dataUrl){const s=document.createElement("a");s.href=t.fileInfo.dataUrl,s.download=t.fileInfo.name,document.body.appendChild(s),s.click(),document.body.removeChild(s),r("Download started!","success","Downloading")}else r("File not available for download","warning","No File")},children:t.fileInfo?"Download File":"Download PDF"}),e.jsx("div",{className:"fileInfo",children:t.fileInfo&&typeof t.fileInfo=="object"?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[t.fileInfo.type?.split("/")[1]?.toUpperCase()||"FILE"," ","â€¢ ",(t.fileInfo.size/1024).toFixed(1)," KB"]}),e.jsx("span",{children:t.fileInfo.name})]}):t.fileInfo?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"FILE"}),e.jsx("span",{children:t.fileInfo})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"PDF â€¢ 2.4 MB"}),e.jsxs("span",{children:["v",B||t.version||"1.0"]})]})})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Tags"}),e.jsx("div",{className:"tagsRow",children:(t.tags||[]).map(s=>e.jsx("span",{className:"tagChip",children:s},s))})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Related Manuals"}),e.jsxs("div",{className:"relatedList",children:[L.map(s=>e.jsxs("button",{className:"relatedItem",onClick:()=>h(`/manual/${s.id}`),children:[e.jsx("div",{className:"relatedTitle",children:s.title}),e.jsxs("div",{className:"relatedMeta",children:[s.category," â€¢ ",s.views," views"]})]},s.id)),L.length===0&&e.jsx("div",{className:"empty",children:"No related manuals found"})]})]}),e.jsxs("section",{className:"card",children:[e.jsxs("h3",{className:"cardTitle",children:["Comments (",w.length,")"]}),i?e.jsxs("div",{className:"commentInputWrapper",children:[e.jsx("textarea",{className:"commentInput",rows:3,placeholder:"Add a comment... (Ctrl+Enter to post)",value:p,onChange:s=>T(s.target.value),onKeyPress:_,disabled:g}),e.jsx("button",{className:"commentSubmitBtn",onClick:U,disabled:!p.trim()||g,children:g?"Posting...":"Post"})]}):e.jsx("div",{className:"commentLoginPrompt",children:e.jsxs("p",{children:["Please"," ",e.jsx("button",{onClick:()=>h("/login"),className:"loginLink",children:"login"})," ","to add a comment"]})}),e.jsxs("div",{className:"commentList",children:[w.map(s=>e.jsxs("div",{className:"commentRow",children:[e.jsx("div",{className:"commentAvatar",children:s.author?.[0]?.toUpperCase()}),e.jsxs("div",{className:"commentContent",children:[e.jsxs("div",{className:"commentHeader",children:[e.jsx("span",{className:"commentAuthor",children:s.author}),e.jsxs("span",{className:"commentTime",children:[Z(s.createdAt),s.edited&&e.jsx("span",{className:"editedBadge",children:" (edited)"})]}),i&&s.userId===i.id&&e.jsxs("div",{className:"commentActions",children:[e.jsx("button",{className:"commentActionBtn",onClick:()=>ee(s),title:"Edit comment",children:"âœï¸"}),e.jsx("button",{className:"commentActionBtn deleteBtn",onClick:()=>ae(s),title:"Delete comment",children:"ðŸ—‘ï¸"})]})]}),O===s.id?e.jsxs("div",{className:"commentEditWrapper",children:[e.jsx("textarea",{className:"commentEditInput",value:k,onChange:a=>f(a.target.value),rows:3,autoFocus:!0}),e.jsxs("div",{className:"commentEditActions",children:[e.jsx("button",{className:"commentEditSaveBtn",onClick:()=>se(s.id),children:"Save"}),e.jsx("button",{className:"commentEditCancelBtn",onClick:te,children:"Cancel"})]})]}):e.jsx("p",{className:"commentText",children:s.text})]})]},s.id)),w.length===0&&e.jsxs("div",{className:"empty",children:["No comments yet."," ",i?"Be the first to comment!":"Login to be the first to comment!"]})]})]})," "]})]})]}),e.jsx(he,{show:c.show,onHide:G,title:c.title,message:c.message,variant:c.variant,onConfirm:c.onConfirm,confirmText:c.confirmText,cancelText:c.cancelText})]}):e.jsx("main",{className:"manualPage",children:e.jsx("div",{className:"manualPageInner",children:e.jsx("p",{children:"Manual not found."})})})};export{Ne as default};
