import{j as a,m as b}from"./ui-DKY0DGm9.js";import{r as j,u as _}from"./vendor-D6EYvIws.js";import{u as K,A as W}from"./AlertModal-CrmLqu_t.js";import{m as X}from"./ManualData-CVKivWWw.js";import{b as A}from"./UserData-CNiV9beM.js";import{b as Z,u as C}from"./CreatorRequests-CrYA46hB.js";import{u as aa}from"./utils-CDqJ1pPe.js";import{g as sa}from"./searchAnalytics-Bz9FKtRP.js";const ma=()=>{const[g,R]=j.useState(null),[o,u]=j.useState({totalUsers:0,creators:0,admins:0,manuals:0,pendingRequests:0}),[y,f]=j.useState([]),[m,x]=j.useState([]),[N,D]=j.useState([]),[v,S]=j.useState([]),{t}=aa(),h=_(),{modalState:p,showAlert:c,showConfirm:M,hideAlert:T}=K();j.useEffect(()=>{const s=localStorage.getItem("userData"),e=localStorage.getItem("authToken");if(!s||!e){h("/login");return}const d=JSON.parse(s);if(d.role!=="admin"){h("/");return}R(d),I()},[h]);const I=()=>{try{const s=A(),e=s.filter(l=>l.role==="creator"),d=s.filter(l=>l.role==="admin"),n=Z().filter(l=>l.status==="pending"),i=JSON.parse(localStorage.getItem("customManuals")||"[]"),w=new Set(i.map(l=>l.id)),L=X.filter(l=>!w.has(l.id)),q=[...i,...L],P=q.sort((l,B)=>new Date(B.createdAt)-new Date(l.createdAt)).slice(0,5).map(l=>({...l,status:l.status||"published"})),V=i.filter(l=>l.status==="pending"),Y=i.filter(l=>l.status==="draft");u({totalUsers:s.length,creators:e.length,admins:d.length,manuals:q.length,pendingRequests:n.length,pendingManuals:V.length,draftManuals:Y.length}),f(n.slice(0,3)),x(P);const G=sa({days:7,limit:5});D(G);const z=JSON.parse(localStorage.getItem("userQuestions")||"[]").filter(l=>l.status==="pending");S(z)}catch(s){console.error("Error loading dashboard data:",s)}},k=s=>{try{const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),d=e.find(n=>n.id===s),r=e.map(n=>n.id===s?{...n,status:"published"}:n);localStorage.setItem("customManuals",JSON.stringify(r)),d&&d.authorId&&b({userId:d.authorId,message:`Your manual "${d.title}" has been approved and published!`,type:"success",link:`/manual/${s}`}),x(n=>n.map(i=>i.id===s?{...i,status:"published"}:i)),u(n=>({...n,pendingManuals:n.pendingManuals-1})),c("Manual approved and published successfully!","success")}catch(e){console.error("Error approving manual:",e),c("Failed to approve manual","error")}},Q=(s,e)=>{M(`Reject and delete manual "${e}"? This action cannot be undone.`,()=>{E(s)},"danger","Confirm Rejection","Reject","Cancel")},E=s=>{try{const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),d=e.find(n=>n.id===s),r=e.filter(n=>n.id!==s);localStorage.setItem("customManuals",JSON.stringify(r)),d&&d.authorId&&b({userId:d.authorId,message:`Your manual "${d.title}" was not approved.`,type:"warning",link:null}),x(n=>n.filter(i=>i.id!==s)),u(n=>({...n,manuals:n.manuals-1,pendingManuals:n.pendingManuals-1})),c("Manual rejected and deleted successfully!","success")}catch(e){console.error("Error rejecting manual:",e),c("Failed to reject manual","error")}},O=(s,e)=>{M(`Delete draft "${e}"? This action cannot be undone.`,()=>{$(s)},"danger","Confirm Deletion","Delete","Cancel")},$=s=>{try{const e=JSON.parse(localStorage.getItem("customManuals")||"[]"),d=e.find(n=>n.id===s),r=e.filter(n=>n.id!==s);localStorage.setItem("customManuals",JSON.stringify(r)),d&&d.authorId&&b({userId:d.authorId,message:`Your draft "${d.title}" has been deleted by an admin.`,type:"warning",link:null}),x(n=>n.filter(i=>i.id!==s)),u(n=>({...n,manuals:n.manuals-1,draftManuals:n.draftManuals-1})),c("Draft deleted successfully!","success")}catch(e){console.error("Error deleting draft:",e),c("Failed to delete draft","error")}},J=(s,e)=>{M(`Delete manual "${e}"? This action cannot be undone.`,()=>{U(s)},"danger","Confirm Deletion","Delete","Cancel")},U=s=>{try{const d=JSON.parse(localStorage.getItem("customManuals")||"[]").filter(r=>r.id!==s);localStorage.setItem("customManuals",JSON.stringify(d)),x(r=>r.filter(n=>n.id!==s)),u(r=>({...r,manuals:r.manuals-1})),c("Manual deleted successfully!","success")}catch(e){console.error("Error deleting manual:",e),c("Failed to delete manual","error")}},H=(s,e)=>{try{const d=JSON.parse(localStorage.getItem("userQuestions")||"[]"),r=g?`${g.firstName} ${g.lastName}`:"Admin",n=d.map(i=>i.id===s?{...i,status:"answered",answer:e,answeredAt:new Date().toISOString(),answeredBy:r}:i);localStorage.setItem("userQuestions",JSON.stringify(n)),S(i=>i.filter(w=>w.id!==s)),c("Question answered successfully!","success")}catch(d){console.error("Error answering question:",d),c("Failed to answer question","error")}},F=s=>{try{const d=JSON.parse(localStorage.getItem("userQuestions")||"[]").map(r=>r.id===s?{...r,status:"archived",archivedAt:new Date().toISOString()}:r);localStorage.setItem("userQuestions",JSON.stringify(d)),S(r=>r.filter(n=>n.id!==s)),c("Question archived successfully!","success")}catch(e){console.error("Error archiving question:",e),c("Failed to archive question","error")}};return g?a.jsxs("main",{className:"ad-page",children:[a.jsxs("div",{className:"ad-inner",children:[a.jsxs("header",{className:"ad-header",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"ad-title",children:t("dashboard.admin.title")||"Admin Dashboard"}),a.jsx("p",{className:"ad-sub",children:t("dashboard.admin.subtitle")||"Overview of users, manuals, and creator requests in your organization"})]})," ",a.jsx("div",{className:"ad-headerRight",children:a.jsx("button",{className:"ad-btn ghost",onClick:()=>c("Export report functionality would be implemented here","info"),children:t("dashboard.admin.exportReport")||"Export report"})})]})," ",a.jsxs("section",{className:"ad-statsGrid",children:[a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.users")||"Users"}),a.jsx("div",{className:"ad-statValue",children:o.totalUsers}),a.jsxs("div",{className:"ad-statSub",children:[t("dashboard.admin.creators")||"Creators",": ",o.creators," â€¢"," ",t("dashboard.admin.admins")||"Admin",": ",o.admins]})]}),a.jsxs("div",{className:"ad-statCard",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.manuals")||"Manuals"}),a.jsx("div",{className:"ad-statValue",children:o.manuals}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.totalManuals")||"Total manuals in system"})]})," ",a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.pendingManuals")||"Pending manuals"}),a.jsx("div",{className:"ad-statValue",children:o.pendingManuals||0}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.awaitingApproval")||"Awaiting approval"})]}),a.jsxs("div",{className:"ad-statCard ad-statAccent",children:[" ",a.jsx("div",{className:"ad-statLabel",children:t("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsx("div",{className:"ad-statValue",children:o.pendingRequests}),a.jsx("div",{className:"ad-statSub",children:t("dashboard.admin.pendingApproval")||"Requests pending approval"})]})]}),a.jsxs("div",{className:"ad-mainGrid",children:[a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.creatorRequests")||"Creator requests"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingRequests," ",t("dashboard.admin.pending")||"pending"]})]}),a.jsxs("div",{className:"ad-requestList",children:[" ",y.map(s=>a.jsxs("div",{className:"ad-requestItem",children:[a.jsxs("div",{className:"ad-requestMain",children:[a.jsx("div",{className:"ad-requestName",children:s.username}),a.jsxs("div",{className:"ad-requestMeta",children:[s.team," â€¢ requested"," ",new Date(s.createdAt).toLocaleDateString()]}),a.jsx("div",{className:"ad-requestReason",children:s.reason})]})," ",a.jsxs("div",{className:"ad-requestActions",children:[" ",a.jsx("button",{className:"ad-btn ghost",onClick:()=>c(`Types: ${s.types?.join(", ")||"N/A"}

Reason: ${s.reason}`,"info","Request Details"),children:t("dashboard.admin.view")||"View"}),a.jsx("button",{className:"ad-btn approve",onClick:()=>{if(window.confirm(`Approve creator request for ${s.username}?`))try{C(s.id,{status:"approved",reviewerId:g.id,note:"Request approved by admin"});const d=A().map(n=>n.id===s.userId?{...n,role:"creator"}:n);localStorage.setItem("quickhelp_users",JSON.stringify(d));const r=localStorage.getItem("userData");if(r){const n=JSON.parse(r);n.id===s.userId&&(n.role="creator",localStorage.setItem("userData",JSON.stringify(n)),window.dispatchEvent(new Event("authStateChanged")))}b({userId:s.userId,message:"Your creator request has been approved! You can now create manuals.",type:"success",link:"/creator-dashboard"}),f(n=>n.filter(i=>i.id!==s.id)),u(n=>({...n,pendingRequests:n.pendingRequests-1,creators:n.creators+1})),c(`Approved ${s.username} as a creator.`,"success")}catch(e){console.error("Error approving request:",e),c("Failed to approve request","error")}},children:t("dashboard.admin.approve")||"Approve"}),a.jsx("button",{className:"ad-btn reject",onClick:()=>{if(window.confirm(`Reject creator request for ${s.username}?`))try{C(s.id,{status:"rejected",reviewerId:g.id,note:"Request rejected by admin"}),b({userId:s.userId,message:"Your creator request was not approved at this time.",type:"warning",link:"/creator-request"}),f(e=>e.filter(d=>d.id!==s.id)),u(e=>({...e,pendingRequests:e.pendingRequests-1})),c(`Rejected request for ${s.username}.`,"success")}catch(e){console.error("Error rejecting request:",e),c("Failed to reject request","error")}},children:t("dashboard.admin.reject")||"Reject"})]})]},s.id))," ",y.length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noRequests")||"No pending requests. Approved requests are recorded in the system."})]})]})," ",a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.pendingManuals")||"Pending Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.pendingManuals||0," ",t("dashboard.admin.pending")||"pending"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.category")||"Category"}),a.jsx("span",{children:t("dashboard.admin.submitted")||"Submitted"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),m.filter(s=>s.status==="pending").map(s=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:s.title}),a.jsx("span",{className:"ad-tableAuthor",children:s.author}),a.jsx("span",{className:"ad-tableCategory",children:s.category}),a.jsx("span",{className:"ad-tableDate",children:s.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/manual/${s.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn approve small",onClick:e=>{e.stopPropagation(),window.confirm(`Approve and publish manual "${s.title}"?`)&&k(s.id)},title:"Approve",children:"âœ…"}),a.jsx("button",{className:"ad-btn reject small",onClick:e=>{e.stopPropagation(),Q(s.id,s.title)},title:"Reject",children:"âŒ"})]})]},s.id)),m.filter(s=>s.status==="pending").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noPendingManuals")||"No pending manuals. All manuals have been reviewed."})]})," "]}),a.jsxs("section",{className:"ad-card ad-card-compact",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.draftManuals")||"Draft Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[o.draftManuals||0," ",t("dashboard.admin.drafts")||"drafts"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),m.filter(s=>s.status==="draft").slice(0,3).map(s=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:s.title}),a.jsx("span",{className:"ad-tableAuthor",children:s.author}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/edit-manual/${s.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:e=>{e.stopPropagation(),O(s.id,s.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},s.id)),m.filter(s=>s.status==="draft").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noDrafts")||"No draft manuals found."})]})]}),a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsxs("h2",{className:"ad-cardTitle",children:["ðŸ’¬"," ",t("dashboard.admin.userQuestions")||"User Questions from FAQ"]}),a.jsxs("span",{className:"ad-cardMeta",children:[v.length," ",t("dashboard.admin.pending")||"pending"]})]}),v.length===0?a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noQuestions")||"No pending questions. Users can submit questions from the FAQ page."}):a.jsx("div",{className:"ad-questionList",children:v.slice(0,5).map(s=>a.jsxs("div",{className:"ad-questionItem",children:[a.jsx("div",{className:"ad-questionHeader",children:a.jsxs("div",{className:"ad-questionMeta",children:[a.jsx("strong",{children:s.name}),a.jsx("span",{className:"ad-questionEmail",children:s.email}),a.jsx("span",{className:"ad-questionDate",children:new Date(s.createdAt).toLocaleDateString()})]})}),a.jsx("div",{className:"ad-questionText",children:s.question}),a.jsxs("div",{className:"ad-questionActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>{const e=prompt("Enter your answer to this question:");e&&e.trim()&&H(s.id,e.trim())},children:"âœï¸ Answer"}),a.jsx("button",{className:"ad-btn ghost small",onClick:()=>{window.confirm("Archive this question without answering?")&&F(s.id)},children:"ðŸ“ Archive"})]})]},s.id))})]}),a.jsxs("section",{className:"ad-card",children:[" ",a.jsxs("div",{className:"ad-cardHeader",children:[a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.publishedManuals")||"Published Manuals"}),a.jsxs("span",{className:"ad-cardMeta",children:[m.filter(s=>s.status==="published").length," ",t("dashboard.admin.published")||"published"]})]})," ",a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.tableTitle")||"Title"}),a.jsx("span",{children:t("dashboard.admin.author")||"Author"}),a.jsx("span",{children:t("dashboard.admin.category")||"Category"}),a.jsx("span",{children:t("dashboard.admin.created")||"Created"}),a.jsx("span",{children:t("dashboard.admin.actions")||"Actions"})]}),m.filter(s=>s.status==="published").map(s=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:s.title}),a.jsx("span",{className:"ad-tableAuthor",children:s.author}),a.jsx("span",{className:"ad-tableCategory",children:s.category}),a.jsx("span",{className:"ad-tableDate",children:s.createdAt}),a.jsxs("div",{className:"ad-tableActions",children:[a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/manual/${s.id}`),title:"View",children:"ðŸ‘ï¸"}),a.jsx("button",{className:"ad-btn ghost small",onClick:()=>h(`/edit-manual/${s.id}`),title:"Edit",children:"âœï¸"}),a.jsx("button",{className:"ad-btn reject small",onClick:e=>{e.stopPropagation(),J(s.id,s.title)},title:"Delete",children:"ðŸ—‘ï¸"})]})]},s.id))," ",m.filter(s=>s.status==="published").length===0&&a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noPublishedManuals")||"No published manuals found"})]}),a.jsx("div",{className:"ad-divider"})," ",a.jsx("div",{className:"ad-cardHeader",children:a.jsx("h2",{className:"ad-cardTitle",children:t("dashboard.admin.userSnapshot")||"User snapshot"})}),a.jsxs("ul",{className:"ad-list",children:[a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.newUsers")||"8 new users this week"]}),a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.recentEdits")||"5 manuals edited in the last 24 hours"]}),a.jsxs("li",{children:[a.jsx("span",{className:"ad-dot"}),t("dashboard.admin.newCreators")||"2 creators added from requests this week"]})]})," "]}),a.jsxs("section",{className:"ad-card",children:[a.jsxs("div",{className:"ad-cardHeader",children:[a.jsxs("h2",{className:"ad-cardTitle",children:["ðŸ”"," ",t("dashboard.admin.topSearches")||"Top search terms (last 7 days)"]}),a.jsxs("span",{className:"ad-cardMeta",children:[N.length," ",t("dashboard.admin.queries")||"queries"]})]}),N.length===0?a.jsx("div",{className:"ad-empty",children:t("dashboard.admin.noSearchData")||"No search data yet. Search analytics will appear here once users start searching for manuals."}):a.jsxs("div",{className:"ad-table",children:[a.jsxs("div",{className:"ad-tableHead",children:[a.jsx("span",{children:t("dashboard.admin.query")||"Query"}),a.jsx("span",{children:t("dashboard.admin.searchCount")||"Count"}),a.jsx("span",{children:t("dashboard.admin.noResults")||"No-result searches"})]}),N.map((s,e)=>a.jsxs("div",{className:"ad-tableRow",children:[a.jsx("span",{className:"ad-tableTitle",children:a.jsxs("strong",{children:['"',s.query,'"']})}),a.jsx("span",{className:"ad-tableCount",children:s.count}),a.jsx("span",{className:`ad-tableNoResults ${s.noResultCount>0?"ad-warning":""}`,children:s.noResultCount>0?a.jsxs(a.Fragment,{children:["âš ï¸ ",s.noResultCount]}):a.jsxs(a.Fragment,{children:["âœ“ ",s.noResultCount]})})]},e))]}),N.some(s=>s.noResultCount>0)&&a.jsxs("div",{className:"ad-searchTip",children:[a.jsx("span",{className:"ad-tipIcon",children:"ðŸ’¡"}),a.jsx("span",{children:t("dashboard.admin.searchTip")||"Queries with no results may indicate missing manuals. Consider creating guides for these topics."})]})]})]})]}),a.jsx(W,{show:p.show,onHide:T,title:p.title,message:p.message,variant:p.variant,onConfirm:p.onConfirm,confirmText:p.confirmText,cancelText:p.cancelText})]}):a.jsx("main",{className:"ad-page",children:a.jsx("div",{className:"ad-inner",children:a.jsx("div",{className:"ad-loading",children:"Loading..."})})})};export{ma as default};
