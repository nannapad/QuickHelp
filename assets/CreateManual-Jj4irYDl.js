import{j as a,l as Z}from"./ui-HD-sGl07.js";import{u as G,r as o}from"./vendor-D6EYvIws.js";import{u as Q}from"./utils-DIoNpZQj.js";import{u as _,A as ee}from"./AlertModal-C9C8unQ8.js";import{b as ae}from"./UserData-WMet23Oe.js";const ce=()=>{const{t:i}=Q(),f=G(),{modalState:g,showAlert:d,hideAlert:U}=_(),[m,I]=o.useState(""),[j,D]=o.useState(""),[x,c]=o.useState([{id:1,type:"text",value:"",showToolbar:!1}]),[w,$]=o.useState(null),[te,E]=o.useState(null),[v,F]=o.useState(null),[r,M]=o.useState(null),[p,A]=o.useState("IT"),[y,P]=o.useState(""),[B,O]=o.useState("EN"),[u,S]=o.useState([]),R=(e="text")=>{const t=Date.now()+Math.floor(Math.random()*1e3);c(s=>[...s,{id:t,type:e,value:"",imageFile:null,imageUrl:"",showToolbar:!1}])},k=e=>{c(t=>t.map(s=>s.id===e?{...s,showToolbar:!s.showToolbar}:s))},h=(e,t)=>{c(s=>s.map(l=>l.id===e?{...l,type:t,value:t==="image"?"":l.value}:l))},N=(e,t)=>{c(s=>s.map(l=>l.id===e?{...l,value:t}:l))},q=e=>{if(x.length<=1){d("You must have at least one block in your manual.","warning");return}c(t=>t.filter(s=>s.id!==e))},T=(e,t)=>{if(t){const s=new FileReader;s.onloadend=()=>{c(l=>l.map(n=>n.id===e?{...n,imageFile:t,imageUrl:s.result,value:t.name}:n))},s.readAsDataURL(t)}},C=(e,t)=>{c(s=>s.map(l=>l.id===e?{...l,imageUrl:t,value:t}:l))},z=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];$(t.name),E(t);const s=new FileReader;s.onloadend=()=>{F(s.result)},s.readAsDataURL(t)}},J=e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];M(t.name);const s=new FileReader;s.onloadend=()=>{const l={name:t.name,size:t.size,type:t.type,dataUrl:s.result};M(l)},s.readAsDataURL(t)}},L=e=>{if(e.key==="Enter"){e.preventDefault();const t=e.target.value.trim();t&&!u.includes(t)&&(S([...u,t]),e.target.value="")}},W=e=>{S(u.filter(t=>t!==e))},H=()=>{if(!m.trim()){d("Please enter a manual title","warning");return}let e="Anonymous",t=null;try{const l=JSON.parse(localStorage.getItem("userData"));l&&(t=l,e=`${l.firstName} ${l.lastName}`)}catch(l){console.error("Error getting user data",l)}const s={id:Date.now(),title:m,description:j,category:p,meta:`${p} ‚Ä¢ ${y||"v1.0"}`,tags:u,views:0,likes:0,downloads:0,author:e,createdAt:new Date().toISOString().split("T")[0],updatedAt:new Date().toISOString().split("T")[0],difficulty:"Beginner",estimatedTime:"10 min",thumbnail:v,blocks:x,fileInfo:r,status:"draft"};try{const n=[...JSON.parse(localStorage.getItem("customManuals")||"[]"),s];localStorage.setItem("customManuals",JSON.stringify(n)),console.log("Manual saved as draft:",s),window.dispatchEvent(new Event("manualUpdated")),d("Manual saved as draft! Redirecting to dashboard...","success"),setTimeout(()=>{f("/creator-dashboard")},1e3)}catch(l){console.error("Error saving manual:",l),d("Failed to save manual","error")}},V=()=>{if(!m.trim()){d("Please enter a manual title","warning");return}let e="Anonymous",t=null;try{const n=JSON.parse(localStorage.getItem("userData"));n&&(t=n,e=`${n.firstName} ${n.lastName}`)}catch(n){console.error("Error getting user data",n)}const s=t?.role==="admin"?"published":"pending",l={id:Date.now(),title:m,description:j,category:p,meta:`${p} ‚Ä¢ ${y||"v1.0"}`,tags:u,views:0,likes:0,downloads:0,author:e,createdAt:new Date().toISOString().split("T")[0],updatedAt:new Date().toISOString().split("T")[0],difficulty:"Beginner",estimatedTime:"10 min",thumbnail:v,blocks:x,fileInfo:r,status:s};try{const Y=[...JSON.parse(localStorage.getItem("customManuals")||"[]"),l];localStorage.setItem("customManuals",JSON.stringify(Y)),console.log("Manual saved:",l),window.dispatchEvent(new Event("manualUpdated")),s==="pending"&&ae().filter(b=>b.role==="admin").forEach(b=>{Z({userId:b.id,message:`New manual pending approval: "${m}" by ${e}`,type:"info",link:"/admin-dashboard"})}),t?.role==="admin"?(d("Manual published successfully! Redirecting to manual page...","success"),setTimeout(()=>{f(`/manual/${l.id}`)},1e3)):(d("Manual created successfully and submitted for approval! Redirecting to dashboard...","success"),setTimeout(()=>{f("/creator-dashboard")},1e3))}catch(n){console.error("Error saving manual:",n),d("Failed to save manual","error")}},K=e=>{let t="block-input";return e.type==="heading"?t+=" block-heading":e.type==="quote"?t+=" block-quote":e.type==="code"&&(t+=" block-code"),t},X=e=>{const t=e.imageUrl&&(e.imageUrl.startsWith("data:")||e.imageUrl.startsWith("http://")||e.imageUrl.startsWith("https://"));return a.jsx("div",{className:"image-block",children:t?a.jsxs("div",{className:"image-preview",children:[a.jsx("img",{src:e.imageUrl,alt:"Preview",className:"image-preview-img",onError:s=>{s.target.style.display="none",console.warn("Failed to load image:",e.imageUrl)}}),a.jsxs("div",{className:"image-controls",children:[a.jsx("input",{type:"text",placeholder:i("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{N(e.id,s.target.value),s.target.value.startsWith("http")&&C(e.id,s.target.value)},className:"image-url-input"}),a.jsxs("label",{className:"image-upload-btn",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>T(e.id,s.target.files[0]),style:{display:"none"}}),i("createManual.uploadImage")]})]})]}):a.jsx("div",{className:"image-placeholder",children:a.jsxs("div",{className:"image-upload-area",children:[a.jsxs("label",{className:"image-upload-label",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:s=>T(e.id,s.target.files[0]),style:{display:"none"}}),a.jsx("div",{className:"upload-icon",children:"üì∑"}),a.jsx("div",{children:i("createManual.uploadImage")})]}),a.jsx("div",{className:"or-divider",children:i("common.or")}),a.jsx("input",{type:"text",placeholder:i("createManual.blockPlaceholders.image"),value:e.value,onChange:s=>{N(e.id,s.target.value),s.target.value.startsWith("http")&&C(e.id,s.target.value)},className:"image-url-input"})]})})})};return a.jsxs("div",{className:"root",children:[a.jsxs("div",{className:"page",children:[a.jsxs("section",{className:"editor-panel",children:[a.jsx("input",{className:"editor-title",placeholder:i("createManual.titlePlaceholder"),value:m,onChange:e=>I(e.target.value)}),a.jsx("textarea",{className:"editor-desc",rows:2,placeholder:i("createManual.contentPlaceholder"),value:j,onChange:e=>D(e.target.value)}),a.jsx("div",{className:"editor-divider"}),a.jsx("div",{className:"blocks",children:x.map(e=>a.jsxs("div",{className:`block ${e.showToolbar?"block-show-toolbar":""}`,children:[a.jsx("button",{type:"button",className:"block-plus",onClick:()=>k(e.id),children:"+"}),a.jsxs("div",{className:"block-toolbar",children:[a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="text"?"toolbar-btn-active":""}`,onClick:()=>h(e.id,"text"),children:"T"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="heading"?"toolbar-btn-active":""}`,onClick:()=>h(e.id,"heading"),children:"H"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="quote"?"toolbar-btn-active":""}`,onClick:()=>h(e.id,"quote"),children:"‚ùù"}),a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="code"?"toolbar-btn-active":""}`,onClick:()=>h(e.id,"code"),children:"{ }"})," ",a.jsx("button",{type:"button",className:`toolbar-btn ${e.type==="image"?"toolbar-btn-active":""}`,onClick:()=>h(e.id,"image"),children:"üñºÔ∏è"}),a.jsx("button",{type:"button",className:"toolbar-btn toolbar-btn-delete",onClick:()=>q(e.id),style:{marginLeft:"auto",color:"#ef4444",borderColor:"#ef4444"},title:"Delete this block",children:"üóëÔ∏è"})]}),e.type==="image"?X(e):a.jsx("textarea",{className:K(e),placeholder:e.type==="heading"?i("createManual.blockPlaceholders.heading"):e.type==="quote"?i("createManual.blockPlaceholders.quote"):e.type==="code"?i("createManual.blockPlaceholders.code"):i("createManual.blockPlaceholders.text"),value:e.value,onChange:t=>N(e.id,t.target.value)})]},e.id))}),a.jsxs("button",{type:"button",className:"btn-add-block",onClick:()=>R("text"),children:["+ ",i("createManual.addBlock")]})]}),a.jsxs("aside",{className:"meta-panel",children:[a.jsxs("div",{className:"meta-card",children:[a.jsx("div",{className:"meta-title",children:"Manual details"}),a.jsx("div",{className:"meta-caption",children:"‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà ‡πÅ‡∏ó‡πá‡∏Å ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á"}),a.jsx("div",{className:"meta-field-label",children:"Thumbnail"}),v&&a.jsx("div",{className:"thumbnail-preview",children:a.jsx("img",{src:v,alt:"Thumbnail preview",style:{width:"100%",height:"120px",objectFit:"cover",borderRadius:"8px",marginBottom:"8px"}})}),a.jsxs("label",{className:"thumb-box",children:[a.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:z}),w||"Click to upload thumbnail"]}),a.jsx("div",{className:"meta-field-label",children:"Category (‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà)"}),a.jsxs("select",{className:"meta-select",value:p,onChange:e=>A(e.target.value),children:[a.jsx("option",{children:"IT"}),a.jsx("option",{children:"Design"}),a.jsx("option",{children:"Marketing"}),a.jsx("option",{children:"HR"}),a.jsx("option",{children:"Operations"}),a.jsx("option",{children:"Customer Support"})]}),a.jsx("div",{className:"meta-field-label",children:"Tags"}),a.jsx("input",{className:"meta-input",placeholder:"Type tag and press Enter",onKeyDown:L}),a.jsxs("div",{className:"tag-box",children:[u.map((e,t)=>a.jsxs("span",{className:"tag-pill",onClick:()=>W(e),title:"Click to remove",children:[e," √ó"]},t)),u.length===0&&a.jsx("span",{style:{color:"var(--text-muted)",fontSize:"12px"},children:"No tags added yet"})]}),a.jsxs("div",{className:"meta-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Version"}),a.jsx("input",{className:"meta-input",placeholder:"‡πÄ‡∏ä‡πà‡∏ô 1.0 ‡∏´‡∏£‡∏∑‡∏≠ 2.1",value:y,onChange:e=>P(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"meta-field-label",children:"Language"}),a.jsxs("select",{className:"meta-select",value:B,onChange:e=>O(e.target.value),children:[a.jsx("option",{children:"TH"}),a.jsx("option",{children:"EN"})]})]})]}),a.jsx("div",{className:"meta-field-label",style:{marginTop:10},children:"Manual file (PDF / DOCX / ZIP)"}),a.jsxs("label",{className:"file-btn",children:[a.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.zip",style:{display:"none"},onChange:J}),r?`üìé ${typeof r=="object"?r.name:r}`:"üìé Upload manual file"]})," ",r&&typeof r=="object"&&a.jsxs("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginTop:"4px"},children:[(r.size/1024).toFixed(1)," KB ‚Ä¢"," ",r.type||"Unknown type"]}),a.jsx("p",{className:"meta-note",children:"‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏Å‡∏£‡∏¥‡πà‡∏ô‡∏ô‡∏≥‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏î‡πâ"}),a.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[a.jsx("button",{type:"button",className:"draft-btn",onClick:H,children:"üíæ Draft"}),a.jsx("button",{type:"button",className:"publish-btn",onClick:V,style:{flex:1},children:"Publish"})]})]})," "]})]}),a.jsx(ee,{show:g.show,onHide:U,title:g.title,message:g.message,variant:g.variant})]})};export{ce as default};
