import{j as s,M as B,t as U,i as A,b as J}from"./ui-C0p69nPY.js";import{r as h,L as O}from"./vendor-D6EYvIws.js";import{g as $}from"./manualRepository-BSTK98NG.js";import{u as P}from"./utils-dQ_ya9vc.js";import{l as F}from"./searchAnalytics-Bz9FKtRP.js";import"./ManualData-CCWVZZls.js";const G=({manuals:o=[],activeTag:r="",onTagClick:l=()=>{},onLike:n=()=>{},onDownload:a=()=>{},onBookmark:m=()=>{},className:t=""})=>!o||o.length===0?s.jsxs("div",{className:`manual-grid-empty ${t}`,children:[s.jsx("div",{className:"manual-grid-empty-title",children:"No manuals found"}),s.jsx("div",{className:"manual-grid-empty-text",children:"Try adjusting your search criteria or browse different categories."})]}):s.jsx("div",{className:`manual-grid ${t}`,children:o.map(d=>s.jsx(B,{manual:d,activeTag:r,onTagClick:l,onLike:()=>n(d),onDownload:()=>a(d),onBookmark:()=>m(d)},d.id))}),H=(o,r)=>{const l=o.toLowerCase().trim();if(!l)return 0;let n=0;return(r.title||"").toLowerCase().includes(l)&&(n+=3),(r.tags||[]).map(f=>f.toLowerCase()).some(f=>f.includes(l))&&(n+=2),(r.category||"").toLowerCase().includes(l)&&(n+=1),(r.description||"").toLowerCase().includes(l)&&(n+=1),(r.sections||[]).forEach(f=>{const j=(f.title||"").toLowerCase(),g=(f.content||"").toLowerCase();(j.includes(l)||g.includes(l))&&(n+=1)}),n},K=(o,r,l)=>{const n=o.toLowerCase().trim(),a=[],m=(r.title||"").toLowerCase(),t=(r.tags||[]).map(p=>p.toLowerCase()),d=(r.category||"").toLowerCase(),L=(r.description||"").toLowerCase();m.includes(n)&&a.push("à¸«à¸±à¸§à¸‚à¹‰à¸­"),t.some(p=>p.includes(n))&&a.push("à¹à¸—à¹‡à¸"),d.includes(n)&&a.push("à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ"),L.includes(n)&&a.push("à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢"),(r.sections||[]).some(p=>{const w=(p.title||"").toLowerCase(),u=(p.content||"").toLowerCase();return w.includes(n)||u.includes(n)})&&a.push("à¹€à¸™à¸·à¹‰à¸­à¸«à¸²");const g=a.length>0?a.join(", "):"à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡";return`à¹à¸™à¸°à¸™à¸³ "${r.title}" à¹€à¸žà¸£à¸²à¸°à¸žà¸šà¸„à¸³à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡à¸à¸±à¸š "${o}" à¹ƒà¸™${g} (à¸„à¸°à¹à¸™à¸™à¸„à¸§à¸²à¸¡à¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡: ${l})`},Q=(o,r)=>{if(!o||!o.trim())return{results:[],explanations:[]};if(!Array.isArray(r)||r.length===0)return{results:[],explanations:[]};const n=r.filter(t=>(t.status||"published")==="published").map(t=>({manual:t,score:H(o,t)})).filter(t=>t.score>0).sort((t,d)=>d.score-t.score).slice(0,3),a=n.map(t=>t.manual),m=n.map(t=>K(o,t.manual,t.score));return{results:a,explanations:m}},q=()=>{const[o,r]=h.useState("all"),[l,n]=h.useState(""),[a,m]=h.useState(""),[t,d]=h.useState(""),[L,f]=h.useState(0),[j,g]=h.useState([]),[p,w]=h.useState([]),{t:u}=P(),v=h.useMemo(()=>!!(a||t||o!=="all"),[a,t,o]),k=h.useMemo(()=>{const e=a.toLowerCase().trim();return $().filter(i=>{const x=i.category||"",C=i.tags||[],R=i.title||"";return!((i.status||"published")!=="published"||o!=="all"&&x!==o||t&&!C.map(y=>y.toLowerCase()).includes(t.toLowerCase())||e&&!`${R} ${x} ${C.join(" ")}`.toLowerCase().includes(e))})},[a,t,o,L]),b=h.useMemo(()=>{if(!v)return u("feed.resultsText");const e=[];return a&&e.push(`search: "${a}"`),o!=="all"&&e.push(`category: ${o}`),t&&e.push(`tag: ${t}`),`${u("feed.searchResults")} ${k.length} manual(s) â€¢ ${e.join(" â€¢ ")}`},[v,a,o,t,k,u]);h.useEffect(()=>{const e=()=>{f(c=>c+1)};return window.addEventListener("storage",e),window.addEventListener("manualUpdated",e),window.addEventListener("manualInteractionsUpdated",e),window.addEventListener("bookmarksUpdated",e),()=>{window.removeEventListener("storage",e),window.removeEventListener("manualUpdated",e),window.removeEventListener("manualInteractionsUpdated",e),window.removeEventListener("bookmarksUpdated",e)}},[]);const N=()=>{const e=document.getElementById("manual-list");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},S=e=>{e.preventDefault(),m(l),d("");const c=$();if(l.trim()){const{results:i,explanations:x}=Q(l,c);g(i),w(x)}else g([]),w([]);N()},E=e=>{r(e),d(""),m(""),g([]),w([]),N()},M=e=>{d(e),m(""),n(""),r("all"),g([]),w([]),N()},T=e=>{const c=localStorage.getItem("userData");if(!c){console.log("Please log in to like manuals");return}try{const i=JSON.parse(c),x=J(e.id,i.id);console.log(`${x.isLiked?"Liked":"Unliked"} manual: ${e.title}`)}catch(i){console.error("Error liking manual:",i)}},D=e=>{const c=A(e.id);console.log(`Downloaded manual: ${e.title} (Total: ${c})`)},I=e=>{const c=localStorage.getItem("userData");if(!c){console.log("Please log in to bookmark manuals");return}try{const i=JSON.parse(c),x=U(i.id,e);console.log(`${x?"Bookmarked":"Removed bookmark from"} manual: ${e.title}`)}catch(i){console.error("Error bookmarking manual:",i)}};return h.useEffect(()=>{if(a&&a.trim()){const e=localStorage.getItem("userData");let c=null;try{e&&(c=JSON.parse(e))}catch(i){console.error("Error parsing user data:",i)}F(a,k.length,c)}},[a,k.length]),s.jsxs("main",{className:"feed-page",children:[s.jsxs("section",{className:"feed-hero",id:"hero-top",children:[s.jsx("h1",{className:"feed-hero-title",children:u("feed.title")}),s.jsx("p",{className:"feed-hero-sub",children:u("feed.subtitle")}),s.jsx("form",{className:"feed-hero-searchWrapper",onSubmit:S,children:s.jsxs("div",{className:"feed-hero-search",children:[s.jsx("span",{className:"feed-hero-searchIcon",children:"ðŸ”"}),s.jsx("input",{type:"text",placeholder:u("feed.searchPlaceholder"),value:l,onChange:e=>n(e.target.value)})]})}),s.jsx("div",{className:"feed-chipRow",children:["all","IT","Design","Marketing","HR"].map(e=>s.jsx("button",{type:"button",className:`feed-chip ${o===e?"is-active":""}`,onClick:()=>E(e),children:u(`feed.categories.${e.toLowerCase()}`)},e))})]}),a&&s.jsxs("section",{className:"feed-ai-suggestions",children:[s.jsx("div",{className:"feed-ai-header",children:s.jsxs("h2",{className:"feed-ai-title",children:[u("feed.aiSuggestions"),' "',a,'"']})}),j.length===0?s.jsx("div",{className:"feed-ai-empty",children:s.jsx("p",{children:u("feed.noAiResults")})}):s.jsx("div",{className:"feed-ai-results",children:j.map((e,c)=>s.jsxs(O,{to:`/manual/${e.id}`,className:"feed-ai-card",children:[s.jsx("div",{className:"feed-ai-card-number",children:c+1}),s.jsxs("div",{className:"feed-ai-card-content",children:[s.jsx("h3",{className:"feed-ai-card-title",children:e.title}),s.jsx("p",{className:"feed-ai-card-meta",children:e.meta}),s.jsx("p",{className:"feed-ai-card-explanation",children:p[c]}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"feed-ai-card-tags",children:e.tags.slice(0,3).map(i=>s.jsx("span",{className:"feed-ai-tag",children:i},i))})]}),s.jsx("div",{className:"feed-ai-card-arrow",children:"â†’"})]},e.id))})]}),s.jsxs("section",{className:"feed-main",id:"manual-list",children:[s.jsxs("header",{className:"feed-mainHeader",children:[s.jsx("div",{className:"feed-mainTitle",children:u(v?"feed.searchResults":"feed.recommended")}),s.jsx("div",{className:"feed-mainSub",children:b})]}),s.jsx(G,{manuals:k,activeTag:t,onTagClick:M,onLike:T,onDownload:D,onBookmark:I,className:"feed-cardGrid"})]})]})};export{q as default};
