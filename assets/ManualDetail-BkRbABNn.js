import{g as le,h as ce,k as de,j as e,l as U,b as me}from"./ui-DKY0DGm9.js";import{h as ue,u as he,r as c}from"./vendor-D6EYvIws.js";import{u as fe,A as xe}from"./AlertModal-CrmLqu_t.js";import"./index-CNoTa7P2.js";import{m as j}from"./ManualData-CVKivWWw.js";import"./utils-CDqJ1pPe.js";const $=[{id:1,manualId:1,userId:1,author:"John Doe",text:"Great guide! Very helpful for setting up VS Code.",createdAt:"2024-11-20"},{id:2,manualId:1,userId:2,author:"Maria Garcia",text:"Thanks for the detailed instructions. This saved me a lot of time!",createdAt:"2024-11-21"},{id:3,manualId:2,userId:1,author:"John Doe",text:"The Figma integration steps are spot on. Worked perfectly!",createdAt:"2024-11-19"},{id:4,manualId:3,userId:3,author:"Sarah Johnson",text:"This onboarding checklist is comprehensive. Will definitely use it for new hires.",createdAt:"2024-11-18"},{id:5,manualId:2,userId:3,author:"Sarah Johnson",text:"Could you add more screenshots? Visual examples would help.",createdAt:"2024-11-22"}],R="quickhelp_bookmarks";function J(){try{const n=localStorage.getItem(R);if(!n)return[];const l=JSON.parse(n);return Array.isArray(l)?l:[]}catch(n){return console.error("Failed to load bookmarks",n),[]}}function P(n){try{localStorage.setItem(R,JSON.stringify(n)),window.dispatchEvent(new Event("bookmarksChanged"))}catch(l){console.error("Failed to save bookmarks",l)}}function ge(n,l){return!n||!l?!1:J().some(h=>String(h.userId)===String(n)&&String(h.manualId)===String(l))}function pe(n,l){if(!n||!l||!l.id)return console.warn("Invalid userId or manual for bookmark toggle"),!1;const d=J(),h=d.findIndex(f=>String(f.userId)===String(n)&&String(f.manualId)===String(l.id));return h!==-1?(d.splice(h,1),P(d),!1):(d.push({userId:String(n),manualId:String(l.id),manualTitle:l.title||"Untitled Manual",createdAt:new Date().toISOString()}),P(d),!0)}const we=()=>{const{id:n}=ue(),l=he(),[d,h]=c.useState(!1),[f,E]=c.useState(!1),[V,O]=c.useState(0),[K,M]=c.useState(0),[W,N]=c.useState(""),[r,q]=c.useState(null),[v,B]=c.useState(""),[C,T]=c.useState(!1),[S,w]=c.useState([]),[D,G]=c.useState(0),[H,y]=c.useState(null),[I,k]=c.useState(""),{modalState:x,showAlert:u,showConfirm:Y,hideAlert:_}=fe(),s=c.useMemo(()=>{if(!j||j.length===0)return null;const t=JSON.parse(localStorage.getItem("customManuals")||"[]"),a=new Set(t.map(o=>o.id)),i=j.filter(o=>!a.has(o.id)),m=[...t,...i];return m.find(o=>String(o.id)===String(n))||m[0]},[n,D]),z=c.useMemo(()=>{if(!r||!s)return!1;if(r.role==="admin")return!0;if(r.role==="creator"){const t=`${r.firstName} ${r.lastName}`;return s.author===t||s.author===r.username}return!1},[r,s]);c.useEffect(()=>{const t=localStorage.getItem("userData");if(t)try{const i=JSON.parse(t);if(q(i),n){const o=le()[n]||{likedBy:[]};h(o.likedBy?o.likedBy.includes(parseInt(i.id)):!1),E(ge(i.id,n))}}catch(i){console.error("Error parsing user data:",i)}if(n){const i=localStorage.getItem("userData");let m=null;if(i)try{m=JSON.parse(i).id}catch{}const o=ce(n,m),g=de(n);O(o),M(g.likes||0)}const a=()=>{G(i=>i+1)};return window.addEventListener("storage",a),window.addEventListener("manualUpdated",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("manualUpdated",a)}},[n]),c.useEffect(()=>{if(s&&s.version)N(s.version);else if(s&&s.versions&&s.versions.length>0)N(s.versions[0]);else if(s&&s.meta){const t=s.meta.match(/v(\d+\.\d+)/);t&&N(t[1])}},[s]);const A=c.useMemo(()=>{if(!j||!s)return[];const t=JSON.parse(localStorage.getItem("customManuals")||"[]"),a=new Set(t.map(o=>o.id)),i=j.filter(o=>!a.has(o.id));return[...t,...i].filter(o=>o.id!==s.id&&(o.category===s.category||o.tags?.some(g=>s.tags?.includes(g)))).slice(0,3)},[s,D]),b=c.useMemo(()=>s?[...$?$.filter(a=>String(a.manualId)===String(s.id)):[],...S].sort((a,i)=>new Date(i.createdAt)-new Date(a.createdAt)):S,[s,S]),Q=()=>{if(!r)return;const{isLiked:t,likes:a}=me(n,r.id);h(t),M(a)},X=()=>{if(!r||!s)return;const t=pe(r.id,s);E(t),t&&u("Bookmarked! You will be notified when this manual is updated.","success","Bookmark Added")},Z=async()=>{try{navigator.share?await navigator.share({title:s.title,text:s.description,url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),u("Share link copied to clipboard!","success","Link Copied"))}catch(t){console.error("Error sharing:",t),u("Share link copied to clipboard!","success","Link Copied")}},ee=t=>{N(t.target.value)},L=t=>{const a=document.getElementById(`section-${t}`);a&&a.scrollIntoView({behavior:"smooth"})},te=t=>{const a=new Date(t),m=Math.abs(new Date-a),o=Math.floor(m/(1e3*60*60*24)),g=Math.floor(m/(1e3*60*60)),p=Math.floor(m/(1e3*60*60));return o>0?o===1?"1d ago":`${o}d ago`:g>0?g===1?"1h ago":`${g}h ago`:p>0?p===1?"1m ago":`${p}m ago`:"Just now"},F=async()=>{if(!(!v.trim()||!r)){T(!0);try{const t={id:Date.now(),manualId:parseInt(n),userId:r.id,author:`${r.firstName} ${r.lastName}`,text:v.trim(),createdAt:new Date().toISOString().split("T")[0]};w(a=>[t,...a]),B(""),setTimeout(()=>{u("Comment posted successfully!","success","Comment Posted")},100)}catch(t){console.error("Error posting comment:",t),u("Failed to post comment. Please try again.","error","Error")}finally{T(!1)}}},se=t=>{t.key==="Enter"&&(t.ctrlKey||t.metaKey)&&F()},ae=t=>{y(t.id),k(t.text)},ne=t=>{if(!I.trim()){u("Comment cannot be empty","error","Error");return}w(a=>a.map(i=>i.id===t?{...i,text:I.trim(),edited:!0}:i)),y(null),k(""),u("Comment updated successfully!","success","Updated")},ie=()=>{y(null),k("")},oe=t=>{Y("Delete this comment? This action cannot be undone.",()=>re(t.id),"danger","Confirm Deletion","Delete","Cancel")},re=t=>{w(a=>a.filter(i=>i.id!==t)),u("Comment deleted successfully!","success","Deleted")};return s?e.jsxs("main",{className:"manualPage",children:[e.jsxs("div",{className:"manualPageInner",children:[e.jsxs("div",{className:"breadcrumbRow",children:[e.jsx("button",{className:"backLink",type:"button",onClick:()=>l(-1),children:"â† Back"}),e.jsxs("div",{className:"breadcrumb",children:[s.category,s.subCategory?` â€¢ ${s.subCategory}`:"",` â€¢ ${s.title}`]})]}),e.jsxs("div",{className:"grid",children:[e.jsxs("article",{className:"left",children:[e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"topRow",children:[e.jsx("h1",{className:"title",children:s.title}),s.versions&&e.jsxs("div",{className:"versionRow",children:[e.jsxs("div",{className:"versionWrapper",children:[e.jsx("span",{className:"versionLabel",children:"Version"}),e.jsx("select",{className:"versionSelect",value:W,onChange:ee,"aria-label":"Select version",children:s.versions.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("div",{className:"versionLine"})]})]}),e.jsxs("div",{className:"bottomRow",children:[e.jsxs("div",{className:"authorMetaRow",children:[e.jsx("div",{className:"authorAvatar",title:s.author,children:s.author.charAt(0).toUpperCase()}),e.jsxs("div",{className:"authorDetails",children:[e.jsxs("div",{className:"authorTop",children:[e.jsx("span",{className:"authorName",children:s.author}),e.jsx("span",{className:"metaSeparator",children:"â€¢"}),e.jsx("span",{className:"categoryBadge",children:s.category})]}),e.jsx("div",{className:"authorBottom",children:e.jsxs("span",{className:"metaText",children:["Updated ",s.updatedAt]})})]})]}),e.jsxs("div",{className:"headerActions",children:[z&&e.jsx("button",{className:"actionBtn editBtn",onClick:()=>l(`/edit-manual/${s.id}`),title:"Edit this manual",children:"Edit"}),e.jsx("button",{className:`actionBtn ${d?"liked":""}`,onClick:Q,"aria-pressed":d,title:d?"Unlike this manual":"Like this manual",children:d?"Liked":"Like"}),e.jsx("button",{className:`actionBtn ${f?"bookmarked":""}`,onClick:X,"aria-pressed":f,title:f?"Remove bookmark":"Bookmark this manual",children:f?"Bookmarked":"Bookmark"}),e.jsx("button",{className:"actionBtn",onClick:Z,title:"Share this manual",children:"Share"})]})]})]}),e.jsx("div",{className:"hero",children:e.jsxs("div",{className:"heroContent",children:[e.jsx("div",{className:"heroTitle",children:s.description}),e.jsxs("div",{className:"heroStats",children:[e.jsxs("span",{children:["â± ",s.estimatedTime||"10 min"," read"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["ðŸ‘ ",V," views"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["â˜… ",s.difficulty||"Beginner"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["ðŸ‘ ",K," likes"]})]})]})}),(s.sections?.length>0||s.blocks?.some(t=>t.type==="heading"))&&e.jsxs("div",{className:"tocContainer",children:[e.jsx("h3",{className:"tocTitle",children:"Table of Contents"}),e.jsx("ul",{className:"tocList",children:s.blocks?s.blocks.filter(t=>t.type==="heading").map((t,a)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>L(a),children:t.value})},t.id||a)):s.sections.map((t,a)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>L(a),children:t.title})},a))})]}),e.jsx("div",{className:"contentBody",children:s.blocks?s.blocks.map((t,a)=>e.jsxs("div",{id:`section-${a}`,className:"blockWrapper",children:[t.type==="heading"&&e.jsx("h2",{className:"sectionTitle",children:t.value}),t.type==="text"&&e.jsx("p",{className:"text",children:t.value}),t.type==="quote"&&e.jsx("blockquote",{className:"quote",children:t.value}),t.type==="code"&&e.jsx("pre",{className:"codeBlock",children:e.jsx("code",{children:t.value})})," ",t.type==="image"&&e.jsx("div",{className:"imageWrapper",children:U(t.imageUrl||t.value)?e.jsx("img",{src:U(t.imageUrl||t.value),alt:"Manual content",className:"contentImage",onError:i=>{i.target.style.display="none",console.warn("Failed to load image:",t.imageUrl||t.value)}}):e.jsx("div",{style:{padding:"2rem",textAlign:"center",background:"var(--bg-secondary)",borderRadius:"8px",color:"var(--text-muted)"},children:"ðŸ“· Image not available"})})]},t.id||a)):s.sections?s.sections.map((t,a)=>e.jsxs("section",{id:`section-${a}`,className:"section",children:[e.jsx("h2",{className:"sectionTitle",children:t.title}),e.jsx("p",{className:"text",children:t.content})]},a)):e.jsx("section",{className:"section",children:e.jsx("p",{className:"text",children:s.intro||"No content available for this manual."})})})]}),e.jsxs("aside",{className:"right",children:[" ",e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Download"}),e.jsxs("p",{className:"cardDesc",children:["Get the full ",s.fileInfo?"version":"PDF version"," for offline reading."]}),e.jsx("button",{type:"button",className:"btn primary full",onClick:()=>{if(s.fileInfo&&typeof s.fileInfo=="object"&&s.fileInfo.dataUrl){const t=document.createElement("a");t.href=s.fileInfo.dataUrl,t.download=s.fileInfo.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),u("Download started!","success","Downloading")}else u("File not available for download","warning","No File")},children:s.fileInfo?"Download File":"Download PDF"})," ",e.jsx("div",{className:"fileInfo",children:s.fileInfo&&typeof s.fileInfo=="object"?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[s.fileInfo.type?.split("/")[1]?.toUpperCase()||"FILE"," ","â€¢ ",(s.fileInfo.size/1024/1024).toFixed(2)," MB"]}),e.jsx("span",{children:s.fileInfo.name})]}):s.fileInfo&&typeof s.fileInfo=="string"?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"FILE"}),e.jsx("span",{children:s.fileInfo})]}):e.jsx(e.Fragment,{children:e.jsx("span",{style:{color:"var(--text-muted)"},children:"ðŸ“„ No file uploaded yet"})})})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Tags"}),e.jsx("div",{className:"tagsRow",children:(s.tags||[]).map(t=>e.jsx("span",{className:"tagChip",children:t},t))})]}),e.jsxs("section",{className:"card",children:[e.jsx("h3",{className:"cardTitle",children:"Related Manuals"}),e.jsxs("div",{className:"relatedList",children:[A.map(t=>e.jsxs("button",{className:"relatedItem",onClick:()=>l(`/manual/${t.id}`),children:[e.jsx("div",{className:"relatedTitle",children:t.title}),e.jsxs("div",{className:"relatedMeta",children:[t.category," â€¢ ",t.views," views"]})]},t.id)),A.length===0&&e.jsx("div",{className:"empty",children:"No related manuals found"})]})]}),e.jsxs("section",{className:"card",children:[e.jsxs("h3",{className:"cardTitle",children:["Comments (",b.length,")"]}),r?e.jsxs("div",{className:"commentInputWrapper",children:[e.jsx("textarea",{className:"commentInput",rows:3,placeholder:"Add a comment... (Ctrl+Enter to post)",value:v,onChange:t=>B(t.target.value),onKeyPress:se,disabled:C}),e.jsx("button",{className:"commentSubmitBtn",onClick:F,disabled:!v.trim()||C,children:C?"Posting...":"Post"})]}):e.jsx("div",{className:"commentLoginPrompt",children:e.jsxs("p",{children:["Please"," ",e.jsx("button",{onClick:()=>l("/login"),className:"loginLink",children:"login"})," ","to add a comment"]})}),e.jsxs("div",{className:"commentList",children:[b.map(t=>e.jsxs("div",{className:"commentRow",children:[e.jsx("div",{className:"commentAvatar",children:t.author?.[0]?.toUpperCase()}),e.jsxs("div",{className:"commentContent",children:[e.jsxs("div",{className:"commentHeader",children:[e.jsx("span",{className:"commentAuthor",children:t.author}),e.jsxs("span",{className:"commentTime",children:[te(t.createdAt),t.edited&&e.jsx("span",{className:"editedBadge",children:" (edited)"})]}),r&&t.userId===r.id&&e.jsxs("div",{className:"commentActions",children:[e.jsx("button",{className:"commentActionBtn",onClick:()=>ae(t),title:"Edit comment",children:"âœï¸"}),e.jsx("button",{className:"commentActionBtn deleteBtn",onClick:()=>oe(t),title:"Delete comment",children:"ðŸ—‘ï¸"})]})]}),H===t.id?e.jsxs("div",{className:"commentEditWrapper",children:[e.jsx("textarea",{className:"commentEditInput",value:I,onChange:a=>k(a.target.value),rows:3,autoFocus:!0}),e.jsxs("div",{className:"commentEditActions",children:[e.jsx("button",{className:"commentEditSaveBtn",onClick:()=>ne(t.id),children:"Save"}),e.jsx("button",{className:"commentEditCancelBtn",onClick:ie,children:"Cancel"})]})]}):e.jsx("p",{className:"commentText",children:t.text})]})]},t.id)),b.length===0&&e.jsxs("div",{className:"empty",children:["No comments yet."," ",r?"Be the first to comment!":"Login to be the first to comment!"]})]})]})," "]})]})]}),e.jsx(xe,{show:x.show,onHide:_,title:x.title,message:x.message,variant:x.variant,onConfirm:x.onConfirm,confirmText:x.confirmText,cancelText:x.cancelText})]}):e.jsx("main",{className:"manualPage",children:e.jsx("div",{className:"manualPageInner",children:e.jsx("p",{children:"Manual not found."})})})};export{we as default};
